<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>夏晓文的博客</title>
  
  
  <link href="https://xiaowenxia.github.io/git-inside/atom.xml" rel="self"/>
  
  <link href="https://xiaowenxia.github.io/git-inside/"/>
  <updated>2021-03-22T01:58:03.000Z</updated>
  <id>https://xiaowenxia.github.io/git-inside/</id>
  
  <author>
    <name>夏晓文</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Git 底层原理：传输协议分析（二）</title>
    <link href="https://xiaowenxia.github.io/git-inside/2021/02/23/git-internal-protocol.2/"/>
    <id>https://xiaowenxia.github.io/git-inside/2021/02/23/git-internal-protocol.2/</id>
    <published>2021-02-23T02:45:28.000Z</published>
    <updated>2021-03-22T01:58:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-底层原理：传输协议分析（二）"><a href="#Git-底层原理：传输协议分析（二）" class="headerlink" title="Git 底层原理：传输协议分析（二）"></a>Git 底层原理：传输协议分析（二）</h2><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul><li><a href="#%E6%A6%82%E8%A6%81">概要</a></li><li><a href="#git-%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F">git 传输协议格式</a><ul><li><a href="#pkt-line-%E6%A0%BC%E5%BC%8F"> pkt-line 格式</a></li><li><a href="#side-band-%E6%A0%BC%E5%BC%8F">side-band 格式</a></li><li><a href="#%E5%BC%95%E7%94%A8%E5%8F%91%E7%8E%B0%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">引用发现数据格式</a></li><li><a href="#git-upload-pack-%E6%95%B0%E6%8D%AE%E6%B5%81%E6%A0%BC%E5%BC%8F">git-upload-pack 数据流格式</a></li><li><a href="#git-receive-pack-%E6%95%B0%E6%8D%AE%E6%B5%81%E6%A0%BC%E5%BC%8F">git-receive-pack 数据流格式</a></li></ul></li><li><a href="#%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF">更多信息</a><ul><li><a href="#git-%E6%94%AF%E6%8C%81-4-%E7%A7%8D%E4%BA%A4%E4%BA%92%E5%8D%8F%E8%AE%AE">git 支持 4 种交互协议</a></li><li><a href="#%E5%93%91%E5%8D%8F%E8%AE%AE">哑协议</a></li><li><a href="#protocol-v2">protocol v2</a></li></ul></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">相关环境变量</a><ul><li><a href="#GIT-TRACE-PACKET">GIT_TRACE_PACKET</a></li><li><a href="#GIT-TRACE-PACKFILE">GIT_TRACE_PACKFILE</a></li><li><a href="#GIT-TRACE-CURL">GIT_TRACE_CURL</a></li></ul></li><li><a href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">相关命令</a><ul><li><a href="#git-update-server-info">git-update-server-info</a></li></ul></li><li><a href="#%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81">相关源码</a></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li></ul><h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><p>上一篇文章讲了 git 传输协议的相关流程和要点，本文算上一篇文章的总结帖，涉及了传输协议格式、环境变量、子命令等，并附上了相关的源码说明。</p><h3 id="Git-传输协议格式"><a href="#Git-传输协议格式" class="headerlink" title="Git 传输协议格式"></a>Git 传输协议格式</h3><h4 id="pkt-line-格式"><a href="#pkt-line-格式" class="headerlink" title="pkt-line 格式"></a>pkt-line 格式</h4><p>pkt-line 数据流用来描述引用信息，每一行的前四个字节代表这一行的十六进制编码的长度，包括这四个字节和数据在内。因为包括自身四个字节，前四个直接一定大于0004，所以 pkt-line 格式定义了3个特殊的编码：</p><ul><li><em><strong>0000</strong></em> ( <code>flush-pkt</code> )：代表一段消息的结束。</li><li><em><strong>0001</strong></em> ( <code>delim-pkt</code> )：代表一段消息的分节符。</li><li><em><strong>0002</strong></em> ( <code>response-end-pkt</code> )：无状态会话时响应结束。</li></ul><h4 id="side-band-格式"><a href="#side-band-格式" class="headerlink" title="side-band 格式"></a>side-band 格式</h4><p>side-band 格式用来传递 pack 包数据和进度的。前四个字节和 pkt-line 格式相同，代表这一行的数据长度。第五位用于标志消息类型，<em><code>0x01</code></em> 代表是packfile 数据，<em><code>0x02</code></em> 代表是进度消息，<em><code>0x03</code></em> 代表是错误信息。</p><h4 id="引用发现数据格式"><a href="#引用发现数据格式" class="headerlink" title="引用发现数据格式"></a>引用发现数据格式</h4><p><em><code>引用数据</code></em> 由服务端发送给客户端。整体来讲，一个 <strong>引用数据格式</strong> 一般由如下几部分组成：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PKT-LINE(&quot;# service&#x3D;$servicename&quot; LF)</span><br><span class="line">&quot;0000&quot;</span><br><span class="line">ref_list</span><br><span class="line">&quot;0000&quot;</span><br></pre></td></tr></table></figure><p>其中</p><ul><li><em><code>PKT-LINE</code></em> 代表这一行是 pkt-line 格式的。</li><li><em><code>servicename</code></em> 是服务类型，git clone、git fetch 是 <code>git-upload-pack</code>，git push 则是 <code>git-receive-pack</code>。</li><li><em><code>ref_list</code></em> 是引用信息列表，一定是按照引用名称排序的。</li></ul><p><em><code>ref_list</code></em> 第一个引用一定是 <code>HEAD</code> ， <code>HEAD</code> 后面一定有支持的功能说明（ capability declarations ）第一条引用信息格式为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PKT-LINE(obj-id SP name NUL cap_list LF)</span><br></pre></td></tr></table></figure><blockquote><p>其中 <code>cap_list</code> 是支持的功能列表（ capability list ）。</p></blockquote><p>后面的引用信息格式为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PKT-LINE(obj-id SP name LF)</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line">PKT-LINE(obj-id SP name LF)</span><br><span class="line">PKT-LINE(obj-id SP name &quot;^&#123;&#125;&quot; LF)</span><br></pre></td></tr></table></figure><blockquote><ul><li>其中 <code>name^&#123;&#125;</code> 是 <a href="https://git-scm.com/docs/gitrevisions">git revision</a> 中定义的格式，表示递归该引用找到非 tag 类型的 object 。</li><li>另外，如果该仓库没有引用时，那 <code>ref_list</code> 的内容则是：<code>PKT-LINE(zero-id SP &quot;capabilities^&#123;&#125;&quot; NUL cap-list LF)</code> 。</li></ul></blockquote><p>pkt-line 官方说明见：<a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt#L163">http-protocol.txt</a>。</p><h4 id="git-upload-pack-数据流格式"><a href="#git-upload-pack-数据流格式" class="headerlink" title="git-upload-pack 数据流格式"></a>git-upload-pack 数据流格式</h4><p><em><code>git-upload-pack 请求数据</code></em> 由客户端发送给服务端，表示客户端需要（ <em><code>&quot;want&quot;</code></em> ）哪些 <code>commit-id</code> ，同时也会说明自己有（ <em><code>&quot;have&quot;</code></em> ）哪些 <code>commit-id</code>。git-upload-pack 请求数据格式相对简单，请求数据一定会有个 <em><code>&quot;want&quot;</code></em> ，且第一条需要带上功能说明（ capability declarations ）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PKT-LINE(&quot;want&quot; SP obj-id SP cap_list LF)</span><br><span class="line">PKT-LINE(&quot;want&quot; SP obj-id LF)</span><br><span class="line">PKT-LINE(&quot;want&quot; SP obj-id LF)</span><br><span class="line">&quot;0000&quot;</span><br><span class="line">PKT-LINE(&quot;have&quot; SP obj-id LF)</span><br><span class="line">PKT-LINE(&quot;have&quot; SP obj-id LF)</span><br><span class="line">&quot;0000&quot; &#x2F; PKT-LINE(&quot;done&quot; LF)</span><br></pre></td></tr></table></figure><p>_<code>git-upload-pack 回复数据</code>_由服务端回复给客户端，</p><h4 id="git-receive-pack-数据流格式"><a href="#git-receive-pack-数据流格式" class="headerlink" title="git-receive-pack 数据流格式"></a>git-receive-pack 数据流格式</h4><h3 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h3><h4 id="git-支持-4-种交互协议"><a href="#git-支持-4-种交互协议" class="headerlink" title="git 支持 4 种交互协议"></a>git 支持 4 种交互协议</h4><p>Git 客户端和服务端交互的协议支持 4 种：<code>本地协议</code>、 <code>http 协议</code>、 <code>ssh 协议</code>、 <code>git 协议</code>，在我们的日常开发过程中，接触最多的是 <code>http 协议</code> 和 <code>ssh 协议</code> 。<br>根据 URL 的前缀可以知道使用的是什么协议： <em><code>file://</code></em> 、 <em><code>https://</code></em> 、 <em><code>ssh://</code></em> 、 <em><code>git://</code></em> 。通过如下命令和服务器进行交互：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地协议</span></span><br><span class="line">$ git <span class="built_in">clone</span> /path/to/project.git</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ git <span class="built_in">clone</span> file:///path/to/project.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh 协议</span></span><br><span class="line">$ git <span class="built_in">clone</span> ssh://user@server/project.git</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ git <span class="built_in">clone</span> user@server:project.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># http(s) 协议</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://server/project.git</span><br><span class="line"><span class="comment"># 或者带上用户名密码</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://user:token@server/project.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># git 协议</span></span><br><span class="line">$ git <span class="built_in">clone</span> git://git/project.git</span><br></pre></td></tr></table></figure><ul><li><code>本地协议</code> 一般用于共享目录的开发模式，不过需要有文件系统访问权限，安全性不能保障。</li><li><code>git 协议</code> 默认使用 <code>9418</code> 端口，但是没有认证过程，数据传输过程也不加密，安全性也不能保障。</li></ul><h4 id="哑协议"><a href="#哑协议" class="headerlink" title="哑协议"></a>哑协议</h4><p>上面使用 Wireshark 抓取到的协议叫智能（ smart ）协议，实际上 Git 1.6.6 之前的版本（2010年前）一直使用哑（ Dumb ）协议。使用哑协议的版本库很难保证安全性和私有化，而且只能架设只读版本库，目前已经很少使用了，哑协议的交互过程可以参考《<a href="https://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols">Git Internals - Transfer Protocols</a>》。</p><h4 id="protocol-v2"><a href="#protocol-v2" class="headerlink" title="protocol v2"></a>protocol v2</h4><p>Git 目前已经有新的 <a href="https://github.com/git/git/blob/master/Documentation/technical/protocol-v2.txt">protocol v2</a> 协议，支持更高阶的特性，比如能力广播、断电续传等。</p><h3 id="相关环境变量"><a href="#相关环境变量" class="headerlink" title="相关环境变量"></a>相关环境变量</h3><p>除了 <code>GIT_TRACE</code>用于查看 Git 运行日志，Git 还提供了几个非常有意思的环境变量用于查看和调试传输协议。</p><h4 id="GIT-TRACE"><a href="#GIT-TRACE" class="headerlink" title="GIT_TRACE"></a><code>GIT_TRACE</code></h4><h4 id="GIT-TRACE-PACKET"><a href="#GIT-TRACE-PACKET" class="headerlink" title="GIT_TRACE_PACKET"></a><code>GIT_TRACE_PACKET</code></h4><p><code>GIT_TRACE_PACKET=true</code>：显示协议交互数据，不过不会显示 PACK 包内容。输出的信息是经过格式化的，并不是原始数据，不过这个比较容易理解和阅读。</p><div align="center"><img src="https://img.alicdn.com/imgextra/i3/O1CN013WmZbH1vh1SLd3J3l_!!6000000006203-2-tps-2332-1480.png" width="800"/></div><h4 id="GIT-TRACE-PACKFILE"><a href="#GIT-TRACE-PACKFILE" class="headerlink" title="GIT_TRACE_PACKFILE"></a><code>GIT_TRACE_PACKFILE</code></h4><p><code>GIT_TRACE_PACKFILE=&lt;file-path&gt;</code>：把协议交互中的 PACK 包保存到指定文件中，如果设置为 <code>GIT_TRACE_PACKFILE=true</code> ，那就显示在标准输出。</p><h4 id="GIT-TRACE-CURL"><a href="#GIT-TRACE-CURL" class="headerlink" title="GIT_TRACE_CURL"></a><code>GIT_TRACE_CURL</code></h4><p>显示 curl 交互信息，包括 <code>TLS</code> + <code>HTTP</code> + <code>Git 协议</code>，该数据和使用 Wireshark 抓到的信息基本相同。</p><div align="center"><img src="https://img.alicdn.com/imgextra/i2/O1CN01B3sjB41QkSKz32eGb_!!6000000002014-2-tps-2332-1480.png" width="800"/></div><h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><h4 id="git-update-server-info"><a href="#git-update-server-info" class="headerlink" title="git-update-server-info"></a>git-update-server-info</h4><p>该命令可以生成 <code>info/refs</code> 引用信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">`git --exec-path`/git-update-server-info &amp;&amp; cat .git/info/refs</span><br><span class="line">3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12refs/heads/master</span><br><span class="line">3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12refs/remotes/origin/HEAD</span><br><span class="line">f82d3c440cf02ff2e20d712eaa7ba63a9fbff4earefs/remotes/origin/develop</span><br><span class="line">61ee902744d1f5a480e607856d44b104602d6b13refs/remotes/origin/feature/p3c_scan</span><br><span class="line">ae02248d14bfdc9d4d38b1532cab278d179bc863refs/remotes/origin/feature/sensitive_scan</span><br><span class="line">3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12refs/remotes/origin/master</span><br><span class="line">3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12refs/tags/v1.0</span><br></pre></td></tr></table></figure><h3 id="相关源码"><a href="#相关源码" class="headerlink" title="相关源码"></a>相关源码</h3><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt">https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt</a></li><li><a href="https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols">https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols</a></li><li><a href="https://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols">https://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols</a></li><li><a href="https://wangdoc.com/ssh/client.html">https://wangdoc.com/ssh/client.html</a></li><li><a href="https://github.com/gcla/termshark">https://github.com/gcla/termshark</a></li><li><a href="https://joji.me/en-us/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark/#:~:text=The%20second%20method%20to%20decrypt%20SSL%2FTLS%20packets%20is,generate%20TLS%20session%20keys%20out%20to%20that%20file.">Walkthrough: Decrypt SSL/TLS traffic (HTTPS and HTTP/2) in Wireshark</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-底层原理：传输协议分析（二）&quot;&gt;&lt;a href=&quot;#Git-底层原理：传输协议分析（二）&quot; class=&quot;headerlink&quot; title=&quot;Git 底层原理：传输协议分析（二）&quot;&gt;&lt;/a&gt;Git 底层原理：传输协议分析（二）&lt;/h2&gt;&lt;h3 id=&quot;目</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 底层原理：传输协议分析（一）</title>
    <link href="https://xiaowenxia.github.io/git-inside/2021/02/23/git-internal-protocol.1/"/>
    <id>https://xiaowenxia.github.io/git-inside/2021/02/23/git-internal-protocol.1/</id>
    <published>2021-02-23T02:45:28.000Z</published>
    <updated>2021-03-24T05:59:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-底层原理：传输协议分析（一）"><a href="#Git-底层原理：传输协议分析（一）" class="headerlink" title="Git 底层原理：传输协议分析（一）"></a>Git 底层原理：传输协议分析（一）</h2><p>目前主流的代码托管平台都支持 <code>https</code> 和 <code>ssh</code> 的方式来下载和推送代码，这个主要得力于 Git 有一套自定义的传输协议来保证可靠的传输，</p><p>本文通过分析 git 的 http 协议开始，由浅入深循序渐进的展开 Git 传输协议的分析。</p><h3 id="git-https-传输协议分析"><a href="#git-https-传输协议分析" class="headerlink" title="git https 传输协议分析"></a>git https 传输协议分析</h3><p><a href="https://www.wireshark.org/">Wireshark</a> 是一个抓包工具，有非常强大的过滤和分析功能，用该工具分析 git 协议流非常方便。</p><blockquote><p>不借助 Wireshark ，设置 <code>GIT_TRACE_CURL</code> 环境变量也能够查看到 Git 的传输协议过程，具体看 <a href="https://git-scm.com/docs/git#Documentation/git.txt-codeGITTRACECURLcode">GIT_TRACE_CURL</a> 或《 Git 底层原理：传输协议分析（二）》。</p></blockquote><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>本文使用阿里云的代码托管平台 <a href="https://codeup.aliyun.com/">Codeup</a> 来分析传输协议。当然，你也可以使用 <a href="https://github.com/">Github</a> 或者 <a href="https://gitee.com/">Gitee</a> 。</p><blockquote><p>github 使用更高效的 <a href="https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn">http/2 协议</a>。 http/2 协议因为数据帧是二进制格式，对于分析 https 交互并不直观，所以本文使用基于 http/1.1 协议的 Codeup 作为示例。</p></blockquote><h5 id="1-查看服务器-ip-地址"><a href="#1-查看服务器-ip-地址" class="headerlink" title="1. 查看服务器 ip 地址"></a>1. 查看服务器 ip 地址</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ host codeup.aliyun.com</span><br><span class="line">codeup.aliyun.com has address <span class="number">118.31</span><span class="number">.165</span><span class="number">.50</span></span><br></pre></td></tr></table></figure><p>获取到 <code>codeup.aliyun.com</code> 服务器 ip 地址为 <code>118.31.165.50</code> 。</p><h5 id="2-设置-SSLKEYLOGFILE-环境变量"><a href="#2-设置-SSLKEYLOGFILE-环境变量" class="headerlink" title="2. 设置 SSLKEYLOGFILE 环境变量"></a>2. 设置 <code>SSLKEYLOGFILE</code> 环境变量</h5><p>通过设置 <code>SSLKEYLOGFILE</code>环境变量，可以保存 TLS 的会话钥匙（ <code>Session Key</code> ），wireshark 再读取 <code>Session Key</code> 然后实时解析 https 数据流，具体可以参考这篇文章：<a href="https://joji.me/en-us/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark/#:~:text=The%20second%20method%20to%20decrypt%20SSL%2FTLS%20packets%20is,generate%20TLS%20session%20keys%20out%20to%20that%20file.">Walkthrough: Decrypt SSL/TLS traffic (HTTPS and HTTP/2) in Wireshark</a>。<br>如下设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该命令只在当前终端生效。</span></span><br><span class="line"><span class="built_in">export</span> SSLKEYLOGFILE=~/sslkeylog.log</span><br></pre></td></tr></table></figure><h5 id="3-设置-Wireshark"><a href="#3-设置-Wireshark" class="headerlink" title="3. 设置 Wireshark"></a>3. 设置 Wireshark</h5><p>首先让 Wireshark 读取 <code>sslkeylog.log</code>，打开 Wireshark，点击 <code>菜单</code> &gt;<code>Performances</code>，在对话框中选择 <code>Protocol</code> &gt; <code>TLS</code>，设置 <code>(Pre)-Master-Secret log filename</code> 为你的 <code>SSLKEYLOGFILE</code> 文件路径：</p><div align="center"><img src="https://img.alicdn.com/imgextra/i4/O1CN01P91BS21uuvs0F0dlB_!!6000000006098-2-tps-1432-1094.png" width="600"/></div><p>启动 Wireshark 监听网卡，设置过滤规则为 <code>tls &amp;&amp; http &amp;&amp; ip.addr == 118.31.165.50</code> ，其中 <code>118.31.165.50</code>就是获取到的服务器 ip 地址。</p><h4 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h4><p>做完上面的准备工作后，就可以开始抓包分析了。运行 <code>git clone</code> 命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保设置了 SSLKEYLOGFILE 环境变量</span></span><br><span class="line"><span class="comment"># export SSLKEYLOGFILE=~/sslkeylog.log</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://codeup.aliyun.com/5ed5e6f717b522454a36976e/Codeup-Demo.git</span><br></pre></td></tr></table></figure><p>Wireshark 抓包得到如下数据包：</p><p><img src="https://img.alicdn.com/imgextra/i4/O1CN019piDk81N0hvSwYyKK_!!6000000001508-2-tps-3654-446.png"></p><blockquote><p>一开始有个 <code>Unautherized</code> 的过程，这个是 git 在尝试匿名访问。</p></blockquote><p>点击 <code>菜单</code> &gt; <code>Analyze</code> &gt; <code>Follow</code> &gt; <code>HTTP Stream</code> 可以更直观的查看数据交互流，这些数据是 HTTP 内容（不包括TLS）：</p><p><img src="https://img.alicdn.com/imgextra/i2/O1CN01Yt5jNA1RmZnIf2q9X_!!6000000002154-2-tps-7312-4624.png"></p><p>接下来一步一步分析一下 <code>git clone</code> 的交互过程。</p><h5 id="第一次交互：引用发现"><a href="#第一次交互：引用发现" class="headerlink" title="第一次交互：引用发现"></a>第一次交互：引用发现</h5><p>第一次交互主要起到 <code>握手</code> + <code>获取仓库引用信息</code> 的作用。服务端认证用户信息，并告诉客户端对应仓库的所有引用信息，以及相关的功能信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">首先客户端发起请求（在&#96;Authorization&#96;字段附上了用户名密码）</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">GET &#x2F;5ed5e6f717b522454a36976e&#x2F;Codeup-Demo.git&#x2F;info&#x2F;refs?service&#x3D;git-upload-pack</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">服务端认证用户信息，然后返回引用列表</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">001e# service&#x3D;git-upload-pack</span><br><span class="line">000001163ab7c8d1c1e2ce5f5e16a17c41f6665686980d12 HEAD\0multi_ack thin-pack side-band side-band-64k ofs-delta shallow deepen-since deepen-not deepen-relative no-progress include-tag multi_ack_detailed no-done symref&#x3D;HEAD:refs&#x2F;heads&#x2F;master object-format&#x3D;sha1 agent&#x3D;git&#x2F;2.28.0.agit.6.0</span><br><span class="line">0040f82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea refs&#x2F;heads&#x2F;develop</span><br><span class="line">...省略...</span><br><span class="line">003c3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12 refs&#x2F;tags&#x2F;v1.0</span><br><span class="line">0000</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure><p><strong>客户端</strong> 发起的 GET 请求，URL 为 <code>$GIT_URL/info/refs?service=git-upload-pack</code>。</p><p><strong>服务端</strong> 返回的信息按照 pkt-line 格式编排，信息主要是远程仓库的引用信息。pkt-line 格式定义每一行的前四个字节代表这一行的十六进制编码的长度，同时也定义前四个字节 <em><code>0000</code></em> 为一点消息的结束。详细说明见文末的 <a href="#pkt-line-%E6%A0%BC%E5%BC%8F">pkt-line 格式</a>。<br>这次交互里面，根据 <em><code>0000</code></em> 出现的位置，可以知道服务端返回的信息里面包含了2部分，第一部分是固定字段，表示这次回复的服务类型是 <code>git-upload-pack</code>。<br>第二部分的第一行内容信息比较多：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">01163ab7c8d1c1e2ce5f5e16a17c41f6665686980d12 HEAD\0multi_ack thin-pack side-band side-band-64k ofs-delta shallow deepen-since deepen-not deepen-relative no-progress include-tag multi_ack_detailed no-done symref&#x3D;HEAD:refs&#x2F;heads&#x2F;master object-format&#x3D;sha1 agent&#x3D;git&#x2F;2.28.0.agit.6.0</span><br></pre></td></tr></table></figure><p>这段信息主要描述 HEAD 指针信息，以及功能列表（ capability declarations ）信息，比如 <code>symref=HEAD:refs/heads/master</code> 表示默认分支为 <code>master</code> ，<code>object-format=sha1</code> 表示对象使用 <code>sha1</code> 校验对象，<code>agent=git/2.28.0.agit.6.0</code> 服务器 git 版本信息。</p><p>第二部分第二行开始的信息则是 <code>info/refs</code> 文件内容。<code>info/refs</code> 文件描述了仓库里面的引用信息，包括分支、 tag ，以及一些自定义引用等。</p><blockquote><ul><li>值得一提的是，本示例中服务器回复的 <code>info/refs</code> 文件内容里，除了 <code>refs/heads/*</code> 和 <code>refs/tags/*</code>，还存在 <code>refs/keep-around/*</code> 和 <code>refs/merge-requests/*</code> 等引用，这些是 Codeup 平台特有的引用。</li><li>你可以使用<code> `git --exec-path`/git-update-server-info</code> 命令来生成 <code>info/refs</code> 文件。</li></ul></blockquote><p>实际上这一段的数据流及格式官方文档里面有详细的说明： <a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt#L163">http-protocol.txt</a>，也可以参考本文末的 <a href="#%E5%BC%95%E7%94%A8%E5%8F%91%E7%8E%B0%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">引用数据流</a>。</p><h5 id="第二次交互：请求数据"><a href="#第二次交互：请求数据" class="headerlink" title="第二次交互：请求数据"></a>第二次交互：请求数据</h5><p>第二次交互里，客户端把想要的数据告诉给服务端，服务端然后把 pack 包推送给客户端。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">客户端发送数据到服务器</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">POST &#x2F;5ed5e6f717b522454a36976e&#x2F;Codeup-Demo.git&#x2F;git-upload-pack</span><br><span class="line"></span><br><span class="line">00a8want f82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea multi_ack_detailed no-done side-band-64k thin-pack ofs-delta deepen-since deepen-not agent&#x3D;git&#x2F;2.24.3.(Apple.Git-128)</span><br><span class="line">0032want 61ee902744d1f5a480e607856d44b104602d6b13</span><br><span class="line">0032want ae02248d14bfdc9d4d38b1532cab278d179bc863</span><br><span class="line">0032want 3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12</span><br><span class="line">0032want 3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12</span><br><span class="line">00000009done</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">服务器回复 pack 包</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">0008NAK</span><br><span class="line">0024\2Enumerating objects: 48, done.</span><br><span class="line">0023\2Counting objects:   2% (1&#x2F;48)</span><br><span class="line">...省略...</span><br><span class="line">002b\2Counting objects: 100% (48&#x2F;48), done.</span><br><span class="line">2004\1PACK.......0..x...... ....O.&#125;!81.</span><br><span class="line">KY..OQ.q.)....&#125;..C...&gt;..Et,.&quot;..)........O.b :o..2G...uhK.s.. 3.+N.&lt;&#x2F;P..a..L.Y.1...k.r..71..........X...X.......m.B&#123;Z....m.hp......2..u.&#125;.C&gt;&#x2F;+.Y.j..k...m.&gt;&#x3D;.M....Z...x...Aj.!.....&#123;.&#96;....B&#96;...m...2.....G.Z..Z.....</span><br><span class="line">...省略...</span><br><span class="line">......,.....$.....x.&#125;Q&#x3D;k.1...+.MI...,.Ph.PH...OM..,W..A...&#125;M..J5........&#123;.Em....9...a...T.A..G.+..H,.x.)...w6&#x3D;......I..ay.....7.q......G....1...X.G..s0&#39;H....;..O%.....&quot;.....:......d1V....fJ...d....pd..j1JV1o...z..~C_l......%...N..z.L....@.+.V+&#39;...|.&#x3D;..c:&amp;&#125;&#39;..T....r~...9F+.......7....V(s3....uQ....T7.&#x3D;F..Gt&#96;i.Z.n..Vn</span><br><span class="line">0006\1.</span><br><span class="line">003b\2Total 48 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">0000</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure><p>通过第一次交互里，<strong>客户端</strong> 拿到了远程仓库的引用列表，然后在第二次交互里把想要的 <code>commit-id</code> （及其提交链）发送给服务端。<br>客户端发起的是 POST 请求，URL 为 <code>$GIT_URL/git-upload-pack</code> ，POST 内容为想要（ <em><code>&quot;want&quot;</code></em> ）的 <code>commit-id</code> 和已有（ <em><code>&quot;have&quot;</code></em> ）的 <code>commit-id</code>，其实就是 branch 和 tag 对应的 <code>commit-id</code> 。数据格式跟上面的服务端回复的引用列表格式类似，具体见 <a href="#git-upload-pack-%E6%95%B0%E6%8D%AE%E6%B5%81%E6%A0%BC%E5%BC%8F">git-upload-pack 数据流格式</a>。</p><p><strong>服务端</strong> 会根据 <em><code>&quot;want&quot;</code></em> 和 <em><code>&quot;have&quot;</code></em> 的情况来决定回复最小可用的数据包给客户端，这也是智能（smart）协议的作用所在，相关的机制见 <a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt#L420">http-protocol.txt</a> 。<br>服务端回复的是 HTTP 数据流格式（ HTTP stream ），其中包括了进度、pack 二进制数据等。第一行的 <code>NAK</code> 代表数据开始，后面的数据则使用了 side-band 格式（类似于 pkg-line 格式），来描述传输进度、数据包等。 side-band 格式前四个字节也是用于表示长度，第五个字节用于标志消息类型，<em><code>0x01</code></em> 代表是packfile 数据，<em><code>0x02</code></em> 代表是进度消息，<em><code>0x03</code></em> 代表是错误信息。</p><h4 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h4><p>用 Wireshark 抓包看看 git fetch 过程：</p><p><img src="https://img.alicdn.com/imgextra/i2/O1CN01RnN1z21QUQTWDXiAY_!!6000000001979-2-tps-3654-440.png"></p><p>可以看到，交互过程和 <a href="#git-clone"><code>git clone</code></a> 是一样的，不同的是，客户端请求数据时，除了想要（ <em><code>&quot;want&quot;</code></em> ）的 commit-id ，还带上了已有（ <em><code>&quot;have&quot;</code></em> ）的 commit-id ，服务端回复数据时，也添加了 <code>ACK</code> 字段来告诉客户端我回复的是哪些数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">客户端请求数据</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">POST &#x2F;5ed5e6f717b522454a36976e&#x2F;Codeup-Demo.git&#x2F;git-upload-pack HTTP&#x2F;1.1</span><br><span class="line"></span><br><span class="line">00b4want 113cc207f5a226e066f1119b51e57e2b8fbd8e28 multi_ack_detailed no-done side-band-64k thin-pack include-tag ofs-delta deepen-since deepen-not agent&#x3D;git&#x2F;2.24.3.(Apple.Git-128)</span><br><span class="line">00000032have 61ee902744d1f5a480e607856d44b104602d6b13</span><br><span class="line">0032have ae02248d14bfdc9d4d38b1532cab278d179bc863</span><br><span class="line">0032have f82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea</span><br><span class="line">0009done</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">服务端返回数据</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">0038ACK 61ee902744d1f5a480e607856d44b104602d6b13 common</span><br><span class="line">0038ACK ae02248d14bfdc9d4d38b1532cab278d179bc863 common</span><br><span class="line">0038ACK f82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea common</span><br><span class="line">0031ACK f82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea</span><br><span class="line">0023\x02Enumerating objects: 3, done.</span><br><span class="line">0022\x02Counting objects:  33% (1&#x2F;3)</span><br><span class="line">0029\x02Counting objects: 100% (3&#x2F;3), done.</span><br><span class="line">01d4\x01PACK..........x...K.. ...&#x3D;.&#123;c..&lt;...U^.UH,5....x..z.&#x3D;.&#x3D;...d..D.\.i:. 8..h..CT.(.h</span><br><span class="line">...省略...</span><br><span class="line">.MM.r.....&#x2F;.k......^.........P.@.z.@3Z.q.1.-....a.s..+g.6k@.....U..0..Sd._.H..lU.Q.&#x3D;f....&amp;.@.P\......b..7.&#x2F;..?&#123;..t.V).7..Ndz5x.+I-.....L..6.B.......&#x2F;m...X.A.003a\x02Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">0006\x01.</span><br><span class="line">0000</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure><h4 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h4><p>用 Wireshark 抓包看看 <code>git push</code> 过程：</p><p><img src="https://img.alicdn.com/imgextra/i4/O1CN01N6XA251GnzEOtt5PY_!!6000000000668-2-tps-3654-440.png"></p><h5 id="第一次交互：引用发现-1"><a href="#第一次交互：引用发现-1" class="headerlink" title="第一次交互：引用发现"></a>第一次交互：引用发现</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">客户端发起引用发现请求</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">GET &#x2F;5ed5e6f717b522454a36976e&#x2F;Codeup-Demo.git&#x2F;info&#x2F;refs?service&#x3D;git-receive-pack HTTP&#x2F;1.1</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">服务端返回引用信息列表</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">001f# service&#x3D;git-receive-pack</span><br><span class="line">000000caf82d3c440cf02ff2e20d712eaa7ba63a9fbff4ea refs&#x2F;heads&#x2F;develop.report-status report-status-v2 delete-refs side-band-64k quiet atomic ofs-delta push-options object-format&#x3D;sha1 agent&#x3D;git&#x2F;2.28.0.agit.6.0</span><br><span class="line">004961ee902744d1f5a480e607856d44b104602d6b13 refs&#x2F;heads&#x2F;feature&#x2F;p3c_scan</span><br><span class="line">...省略...</span><br><span class="line">003c3ab7c8d1c1e2ce5f5e16a17c41f6665686980d12 refs&#x2F;tags&#x2F;v1.0</span><br><span class="line">0000</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure><p>引用发现交互和 <code>git clone</code> 是类似的，不同的地方是服务类型为 <code>git-receive-pack</code>，请求的 URL 为 <code>$GIT_URL/info/refs?service=git-receive-pack</code>。</p><h5 id="第二次交互：推送数据"><a href="#第二次交互：推送数据" class="headerlink" title="第二次交互：推送数据"></a>第二次交互：推送数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">客户端推送数据</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">POST &#x2F;5ed5e6f717b522454a36976e&#x2F;Codeup-Demo.git&#x2F;git-receive-pack HTTP&#x2F;1.1</span><br><span class="line"></span><br><span class="line">00a5113cc207f5a226e066f1119b51e57e2b8fbd8e28 b4a87307c6b56064d623851fe018b94d25e68e13 refs&#x2F;heads&#x2F;master. report-status side-band-64k agent&#x3D;git&#x2F;2.24.3.(Apple.Git-128)0000PACK.........</span><br><span class="line">x...K</span><br><span class="line">.0.@.9E...L&amp;3).x.|&amp;.E[..&#x3D;.......o.f.LJm.P.....(1..M$...s.P.#.....j%..3...tD.JD.jTR&#x2F;-.%......;..c.!.Q.......\...Q0$.B.O...Q.y..&#123;t......pj&lt;0....&#39;.....R....2....J.x...........&#96;...v....m.f..9..R.R..t..g....x.+I-..K.,...+.LI5...;*....1.:.I.;.9...p.v.Bg</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">服务端返回成功</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">0030.000eunpack ok</span><br><span class="line">0019ok refs&#x2F;heads&#x2F;master</span><br><span class="line">00000000</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure><p>第二次交互里，客户端发起的 POST 请求 URL 为：<code>$GIT_URL/git-receive-pack</code> ，其内容包括<code>old commit-id</code> 、 <code>new commit-id</code> 、当前分支、功能列表以及需要上传的 PACK 二进制内容。其中新旧 2 个 <code>commit-id</code> 有一个比较有意思的设定：</p><ul><li><code>old commit-id</code> 如果是 40 个 <em><code>0</code></em> ，代表是创建新分支。</li><li><code>new commid-id</code> 如果是 40 个 <em><code>0</code></em> ， 代表是删除分支。</li><li><code>old commit-id</code> 和 <code>new commit-id</code> 都不为 <em><code>0</code></em> ，代表是更新分支。</li></ul><blockquote><p>相关说明可以参考 <a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt#L467">http-protocol.txt git-receive-pack</a> 。</p></blockquote><h3 id="git-ssh-传输协议分析"><a href="#git-ssh-传输协议分析" class="headerlink" title="git ssh 传输协议分析"></a>git ssh 传输协议分析</h3><p>ssh 是建立在 TCP 上的，使用的非对称加密来握手和认证，ssh的会话key（对称密钥）也不能像文章上面一样通过 <code>SSLKEYLOGFILE</code> 环境变量来获取，所以很难使用 Wireshark 进行抓包分析。不过 git 提供了环境变量 <a href="https://git-scm.com/docs/git#Documentation/git.txt-codeGITTRACEPACKETcode">GIT_TRACE_PACKET</a> 来显示传输的过程和数据：</p><p><img src="https://img.alicdn.com/imgextra/i1/O1CN01W8mQ3A1FOxzDspx7l_!!6000000000478-2-tps-2332-976.png"></p><blockquote><p>图中也指定了 GIT_TRACE=1 ，这个可以用来显示远程执行的命令。</p></blockquote><p>可以看到，ssh 只是一个通道，ssh 交互的 git 协议和流程跟 http 基本上是一样的。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>相对于 TCP 、 HTTP 、 <a href="https://github.com/protocolbuffers/protobuf">Protobuf</a> 等通用协议，Git 传输协议定义的比较随意，且扩展性和通用性比较差。不过仔细想想也没有问题，只要能保证正常传输 Git 数据包那就已经达到目的了。</p><p>上面讲了一堆的细节，实际上 Git 传输协议可以更简单的表述（ <a href="https://github.com/jiangxin">@jiangxin</a> ）：</p><div align="center"><img src="https://img.alicdn.com/imgextra/i1/O1CN01R59KkQ265t7GvMW5U_!!6000000007611-2-tps-2506-1284.png" width="800" /></div><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt">https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt</a></li><li><a href="https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols">https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols</a></li><li><a href="https://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols">https://git-scm.com/book/en/v2/Git-Internals-Transfer-Protocols</a></li><li><a href="https://wangdoc.com/ssh/client.html">https://wangdoc.com/ssh/client.html</a></li><li><a href="https://github.com/gcla/termshark">https://github.com/gcla/termshark</a></li><li><a href="https://joji.me/en-us/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark/#:~:text=The%20second%20method%20to%20decrypt%20SSL%2FTLS%20packets%20is,generate%20TLS%20session%20keys%20out%20to%20that%20file.">Walkthrough: Decrypt SSL/TLS traffic (HTTPS and HTTP/2) in Wireshark</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-底层原理：传输协议分析（一）&quot;&gt;&lt;a href=&quot;#Git-底层原理：传输协议分析（一）&quot; class=&quot;headerlink&quot; title=&quot;Git 底层原理：传输协议分析（一）&quot;&gt;&lt;/a&gt;Git 底层原理：传输协议分析（一）&lt;/h2&gt;&lt;p&gt;目前主流的代</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 目录结构</title>
    <link href="https://xiaowenxia.github.io/git-inside/2021/02/16/git-layout/"/>
    <id>https://xiaowenxia.github.io/git-inside/2021/02/16/git-layout/</id>
    <published>2021-02-16T03:56:24.000Z</published>
    <updated>2021-02-17T10:53:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-目录结构"><a href="#Git-目录结构" class="headerlink" title="Git 目录结构"></a>Git 目录结构</h2><p>Git 仓库有两种形式：</p><ul><li>工作目录中的 <code>.git</code> 目录。这种是我们经常接触的Git仓库形式。</li><li>裸仓库，目录一般是 <code>&lt;project&gt;.git</code>。裸仓库没有工作区（working tree），一般是存在于服务器中，用于给用户仓库交互和存储的。</li></ul><blockquote><p>注：有些仓库底下没有.git目录，但是有一个 <code>.git</code> 文本文件，其内容格式为 <code>gitdir: &lt;path&gt;</code> ，代表指向真正的 <code>.git</code> 目录。这种情况经常用在 git submodule 中。</p></blockquote><h3 id="Git-仓库文件结构"><a href="#Git-仓库文件结构" class="headerlink" title="Git 仓库文件结构"></a>Git 仓库文件结构</h3><h4 id="objects"><a href="#objects" class="headerlink" title="objects/"></a>objects/</h4><p>仓库的所有对象都存储在<code>objects/</code>目录中。</p><blockquote><ul><li>定义了 <code>GIT_COMMON_DIR</code> 环境变量时， <code>objects/</code> 目录路径则为：<code>$GIT_COMMON_DIR/objects</code>。</li><li>一般来讲，objects/ 目录中记录了所有的仓库对象，但是有些特殊情况（存在 <code>objects/info/alternates</code> 文件，或者定义 <code>GIT_ALTERNATE_OBJECT_DIRECTORIES</code> 环境变量时），可以引用仓库外部的对象，具体参见：<a href="https://github.com/git/git/blob/master/Documentation/gitrepository-layout.txt#L40">gitrepository-layout.txt#L40</a>。</li></ul></blockquote><h4 id="objects-0-9a-f-0-9a-f"><a href="#objects-0-9a-f-0-9a-f" class="headerlink" title="objects/[0-9a-f][0-9a-f]/"></a>objects/[0-9a-f][0-9a-f]/</h4><p>松散对象（’unpacked’ or ‘loose’ objects）。新创建的对象都是存在这些目录中，对象的文件名称时对象内容的sha1值，取sha1值的前2个字符作为子目录。</p><h4 id="objects-pack"><a href="#objects-pack" class="headerlink" title="objects/pack/"></a>objects/pack/</h4><p>pack文件存储位置。该目录下还存在 <code>*.idx</code> 文件，为对应的 <code>*.pack</code> 文件的索引文件。</p><h4 id="objects-info"><a href="#objects-info" class="headerlink" title="objects/info/"></a>objects/info/</h4><p>记录<code>objects</code> 目录的说明。</p><h4 id="objects-info-packs"><a href="#objects-info-packs" class="headerlink" title="objects/info/packs"></a>objects/info/packs</h4><p>git 哑协议（dumb transports）会使用到的文件。</p><h4 id="objects-info-alternates"><a href="#objects-info-alternates" class="headerlink" title="objects/info/alternates"></a>objects/info/alternates</h4><p>该文件记录外部对象目录，一行记录一个目录路径。</p><h4 id="objects-info-http-alternates"><a href="#objects-info-http-alternates" class="headerlink" title="objects/info/http-alternates"></a>objects/info/http-alternates</h4><p>当仓库是HTTP协议传输时，该文件记录的是URLs，这些URLs存储外部的对象。</p><h4 id="refs"><a href="#refs" class="headerlink" title="refs/"></a>refs/</h4><p>git 引用，该目录下存储 git 的所有引用。<br><code>git prune</code> 命令会清除掉那些不被 git references 引用到的对象。</p><blockquote><p>定义了 <code>GIT_COMMON_DIR</code> 环境变量时， <code>refs/</code> 目录路径则为：<code>$GIT_COMMON_DIR/refs/</code>，但是 <code>refs/bisect</code> 、 <code>refs/rewritten</code> 、 <code>refs/worktree</code> 这3个文件不会受 <code>GIT_COMMON_DIR</code> 影响。</p></blockquote><h4 id="refs-heads"><a href="#refs-heads" class="headerlink" title="refs/heads/"></a>refs/heads/<name></h4><p>记录 git 的分支（branch）。</p><h4 id="refs-tags"><a href="#refs-tags" class="headerlink" title="refs/tags/"></a>refs/tags/<name></h4><p>记录 git 的标签（tag）。</p><h4 id="refs-remotes"><a href="#refs-remotes" class="headerlink" title="refs/remotes/"></a>refs/remotes/<name></h4><p>记录远程分支。</p><h4 id="refs-replace"><a href="#refs-replace" class="headerlink" title="refs/replace/"></a>refs/replace/<obj-sha1></h4><p>records the SHA-1 of the object that replaces <code>&lt;obj-sha1&gt;</code>.</p><h4 id="packed-refs"><a href="#packed-refs" class="headerlink" title="packed-refs/"></a>packed-refs/</h4><p>记录的和 <code>refs/heads/</code>, <code>refs/tags/</code> 一样的内容，但是记录效率更高。</p><blockquote><p>跟<code>refs/</code> 目录一样，定义了 <code>GIT_COMMON_DIR</code> 环境变量时， <code>packed-refs/</code> 目录路径则为：<code>$GIT_COMMON_DIR/packed-refs/</code></p></blockquote><h4 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h4><p>记录当前激活的分支，其内容指向具体的分支（<code>refs/heads/&lt;name&gt;</code>）。一个git仓库一定会有一个HEAD文件。HEAD 文件也可以直接记录一个commit-id，这种情况就是常见的’detached HEAD.’，当检出特定的commit-id时（ <code>git checkout &lt;commit-id&gt;</code> ）就会变成这样。</p><blockquote><ul><li>很多时候可以通过HEAD文件来判断仓库的默认分支。</li><li>HEAD指向不存在的分支也是可以的。</li></ul></blockquote><h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><p>本地仓库配置，通过<code>git config --local</code>查看或者设置。该文件的路径也受环境变量 <code>GIT_COMMON_DIR</code> 控制。</p><h4 id="config-worktree"><a href="#config-worktree" class="headerlink" title="config.worktree"></a>config.worktree</h4><p>多工作区时的工作区配置文件。</p><h4 id="branches"><a href="#branches" class="headerlink" title="branches/"></a>branches/</h4><p>用于 ‘git fetch’ 、 ‘git pull’ 、 ‘git push’，不过这个目录已经不再用了。</p><h4 id="hooks"><a href="#hooks" class="headerlink" title="hooks/"></a>hooks/</h4><p>git 钩子目录。 <code>git init</code> 时，会默认创建一些简单的 hooks 文件。该目录也受环境变量 <code>GIT_COMMON_DIR</code> 控制。</p><h4 id="common"><a href="#common" class="headerlink" title="common/"></a>common/</h4><p>当仓库是多工作区时，不同的工作区共享 <code>common/</code> 目录下的文件。</p><h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>索引文件，裸仓库（bare repository）下不存在 index 文件。</p><h4 id="sharedindex"><a href="#sharedindex" class="headerlink" title="sharedindex."></a>sharedindex.<SHA-1></h4><p>共享索引文件（shared index ），被<code>index</code>文件或者临时index文件（temporary index）引用。只在分割索引模式（split index mode）中有效。</p><h4 id="info"><a href="#info" class="headerlink" title="info/"></a>info/</h4><p>仓库描述信息目录。文件目录受环境变量 <code>GIT_COMMON_DIR</code> 控制。</p><h4 id="info-refs"><a href="#info-refs" class="headerlink" title="info/refs"></a>info/refs</h4><p>跟<code>objects/info/packs</code>一样，用于哑协议。</p><h4 id="info-grafts"><a href="#info-grafts" class="headerlink" title="info/grafts"></a>info/grafts</h4><h4 id="info-exclude"><a href="#info-exclude" class="headerlink" title="info/exclude"></a>info/exclude</h4><p>一般情况，这个文件描述哪些文件排除在版本控制之外，和 <code>.gitignore</code> 文件功能类似，但是 <code>.gitignore</code> 文件可以存在每个目录下面。</p><h4 id="info-attributes"><a href="#info-attributes" class="headerlink" title="info/attributes"></a>info/attributes</h4><p>定义路径的属性，和<code>.gitattributes</code>文件功能类似。</p><h4 id="info-sparse-checkout"><a href="#info-sparse-checkout" class="headerlink" title="info/sparse-checkout"></a>info/sparse-checkout</h4><p>记录 sparse checkout 时的匹配信息。</p><h4 id="remotes"><a href="#remotes" class="headerlink" title="remotes"></a>remotes</h4><p>记录 ‘git fetch’ 、 ‘git pull’ 、 ‘git push’ 命令时的远程 URL 和引用名称。这个目录现在已经不用了。</p><h4 id="logs"><a href="#logs" class="headerlink" title="logs/"></a>logs/</h4><p>存储引用的历史变更记录。该目录也受环境变量 <code>GIT_COMMON_DIR</code> 控制，不过 <code>logs/HEAD</code> 文件除外。</p><h4 id="logs-refs-heads-lt-name-gt"><a href="#logs-refs-heads-lt-name-gt" class="headerlink" title="logs/refs/heads/&lt;name&gt;"></a>logs/refs/heads/<code>&lt;name&gt;</code></h4><p>分支的历史变更记录。</p><h4 id="logs-refs-tags-lt-name-gt"><a href="#logs-refs-tags-lt-name-gt" class="headerlink" title="logs/refs/tags/&lt;name&gt;"></a>logs/refs/tags/<code>&lt;name&gt;</code></h4><p>标签的历史变更记录。</p><h4 id="shallow"><a href="#shallow" class="headerlink" title="shallow"></a>shallow</h4><p>跟 <code>info/grafts</code> 一样的功能，但是只用于内部。</p><h4 id="commondir"><a href="#commondir" class="headerlink" title="commondir"></a>commondir</h4><p>该文件存在时，如果没有定义 GIT_COMMON_DIR 环境变量，那 GIT_COMMON_DIR 会被设置成commondir的内容。</p><h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h4><p>存储 git submodule 的仓库。</p><h4 id="worktrees"><a href="#worktrees" class="headerlink" title="worktrees"></a>worktrees</h4><h4 id="worktrees-lt-id-gt-gitdir"><a href="#worktrees-lt-id-gt-gitdir" class="headerlink" title="worktrees/&lt;id&gt;/gitdir"></a>worktrees/<code>&lt;id&gt;</code>/gitdir</h4><h4 id="worktrees-lt-id-gt-locked"><a href="#worktrees-lt-id-gt-locked" class="headerlink" title="worktrees/&lt;id&gt;/locked"></a>worktrees/<code>&lt;id&gt;</code>/locked</h4><h4 id="worktrees-lt-id-gt-config-worktree"><a href="#worktrees-lt-id-gt-config-worktree" class="headerlink" title="worktrees/&lt;id&gt;/config.worktree"></a>worktrees/<code>&lt;id&gt;</code>/config.worktree</h4><h3 id="仓库目录"><a href="#仓库目录" class="headerlink" title="仓库目录"></a>仓库目录</h3><ul><li><a href="https://github.com/git/git/blob/master/Documentation/gitrepository-layout.txt">gitrepository-layout</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-目录结构&quot;&gt;&lt;a href=&quot;#Git-目录结构&quot; class=&quot;headerlink&quot; title=&quot;Git 目录结构&quot;&gt;&lt;/a&gt;Git 目录结构&lt;/h2&gt;&lt;p&gt;Git 仓库有两种形式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;工作目录中的 &lt;code&gt;.git&lt;/c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 底层原理：Git 底层文件存储格式</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/12/06/git-internal.file-struct/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/12/06/git-internal.file-struct/</id>
    <published>2020-12-06T09:12:56.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-底层原理：Git-底层文件存储格式"><a href="#Git-底层原理：Git-底层文件存储格式" class="headerlink" title="Git 底层原理：Git 底层文件存储格式"></a>Git 底层原理：Git 底层文件存储格式</h2><p>Git 底层文件有 Git 对象、索引文件、pack 文件、分支/引用、HEAD指针等，<br>在<a href="./git-internal.1.md">《Git 底层原理： Git 对象》</a>里面有讲解到，Git 是一个文件系统，最小单元是 Git 对象，Git 对象又分为 4种：<code>blob</code>、<code>tree</code>、<code>commit</code>、<code>tag</code>，那这些对象具体是以什么形式存储的？</p><p>首先按照<a href="./git-internal.1.md">《Git 底层原理： Git 对象》</a>里面提到的步骤初始化一个简单的 git 仓库，查看生成的 git 对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f | sort</span><br><span class="line">.git/objects/03/2ddd9205d65abd773af1610038c764f46a0b12      <span class="comment"># tag</span></span><br><span class="line">.git/objects/10/da3741b6e365b6795335e1e2d3ed5820e794cd      <span class="comment"># tree | 第二次提交</span></span><br><span class="line">.git/objects/39/fb0fbcac51f66b514fbd589a5b2bc0809ce664      <span class="comment"># tree: doc/ | 第二次提交</span></span><br><span class="line">.git/objects/41/20b5f61a582cb12d4dcdaab71c7ef1862dbbca      <span class="comment"># tree | 第一次提交</span></span><br><span class="line">.git/objects/45/c7a584f300657dba878a542a6ab3b510b63aa3      <span class="comment"># blob | changelog</span></span><br><span class="line">.git/objects/52/3d41ce82ea993e7c7df8be1292b2eac84d4659      <span class="comment"># commit | 第一次提交</span></span><br><span class="line">.git/objects/56/64e303b5dc2e9ef8e14a0845d9486ec1920afd      <span class="comment"># blob | README.md</span></span><br><span class="line">.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85      <span class="comment"># blob | 第一次提交 | file.txt</span></span><br><span class="line">.git/objects/a0/e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0      <span class="comment"># commit | 第二次提交</span></span><br><span class="line">.git/objects/ae/c2e48cbf0a881d893ccdd9c0d4bbaf011b5b23      <span class="comment"># blob | 第二次提交 | file.txt</span></span><br></pre></td></tr></table></figure><h3 id="Git-对象"><a href="#Git-对象" class="headerlink" title="Git 对象"></a>Git 对象</h3><p>为了减少存储大小，git 对象都是使用 <a href="http://zlib.net/">zlib</a> 压缩存储的。git 对象由 <code>&lt;type&gt;</code> + <code>&lt;size&gt;</code> + <code>&lt;content&gt;</code> 组成：</p><ul><li><code>&lt;type&gt;</code>: git 对象类型，有如下 4 种：<code>blob</code>、<code>tree</code>、<code>commit</code>、<code>tag</code>。</li><li><code>&lt;size&gt;</code>: git 对象的内容大小。</li><li><code>&lt;content&gt;</code>: git 对象内容。</li></ul><p>如下是 4 种对象的数据存储格式：</p><p><img src="https://img.alicdn.com/imgextra/i3/O1CN01Prj90h1qr21f8nMgE_!!6000000005548-2-tps-2060-1784.png"></p><p>这里可能会有人有疑惑，Git 对象并没有对自身数据做校验（checksum），这样会不会有人对数据进行修改？这个其实不用担心，所有的 Git 对象都会组成一个图（Graph），按照指向关系可以这么理解：<code>refs</code> –&gt; <code>tag 对象 </code> –&gt; <code>commit 对象</code> –&gt; <code>tree 对象</code> –&gt; <code>blob 对象</code>（实际上更为复杂），对象之间通过对方的 sha1 值来确定指向关系，所以要是篡改了对象的内容，那指向关系就会被破坏掉，<a href="https://git-scm.com/docs/git-fsck"><code>git fsck</code></a> 命令就会提示 <code>&quot;hash mismatch&quot;</code>。</p><h4 id="查看对象存储格式"><a href="#查看对象存储格式" class="headerlink" title="查看对象存储格式"></a>查看对象存储格式</h4><p>git 提供了 <code>cat-file</code> 来解析 git 对象，并输出格式化可阅读的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看对象内容</span></span><br><span class="line">$ git cat-file -p 6fb38</span><br><span class="line">100644 blob 5664e303b5dc2e9ef8e14a0845d9486ec1920afdREADME.md</span><br><span class="line">040000 tree 39fb0fbcac51f66b514fbd589a5b2bc0809ce664doc</span><br><span class="line">100644 blob aec2e48cbf0a881d893ccdd9c0d4bbaf011b5b23file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看对象类型</span></span><br><span class="line">$ git cat-file -t 6fb38</span><br><span class="line">tree</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看对象存储的内容大小</span></span><br><span class="line">$ git cat-file -s 6fb38</span><br><span class="line">103</span><br></pre></td></tr></table></figure><p>同时，<code>cat-file</code> 也支持输出未格式化的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看未格式化的内容</span></span><br><span class="line">$ git cat-file tree 10da374</span><br><span class="line">100644 README.mdVd���.���E�Hn��</span><br><span class="line">�40000 doc9���Q�kQO�X�[+����d100644 file.txt��䌿</span><br><span class="line">��&lt;���Ի�%</span><br></pre></td></tr></table></figure><p>如果你想要不依赖 git 命令来查看 git 对象，可以使用 zlib 的一个解压工具：<a href="http://manpages.ubuntu.com/manpages/trusty/man1/zlib-flate.1.html">zlib-flate</a> 来解压 git 对象，以 <code>file.txt</code> 第一次提交生成的 blob 对象 <code>6fb38b7</code> 为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ zlib-flate -uncompress &lt; .git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85</span><br><span class="line">blob 11git-inside</span><br></pre></td></tr></table></figure><blockquote><p>根据上面的 blob 存储格式可以知道，其中 <code>&quot;blob&quot;</code> 是对象类型，<code>&quot;11&quot;</code> 是文件大小，<code>&quot;git-inside&quot;</code> 是文件内容。</p></blockquote><p>这里提供一下 4 种对象的原始数据，仅供参考：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 blob 对象内容</span></span><br><span class="line">$ zlib-flate -uncompress &lt; .git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85</span><br><span class="line">blob 11git-inside</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 tree 对象内容，因为内容是二进制格式，这里使用 hexdump 格式化输出</span></span><br><span class="line">$ zlib-flate -uncompress &lt; .git/objects/10/da3741b6e365b6795335e1e2d3ed5820e794cd | hexdump -C</span><br><span class="line">00000000  74 72 65 65 20 31 30 33  00 31 30 30 36 34 34 20  |tree 103.100644 |</span><br><span class="line">00000010  52 45 41 44 4d 45 2e 6d  64 00 56 64 e3 03 b5 dc  |README.md.Vd....|</span><br><span class="line">00000020  2e 9e f8 e1 4a 08 45 d9  48 6e c1 92 0a fd 34 30  |....J.E.Hn....40|</span><br><span class="line">00000030  30 30 30 20 64 6f 63 00  39 fb 0f bc ac 51 f6 6b  |000 doc.9....Q.k|</span><br><span class="line">00000040  51 4f bd 58 9a 5b 2b c0  80 9c e6 64 31 30 30 36  |QO.X.[+....d1006|</span><br><span class="line">00000050  34 34 20 66 69 6c 65 2e  74 78 74 00 ae c2 e4 8c  |44 file.txt.....|</span><br><span class="line">00000060  bf 0a 88 1d 89 3c <span class="built_in">cd</span> d9  c0 d4 bb af 01 1b 5b 23  |.....&lt;........[<span class="comment">#|</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 commit 对象内容</span></span><br><span class="line">$ zlib-flate -uncompress &lt; .git/objects/a0/e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0</span><br><span class="line">commit 220tree 10da3741b6e365b6795335e1e2d3ed5820e794cd</span><br><span class="line">parent 523d41ce82ea993e7c7df8be1292b2eac84d4659</span><br><span class="line">author xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line">committer xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line"></span><br><span class="line">second commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 tag 对象内容</span></span><br><span class="line">$ zlib-flate -uncompress &lt; .git/objects/03/2ddd9205d65abd773af1610038c764f46a0b12</span><br><span class="line">tag 148object a0e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v0.0.2</span><br><span class="line">tagger xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line"></span><br><span class="line">this is annotated tag</span><br></pre></td></tr></table></figure><blockquote><p>这里使用到了 hexdump，<a href="https://www.man7.org/linux/man-pages/man1/hexdump.1.html">hexdump</a> 是一个 UNIX 命令，用来格式化输出二进制数据。</p></blockquote><h3 id="索引文件"><a href="#索引文件" class="headerlink" title="索引文件"></a>索引文件</h3><p>索引文件默认路径为：<code>.git/index</code>。索引文件用来存储暂存区的相关文件信息，当运行 <code>git add</code> 命令时会把工作区的变更文件信息添加到该索引文件中。索引文件以如下的格式存储暂存区内容：</p><p><img src="https://img.alicdn.com/imgextra/i3/O1CN01IDu59O1U9auyFw6YI_!!6000000002475-2-tps-2414-1376.png"></p><blockquote><p>读过源码的同学会发现，其实还有一个叫<code>.git/index.lock</code>的文件，该文件存在时表示当前工作区被锁定，代表有 git 进程正在操作该仓库。</p></blockquote><h4 id="查看索引文件存储格式"><a href="#查看索引文件存储格式" class="headerlink" title="查看索引文件存储格式"></a>查看索引文件存储格式</h4><p>使用 <code>ls-files</code> 可以读取索引文件存储的文件信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files --stage</span><br><span class="line">100644 5664e303b5dc2e9ef8e14a0845d9486ec1920afd 0README.md</span><br><span class="line">100644 45c7a584f300657dba878a542a6ab3b510b63aa3 0doc/changelog</span><br><span class="line">100644 aec2e48cbf0a881d893ccdd9c0d4bbaf011b5b23 0file.txt</span><br></pre></td></tr></table></figure><p>当然，<code>ls-files</code> 的输出内容也是经过格式化的。跟 Git 对象 不一样，索引文件 <code>.git/indx</code> 并没有经过 zlib 压缩，使用 <code>hexdump</code> 工具就可以直接查看原始数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ hexdump -C .git&#x2F;index</span><br><span class="line">00000000  44 49 52 43 00 00 00 02  00 00 00 03 5f cb 65 22  |DIRC........_.e&quot;|</span><br><span class="line">00000010  22 be 40 2c 5f cb 65 22  22 be 40 2c 01 00 00 04  |&quot;.@,_.e&quot;&quot;.@,....|</span><br><span class="line">00000020  01 3e 09 e3 00 00 81 a4  00 00 01 f6 00 00 00 14  |.&gt;..............|</span><br><span class="line">00000030  00 00 00 04 56 64 e3 03  b5 dc 2e 9e f8 e1 4a 08  |....Vd........J.|</span><br><span class="line">00000040  45 d9 48 6e c1 92 0a fd  00 09 52 45 41 44 4d 45  |E.Hn......README|</span><br><span class="line">00000050  2e 6d 64 00 5f cb 65 26  01 bd 63 4e 5f cb 65 26  |.md._.e&amp;..cN_.e&amp;|</span><br><span class="line">00000060  01 bd 63 4e 01 00 00 04  01 3e 09 f4 00 00 81 a4  |..cN.....&gt;......|</span><br><span class="line">00000070  00 00 01 f6 00 00 00 14  00 00 00 07 45 c7 a5 84  |............E...|</span><br><span class="line">00000080  f3 00 65 7d ba 87 8a 54  2a 6a b3 b5 10 b6 3a a3  |..e&#125;...T*j....:.|</span><br><span class="line">00000090  00 0d 64 6f 63 2f 63 68  61 6e 67 65 6c 6f 67 00  |..doc&#x2F;changelog.|</span><br><span class="line">000000a0  00 00 00 00 5f cb 65 1f  17 f9 45 e9 5f cb 65 1f  |...._.e...E._.e.|</span><br><span class="line">000000b0  17 f9 45 e9 01 00 00 04  01 3e 08 92 00 00 81 a4  |..E......&gt;......|</span><br><span class="line">000000c0  00 00 01 f6 00 00 00 14  00 00 00 1a ae c2 e4 8c  |................|</span><br><span class="line">000000d0  bf 0a 88 1d 89 3c cd d9  c0 d4 bb af 01 1b 5b 23  |.....&lt;........[#|</span><br><span class="line">000000e0  00 08 66 69 6c 65 2e 74  78 74 00 00 54 52 45 45  |..file.txt..TREE|</span><br><span class="line">000000f0  00 00 00 35 00 33 20 31  0a 10 da 37 41 b6 e3 65  |...5.3 1...7A..e|</span><br><span class="line">00000100  b6 79 53 35 e1 e2 d3 ed  58 20 e7 94 cd 64 6f 63  |.yS5....X ...doc|</span><br><span class="line">00000110  00 31 20 30 0a 39 fb 0f  bc ac 51 f6 6b 51 4f bd  |.1 0.9....Q.kQO.|</span><br><span class="line">00000120  58 9a 5b 2b c0 80 9c e6  64 ac 8f 88 7a 1e a4 d0  |X.[+....d...z...|</span><br><span class="line">00000130  b9 83 8d 83 72 4e 7b 71  d2 d8 a0 a5 3d           |....rN&#123;q....&#x3D;|</span><br></pre></td></tr></table></figure><p>索引文件大部分内容都是以二进制存储的，可读性很差，喜欢钻研的同学可以去看源码。</p><h3 id="pack-文件"><a href="#pack-文件" class="headerlink" title="pack 文件"></a>pack 文件</h3><p>pack文件用来合并压缩多个object对象的，可以方便进行网络传输（推送到远程仓库）。<br /><code>*.pack</code> 文件格式：<br /><img src="https://ucc.alicdn.com/pic/developer-ecology/d6efb1160bf74b40887a74cf1ad43c16.png" alt="image.png"></p><blockquote><p>该图片来自于：<a href="https://developer.aliyun.com/article/761663">https://developer.aliyun.com/article/761663</a> 。</p></blockquote><p><br /><code>*.idx</code> 文件格式：<br /><img src="https://ucc.alicdn.com/pic/developer-ecology/941607f49ac44958876d511c5b831ed2.png" alt="image.png"></p><blockquote><p>该图片来自于：<a href="https://developer.aliyun.com/article/761663">https://developer.aliyun.com/article/761663</a> 。</p></blockquote><h3 id="HEAD-等指针文件"><a href="#HEAD-等指针文件" class="headerlink" title="HEAD 等指针文件"></a>HEAD 等指针文件</h3><p>HEAD 具体路径为 <code>.git/HEAD</code> ，<code>HEAD</code> 实际上是一个指针，指向具体的引用或者 <code>commit-id</code> ，比如 HEAD 指向 <code>master</code> 分支时是如下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure><p>如果 checkout 了一个特定的 <code>commit-id</code> 时，那 HEAD 的值是这个 <code>commit-id</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout 523d41ce82ea993e7c7df8be1292b2eac84d4659</span><br><span class="line">$ cat .git/HEAD</span><br><span class="line">523d41ce82ea993e7c7df8be1292b2eac84d4659</span><br></pre></td></tr></table></figure><p>另外，如果我 checkout 了指定的 <code>tag</code> 时，那 HEAD 的值是这个 <code>tag</code> 对应的 <code>commit-id</code>。<br>同样的，<code>.git/ORIG_HEAD</code>、<code>.git/FETCH_HEAD</code> 也是这样的存储方式。</p><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>Git 引用名义上是指针，实际上是一个很简单的文件，这个文件存储的是指向的提交的 <code>commit-id</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">a0e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0</span><br></pre></td></tr></table></figure><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h5 id="相关的-Git-源码"><a href="#相关的-Git-源码" class="headerlink" title="相关的 Git 源码"></a>相关的 Git 源码</h5><blockquote><p>基于 git v2.29.2 版本。</p></blockquote><ul><li>Git 对象：<ul><li>写入 Git 对象源码： <code>sha1-file.c</code> &gt; <a href="https://github.com/git/git/blob/v2.29.2/sha1-file.c#L1931"><code>write_object_file()</code></a>。</li><li>读取 Git 对象源码： <code>sha1-file.c</code> &gt; <a href="https://github.com/git/git/blob/v2.29.2/sha1-file.c#L1621"><code>read_object_file_extended()</code></a></li></ul></li><li>索引文件：<ul><li>解析 索引文件：<code>read-cache.c</code> &gt; <a href="https://github.com/git/git/blob/v2.29.2/read-cache.c#L2277"><code>read_index_from</code></a></li><li>工作区锁定：<a href="https://github.com/git/git/blob/v2.29.2/lockfile.c"><code>lockfile.c</code></a>。</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 索引文件 header */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cache_header</span> &#123;</span></span><br><span class="line"><span class="keyword">uint32_t</span> hdr_signature;</span><br><span class="line"><span class="keyword">uint32_t</span> hdr_version;</span><br><span class="line"><span class="keyword">uint32_t</span> hdr_entries;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文件（entry）的存储格式 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ondisk_cache_entry</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cache_time</span> <span class="title">ctime</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cache_time</span> <span class="title">mtime</span>;</span></span><br><span class="line"><span class="keyword">uint32_t</span> dev;</span><br><span class="line"><span class="keyword">uint32_t</span> ino;</span><br><span class="line"><span class="keyword">uint32_t</span> mode;</span><br><span class="line"><span class="keyword">uint32_t</span> uid;</span><br><span class="line"><span class="keyword">uint32_t</span> gid;</span><br><span class="line"><span class="keyword">uint32_t</span> size;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> data[GIT_MAX_RAWSZ + <span class="number">2</span> * <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>)];</span><br><span class="line"><span class="keyword">char</span> name[FLEX_ARRAY];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://stackoverflow.com/questions/14790681/what-is-the-internal-format-of-a-git-tree-object">https://stackoverflow.com/questions/14790681/what-is-the-internal-format-of-a-git-tree-object</a></li><li><a href="https://stackoverflow.com/questions/4084921/what-does-the-git-index-contain-exactly">https://stackoverflow.com/questions/4084921/what-does-the-git-index-contain-exactly</a></li><li><a href="https://gist.github.com/masak/2415865">https://gist.github.com/masak/2415865</a></li><li><a href="https://linux.die.net/man/1/git-pack-objects">https://linux.die.net/man/1/git-pack-objects</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-底层原理：Git-底层文件存储格式&quot;&gt;&lt;a href=&quot;#Git-底层原理：Git-底层文件存储格式&quot; class=&quot;headerlink&quot; title=&quot;Git 底层原理：Git 底层文件存储格式&quot;&gt;&lt;/a&gt;Git 底层原理：Git 底层文件存储格式&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 底层原理：Git 对象</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/12/06/git-internal.objects/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/12/06/git-internal.objects/</id>
    <published>2020-12-06T09:05:03.000Z</published>
    <updated>2021-02-16T08:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-底层原理：Git-对象"><a href="#Git-底层原理：Git-对象" class="headerlink" title="Git 底层原理：Git 对象"></a>Git 底层原理：Git 对象</h2><p>git 实际上是一个内容文件系统，载体是 git 的对象，存储的是一个个的内容版本。git 仓库就像一个书架，书架上放着的是一本本书，对于 git 来讲，这一本本书就是 git 对象，存储的是书的每一个版本的内容。</p><p>Git 对象 是 Git 的最小组成单位，git 的所有核心底层命令实际上都是在操作 git 对象。比如 git add 命令，就是把文件快照存储成 <code>blob</code> 对象，<code>git commit</code> 命令，就是把提交的文件列表和提交信息分别存储成 <code>tree</code> 对象和 <code>commit</code> 对象，<code>git checkout -b</code>创建分支命令，就是创建一个指针指向 <code>commit</code> 对象。</p><p>本文会从一个空的仓库开始，一步一步由浅入深的展开讲解 git 的内部原理以及底层对象。</p><h3 id="0x01-首先初始化工程"><a href="#0x01-首先初始化工程" class="headerlink" title="0x01 首先初始化工程"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0x01</span> 首先初始化工程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化工程</span></span><br><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /Users/xxx/workspace/git-inside/.git/</span><br><span class="line"><span class="comment"># 查看目录结构</span></span><br><span class="line">$ tree -a</span><br><span class="line">└── .git</span><br><span class="line">    ├── HEAD</span><br><span class="line">    ├── config</span><br><span class="line">    ├── description</span><br><span class="line">    ├── hooks</span><br><span class="line">    │   ├── applypatch-msg.sample</span><br><span class="line">    │   ├── ......                  <span class="comment"># 省略</span></span><br><span class="line">    │   └── update.sample</span><br><span class="line">    ├── info</span><br><span class="line">    │   └── exclude</span><br><span class="line">    ├── objects</span><br><span class="line">    │   ├── info</span><br><span class="line">    │   └── pack</span><br><span class="line">    └── refs</span><br><span class="line">        ├── heads</span><br><span class="line">        └── tags</span><br></pre></td></tr></table></figure><p>git 初始化时，实际上是在仓库下创建了一个 <code>.git</code> 目录的隐藏目录，以及一些默认的文件：</p><ul><li><code>HEAD</code>: <code>HEAD</code> 指针，指向当前的操作分支，具体看 <a href="./git-refs.md#HEAD">HEAD</a>。</li><li><code>config</code>: 存储的本地仓库的配置，具体看 <a href="./git-config.md">git 的配置说明</a>。</li><li><code>description</code>: 用来存储仓库名称以及仓库的描述信息。具体看 <a href="./git-internal-files.md#.git/description">./git/description</a>。</li><li><code>hooks/*</code>: git 钩子，git 钩子可以做非常有用的事情，也是构建 git 工作流中不可或缺的部分。具体看 <a href="./git-hooks.md">git 钩子</a>。</li><li><code>info/exclude</code>: 该文件的功能和 <a href="./git-internal-files.md#.gitignore">.gitignore</a> 一样，都是配置 git 忽略本地文件。</li><li><code>objects/*</code>: git 的底层对象，具体看 <a href="./git-internal-objects.md">git 底层对象</a>。</li><li><code>refs/heads</code> 和 <code>refs/tags</code> : git 引用，实现了git 的分支策略，具体看 <a href="./git-refs.md">git 引用</a>。</li></ul><blockquote><p>实际上还有更多不常用的文件和目录，更详细的细节可以查阅：<a href="https://github.com/git/git/blob/master/Documentation/gitrepository-layout.txt">Git Repository Layout</a>。</p></blockquote><h3 id="0x02-添加一个文件"><a href="#0x02-添加一个文件" class="headerlink" title="0x02 添加一个文件"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0x02</span> 添加一个文件</h3><p>使用 <code>git add</code> 命令把当前工作区的变更提交到暂存区：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文件</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;git-inside&quot;</span> &gt; file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把文件添加到暂存区中</span></span><br><span class="line">$ git add file.txt</span><br></pre></td></tr></table></figure><p>此时查看 <code>.git/</code> 工作目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85</span><br></pre></td></tr></table></figure><p>可以看到新生成了一个 git 对象，路径为<code>.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85</code>。</p><p>git 对象的文件路径和名称根据文件内容的 <a href="https://en.wikipedia.org/wiki/SHA-1">sha1</a> 值决定，取 sha1 值的第一个字节的 hex 值为目录，其他字节的 hex 值为名称。这里使用这种方式存储 Git 对象有 2 个好处：</p><ul><li>对 Git 对象做完整性校验。</li><li>快速遍历/查找 Git 对象。</li></ul><p>为了减少存储大小，<strong>git 对象都是使用 <a href="http://zlib.net/">zlib</a> 压缩存储的</strong>。git 对象的详细说明可以参考这里：<a href="./git-internal-objects.md">git 对象</a> 。git 提供了 <a href="./git-internal-commands.md#git-cat-file">cat-file</a> 命令用来格式化查看 git 对象内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 git 对象内容</span></span><br><span class="line">$ git cat-file -p 6fb38b7118b554886e96fa736051f18d63a80c85</span><br><span class="line">git-inside</span><br><span class="line"><span class="comment"># 查看 git 对象类型</span></span><br><span class="line">$ git cat-file -t 6fb38b7118b554886e96fa736051f18d63a80c85</span><br><span class="line">blob</span><br></pre></td></tr></table></figure><p>可以看到 <code>6fb38b7</code>（上述 git 对象的 sha1 值简写） 对象类型为 <code>blob</code> 对象，<code>blob</code> 对象存储变更文件的内容快照。</p><blockquote><p>根据 sha1 的散列特性，使用 sha1 的前 7 个字符就基本可以表示该 sha1 值。Github、Gitlab 也一样。</p></blockquote><p>此时查看 <code>.git/</code> 目录下，会新增一个 index 文件（索引文件）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file .git/index</span><br><span class="line">.git/index: Git index, version 2, 1 entries</span><br></pre></td></tr></table></figure><p><code>index</code> 文件存储暂存区的文件列表，<code>index</code>文件代表了 git 的一个重要的概念：暂存区。<code>index</code> 文件的详细说明可以查看 <a href="./git-internal-objects.md#%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6">索引文件</a> 。<br><code>index</code> 文件使用二进制方式存储暂存区信息，通过 git 提供的 <a href="./git-internal-commands.md#git-ls-files">ls-file</a> 底层命令可以查看索引文件的格式化输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -t</span><br><span class="line">H file.txt</span><br></pre></td></tr></table></figure><blockquote><p>有兴趣的同学可以使用 <code>hexdump -C</code> 命令查看索引文件的二进制内容。</p></blockquote><h3 id="0x03-提交到本地版本库"><a href="#0x03-提交到本地版本库" class="headerlink" title="0x03 提交到本地版本库"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0x03</span> 提交到本地版本库</h3><p>使用 <code>git commit</code> 命令可以把暂存区的变动提交到本地版本库中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">[master (root-commit) 523d41c] first commit</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file.txt</span><br></pre></td></tr></table></figure><blockquote><p>其中 <code>100644</code> 是指的文件模式，<code>100644</code> 表明这是一个普通文件。 其他情况比如 <code>100755</code> 表示可执行文件，<code>120000</code> 表示符号链接。</p></blockquote><blockquote><p>如果你是边阅读本文边动手操作，那你会发现生成的 commit 对象的 sha1 值跟本文不一致，因为提交日期以及用户名邮箱是不一样的，可以点击这里 <a href="#LhzBD">设置固定的时间日期、用户名和邮箱</a>，这样提交的对象就会是一样的 sha1值，也方便阅读本文。</p></blockquote><p>查看 <code>.git/objects</code> 目录下，会新增 2 个 git 对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/41/20b5f61a582cb12d4dcdaab71c7ef1862dbbca</span><br><span class="line">.git/objects/52/3d41ce82ea993e7c7df8be1292b2eac84d4659</span><br><span class="line">.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85</span><br></pre></td></tr></table></figure><p>分别是 <code>523d41c</code> 和 <code>4120b5f</code> 。</p><p>使用 <code>git cat-file</code> 可以看到 2 个 对象的类型和内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 523d41c 是一个 commit 对象</span></span><br><span class="line">$ git cat-file -t 523d41c</span><br><span class="line">commit</span><br><span class="line">$ git cat-file -p 523d41c</span><br><span class="line">tree 4120b5f61a582cb12d4dcdaab71c7ef1862dbbca</span><br><span class="line">author xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line">committer xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line"></span><br><span class="line">first commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4120b5f 是一个 tree 对象</span></span><br><span class="line">$ git cat-file -t 4120b5f</span><br><span class="line">commit</span><br><span class="line">$ git cat-file -p 4120b5f</span><br><span class="line">100644 blob 6fb38b7118b554886e96fa736051f18d63a80c85file.txt</span><br></pre></td></tr></table></figure><blockquote><p>也可以使用 <code>git cat-file -p 523d41c^&#123;tree&#125;</code> 来查看 <code>4120b5f</code> 的内容，<code>523d41c^&#123;tree&#125;</code> 和 <code>4120b5f</code> 是等效的，更多请查看 <a href="./git-revisions.md">git revisions</a>。</p></blockquote><p>这里新出现了 2 种新的 git 对象类型，分别是 <code>tree</code> 对象（<code>523d41c</code>） 和 <code>commit</code> 对象（<code>4120b5f</code>），tree 对象用来记录目录结构和 blob 对象索引，commit 对象包含着指向前述 tree 对象的指针和所有提交信息。</p><p>操作到这里，git 的底层对象一共生成了 3 个，分别是：</p><ul><li><code>6fb38b7</code>: blob 对象。</li><li><code>4120b5f</code>: tree 对象，指向 <code>6fb38b7</code>。</li><li><code>523d41c</code>: commit 对象，指向 <code>4120b5f</code>。</li></ul><p>他们之间的关系是：<br><img src="https://img.alicdn.com/tfs/TB1UzBK4XP7gK0jSZFjXXc5aXXa-1818-608.png"></p><h3 id="0x04-提交第二个版本"><a href="#0x04-提交第二个版本" class="headerlink" title="0x04 提交第二个版本"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0x04</span> 提交第二个版本</h3><p>我们继续提交代码和文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;append content&quot;</span> &gt;&gt; file.txt</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;git&quot;</span> &gt; README.md</span><br><span class="line">$ mkdir doc &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;v0.0.1&quot;</span> &gt; doc/changelog</span><br><span class="line">$ git add -A</span><br><span class="line">$ git commit -m <span class="string">&quot;second commit&quot;</span></span><br><span class="line">[master a0e96b5] second commit</span><br><span class="line"> 3 files changed, 3 insertions(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"> create mode 100644 doc/changelog</span><br></pre></td></tr></table></figure><p>该提交为 <code>file.txt</code> 添加了内容，同时新增了子目录：<code>doc/</code>，并新增了 <code>README.md</code> 和 <code>doc/changelog</code> 2个文件。<br>查看 git 对象列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f | sort</span><br><span class="line">.git/objects/10/da3741b6e365b6795335e1e2d3ed5820e794cd      <span class="comment"># tree | 第二次提交</span></span><br><span class="line">.git/objects/39/fb0fbcac51f66b514fbd589a5b2bc0809ce664      <span class="comment"># tree: doc/ | 第二次提交</span></span><br><span class="line">.git/objects/41/20b5f61a582cb12d4dcdaab71c7ef1862dbbca      <span class="comment"># tree | 第一次提交</span></span><br><span class="line">.git/objects/45/c7a584f300657dba878a542a6ab3b510b63aa3      <span class="comment"># blob | changelog</span></span><br><span class="line">.git/objects/52/3d41ce82ea993e7c7df8be1292b2eac84d4659      <span class="comment"># commit | 第一次提交</span></span><br><span class="line">.git/objects/56/64e303b5dc2e9ef8e14a0845d9486ec1920afd      <span class="comment"># blob | README.md</span></span><br><span class="line">.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85      <span class="comment"># blob | 第一次提交 | file.txt</span></span><br><span class="line">.git/objects/a0/e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0      <span class="comment"># commit | 第二次提交</span></span><br><span class="line">.git/objects/ae/c2e48cbf0a881d893ccdd9c0d4bbaf011b5b23      <span class="comment"># blob | 第二次提交 | file.txt</span></span><br></pre></td></tr></table></figure><p>可以看到除了原先的 <code>6fb38b7</code>、<code>4120b5f</code>、<code>523d41c</code>，又新增了：</p><ul><li><code>10da374</code>: tree 对象，指向 <code>README.md</code> ( <code>5664e30</code> ) 、<code>file.txt</code> ( <code>aec2e48</code> )、<code>doc/</code> ( <code>39fb0fb</code> )。</li><li><code>39fb0fb</code>: tree 对象，指向 <code>changelog</code> ( <code>45c7a58</code> )。</li><li><code>45c7a58</code>: blob 对象， 存储 <code>changelog</code> 内容快照。</li><li><code>5664e30</code>: blob 对象，存储 <code>README.md</code> 内容快照。</li><li><code>a0e96b5</code>: commit 对象，指向 <code>10da374</code>、<code>523d41c</code>。</li><li><code>aec2e48</code>: blob 对象，存储更改的 <code>file.txt</code> 内容快照。</li></ul><p>查看新增的 2 个 tree 对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 10da374</span><br><span class="line">100644 blob 5664e303b5dc2e9ef8e14a0845d9486ec1920afdREADME.md</span><br><span class="line">040000 tree 39fb0fbcac51f66b514fbd589a5b2bc0809ce664doc</span><br><span class="line">100644 blob aec2e48cbf0a881d893ccdd9c0d4bbaf011b5b23file.txt</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 39fb0fb</span><br><span class="line">100644 blob 45c7a584f300657dba878a542a6ab3b510b63aa3changelog</span><br></pre></td></tr></table></figure><p>这里有必要说明一下，Git 使用 tree 对象来存储目录结构，不同的目录对应不同的 tree 对象，这次提交里面，顶层目录对应的 tree 是 <code>10da374</code>，<code>doc/</code> 目录对应的 tree 是 <code>39fb0fb</code>。</p><p>继续查看 commit 对象 <code>a0e96b5</code> 内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p a0e96b5</span><br><span class="line">tree 10da3741b6e365b6795335e1e2d3ed5820e794cd</span><br><span class="line">parent 523d41ce82ea993e7c7df8be1292b2eac84d4659</span><br><span class="line">author xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line">committer xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line"></span><br><span class="line">second commit</span><br></pre></td></tr></table></figure><p>仔细的同学会发现，<code>a0e96b5</code> 跟第一次提交生成的 commit 对象（<code>523d41c</code>）相比，多了一个 <code>parent</code> 字段。<code>parent</code> 字段是用来指向上一次提交的，一般是1个 parent ，有些情况下会是多个 parent ，比如 merge 这种情况。</p><p>我们再总结一下这些对象之间的关系：<br><img src="https://img.alicdn.com/tfs/TB17QMC4oY1gK0jSZFCXXcwqXXa-2748-1654.png"></p><p>如图所示，每一次提交可以是一个文件，也可以是多个文件和多个目录，一次提交就是一次版本（ <a href="./git-revisions.md">revision</a> ）。<br>同时这里又引申出来了 git 的一个非常重要的概念，每一次新的提交都会指向上一个提交，这样多个提交就组成了一个提交链。这个提交链使用到了一个非常有名的算法：<a href="https://baike.baidu.com/item/%E6%A2%85%E5%85%8B%E5%B0%94%E6%A0%91/22456281">merkle tree</a>，感兴趣的同学可以去深入了解，这里就不深入讲解了。<code>merkle tree</code> 有一个重要的特性就是单独更改其中一个节点的内容就会破坏掉这个tree，也就是说 <code>merkle tree</code> 的节点是不可更改的。git 就是通过 <code>merkle tree</code> 来保证每个版本都是连续有效的。</p><blockquote><p>这就是为什么很难修改 git 的历史提交记录的原因，如果要修改某一个提交，那同时还需要修改这个提交之后的所有提交，这样才能保证 <code>merkle tree</code> 是有效成立的。<br>另外，区块链也是基于 <code>merkle tree</code> 来保证数据可靠性的。</p></blockquote><p>可以猜想一下，如果继续提交代码，那 git 对象会是如下的关系：</p><p><img src="https://img.alicdn.com/tfs/TB1U3NZuP39YK4jSZPcXXXrUFXa-2140-1356.png"></p><p>按照先后时间顺序单独看 <code>commit</code> 对象之间的关系：</p><div align="center"><img src="https://img.alicdn.com/tfs/TB1LU0F4kL0gK0jSZFAXXcA9pXa-496-208.png" width=200 /></div> <p>这个 <code>commit</code> 对象关系图非常重要，git 分支策略就是围绕着这个关系图来运作的，这里暂且不做展开。</p><h3 id="0x05-打标签"><a href="#0x05-打标签" class="headerlink" title="0x05 打标签"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0x05</span> 打标签</h3><p>上面的操作涉及了 3 种 git 对象，分别是 <code>blob</code>、<code>tree</code>、<code>commit</code> 对象，其实 git 还存在一个 <code>tag</code> 类型的对象，用来存储带注释的标签。<br>使用如下命令创建标签：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ git tag <span class="string">&quot;v0.0.2&quot;</span> -m <span class="string">&quot;this is annotated tag&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 git 对象和引用</span></span><br><span class="line">$ find .git/objects -<span class="built_in">type</span> f | sort</span><br><span class="line">.git/objects/03/2ddd9205d65abd773af1610038c764f46a0b12      <span class="comment"># tag</span></span><br><span class="line">.git/objects/10/da3741b6e365b6795335e1e2d3ed5820e794cd      <span class="comment"># tree | 第二次提交</span></span><br><span class="line">.git/objects/39/fb0fbcac51f66b514fbd589a5b2bc0809ce664      <span class="comment"># tree: doc/ | 第二次提交</span></span><br><span class="line">.git/objects/41/20b5f61a582cb12d4dcdaab71c7ef1862dbbca      <span class="comment"># tree | 第一次提交</span></span><br><span class="line">.git/objects/45/c7a584f300657dba878a542a6ab3b510b63aa3      <span class="comment"># blob | changelog</span></span><br><span class="line">.git/objects/52/3d41ce82ea993e7c7df8be1292b2eac84d4659      <span class="comment"># commit | 第一次提交</span></span><br><span class="line">.git/objects/56/64e303b5dc2e9ef8e14a0845d9486ec1920afd      <span class="comment"># blob | README.md</span></span><br><span class="line">.git/objects/6f/b38b7118b554886e96fa736051f18d63a80c85      <span class="comment"># blob | 第一次提交 | file.txt</span></span><br><span class="line">.git/objects/a0/e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0      <span class="comment"># commit | 第二次提交</span></span><br><span class="line">.git/objects/ae/c2e48cbf0a881d893ccdd9c0d4bbaf011b5b23      <span class="comment"># blob | 第二次提交 | file.txt</span></span><br><span class="line"></span><br><span class="line">$ tree .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">├── heads</span><br><span class="line">│   └── master</span><br><span class="line">└── tags</span><br><span class="line">    └── v0.0.2                                      <span class="comment"># tag 引用</span></span><br></pre></td></tr></table></figure><p>此时新增了一个 <code>032ddd9</code> 的对象，同时在 <code>.git/refs/</code> 中增加了名为 <code>v0.0.2</code> 的标签。使用如下命令查看他们的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 v0.0.2 的内容</span></span><br><span class="line">$ cat .git/refs/tags/v0.0.2</span><br><span class="line">032ddd9205d65abd773af1610038c764f46a0b12</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 032ddd9 的类型</span></span><br><span class="line">$ git cat-file -t 032ddd9</span><br><span class="line">tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 032ddd9 的内容</span></span><br><span class="line">$ git cat-file -p 032ddd9</span><br><span class="line">object a0e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v0.0.2</span><br><span class="line">tagger xiaowenxia &lt;775117471@qq.com&gt; 1606913178 +0800</span><br><span class="line"></span><br><span class="line">this is annotated tag</span><br></pre></td></tr></table></figure><p><code>.git/refs/tags/v0.0.2</code> 是 Git 的一个重要的概念：<a href="./git-refs.md">引用</a>。这个引用实际上是一个指针，内容为 <code>032ddd9</code> 的 sha1 值，代表指向 <code>032ddd9</code> 。而 <code>032ddd9</code> 是一个 tag 对象，指向第二次提交的 commit 对象：<code>a0e96b5</code>。</p><p>tag 对象相对比较独立，不参与构建文件系统，只是单纯的存储信息。</p><h3 id="0xFF-总结"><a href="#0xFF-总结" class="headerlink" title="0xFF 总结"></a><span style="color: #41B883; border-left:4px solid #41B883; padding-left: 5px; padding-right: 5px">0xFF</span> 总结</h3><p>到这里其实应该已经对 Git 底层对象有一个深刻的了解了。从根本上来讲，git 底层实际上是由一个个对象（object）组成的，git 底层对象分为4种：</p><ul><li><strong>blob 对象</strong>：保存着文件快照，数据结构参考： <a href="https://github.com/xiaowenxia/git-first-commit#blob-%E5%AF%B9%E8%B1%A1">blob 对象</a>。</li><li><strong>tree 对象</strong>：记录着目录结构和 blob 对象索引，其数据结构参考： <a href="https://github.com/xiaowenxia/git-first-commit#tree-%E5%AF%B9%E8%B1%A1">tree 对象</a>。</li><li><strong>commit 对象</strong>：包含着指向前述 tree 对象的指针和所有提交信息，数据结构参考：<a href="https://github.com/xiaowenxia/git-first-commit#commit-%E5%AF%B9%E8%B1%A1">commit 对象</a>。</li><li><strong>tag 对象</strong>：记录带注释的 tag 。</li></ul><p>一个仓库里面的所有 Git 对象会组成一个图（Graph），按照指向关系可以简单的这么理解：<code>refs</code> –&gt; <code>tag 对象 </code> –&gt; <code>commit 对象</code> –&gt; <code>tree 对象</code> –&gt; <code>blob 对象</code>，对象之间通过对方的 sha1 值来确定指向关系，所以要是篡改了对象的内容，那指向关系就会被破坏掉，<a href="https://git-scm.com/docs/git-fsck"><code>git fsck</code></a> 命令就会提示 <code>&quot;hash mismatch&quot;</code> 。所以这也是 Git 对象的文件存储结构里面并没有自身数据的校验（checksum）字段的原因。</p><p>值得一提的是，git 社区正在积极推进 <a href="https://en.wikipedia.org/wiki/SHA-256">sha256</a> 的方案，sha1 目前来看并不是绝对安全的，因为 <a href="https://shattered.io/">HAttered attack</a> 这种攻击方式能够伪造相同 sha1 值。</p><p>最后，我们用一张图来总结上述的一系列步骤生成的对象之间的关系：</p><p><img src="https://img.alicdn.com/tfs/TB1g9ID4oY1gK0jSZFMXXaWcVXa-2868-1380.png"></p><h5 id="git-对象的相关命令"><a href="#git-对象的相关命令" class="headerlink" title="git 对象的相关命令"></a>git 对象的相关命令</h5><p>git 擅长的一点是提供了很多丰富抽象的子命令来操作这些 git 对象，比如上面的一系列操作：</p><ul><li><code>git add</code>：实际上是把当前工作区的文件快照保存下来，产出是 blob 对象。</li><li><code>git commit</code>：保存暂存区的文件层级关系和提交者信息，产出是 tree 对象 和 commit 对象。</li><li><code>git tag -m</code>：保存 tag 标签的信息，产出是 tag 对象。</li></ul><p>这些是上层命令，实际上 git 还提供了非常丰富的底层命令用来操作对象：</p><ul><li><a href="https://git-scm.com/docs/git-hash-object"><code>git-hash-object</code></a>：把输入内容存储成 blob 对象。</li><li><a href="https://git-scm.com/docs/git-cat-file"><code>git-cat-file</code></a>：读取并格式化输出对象。</li><li><a href="https://git-scm.com/docs/git-count-objects"><code>git-count-objects</code></a>：计算对象数量。</li><li><a href=""><code>git-write-tree</code></a>：把存储区的文件结构存储成 tree 对象。</li><li><a href="https://git-scm.com/docs/git-read-tree"><code>git-read-tree</code></a>：把 tree 对象读取到暂存区。</li><li><a href="https://git-scm.com/docs/git-commit-tree"><code>git-commit-tree</code></a>：根据输入信息（tree、父提交、author、commiter、日期等）存储成 commit 对象。</li><li><a href="https://git-scm.com/docs/git-ls-tree"><code>git-ls-tree</code></a>：读取并格式化输出 tree 对象。</li><li><a href="https://git-scm.com/docs/git-mktag"><code>git-mktag</code></a>：把输入内容存储成 tag 对象。</li><li><a href="https://git-scm.com/docs/git-mktree"><code>git-mktree</code></a>：根据输入（<code>ls-tree</code>的输出格式）来生成 tree 对象。</li><li><a href="https://git-scm.com/docs/git-fsck"><code>git-fsck</code></a>：校验对象链表的正确性和有效性。</li><li><a href="https://git-scm.com/docs/git-diff-tree"><code>git-diff-tree</code></a>：比较 2 个tree 对象 的差异并格式化输出。</li></ul><p><a name="LhzBD"></a></p><h5 id="设置固定的时间日期、用户名和邮箱"><a href="#设置固定的时间日期、用户名和邮箱" class="headerlink" title="设置固定的时间日期、用户名和邮箱"></a>设置固定的时间日期、用户名和邮箱</h5><p>本文中的示例都设置了固定的时间日期、用户名和邮箱，如果你是边阅读本文边动手操作，可以如下执行 <code>git commit</code> 或者 <code>git tag</code> ，这样生成的对象hash值和本文中的是一致的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git commit</span></span><br><span class="line">$ GIT_AUTHOR_DATE=<span class="string">&quot;1606913178 +0800&quot;</span> GIT_AUTHOR_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_AUTHOR_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span> GIT_COMMITTER_DATE=<span class="string">&quot;1606913178 +0800&quot;</span>  GIT_COMMITTER_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_COMMITTER_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span> git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git tag</span></span><br><span class="line">$ GIT_AUTHOR_DATE=<span class="string">&quot;1606913178 +0800&quot;</span> GIT_AUTHOR_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_AUTHOR_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span> GIT_COMMITTER_DATE=<span class="string">&quot;1606913178 +0800&quot;</span>  GIT_COMMITTER_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_COMMITTER_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span> git tag <span class="string">&quot;v0.0.2&quot;</span> -m <span class="string">&quot;this is annotated tag&quot;</span></span><br></pre></td></tr></table></figure><p>或者可以使用 <code>export</code> 设置为全局的环境变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GIT_AUTHOR_DATE=<span class="string">&quot;1606913178 +0800&quot;</span> GIT_AUTHOR_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_AUTHOR_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span> GIT_COMMITTER_DATE=<span class="string">&quot;1606913178 +0800&quot;</span> GIT_COMMITTER_NAME=<span class="string">&quot;xiaowenxia&quot;</span> GIT_COMMITTER_EMAIL=<span class="string">&quot;775117471@qq.com&quot;</span></span><br></pre></td></tr></table></figure><h5 id="下载本文创建的-git-仓库"><a href="#下载本文创建的-git-仓库" class="headerlink" title="下载本文创建的 git 仓库"></a>下载本文创建的 git 仓库</h5><p><a href="https://aos-app-dev.oss-cn-shanghai.aliyuncs.com/git-inside.tar.gz">点击下载</a>本文中创建的仓库。</p><h5 id="git-draw"><a href="#git-draw" class="headerlink" title="git-draw"></a>git-draw</h5><p>这里有一个很有趣的工具：<a href="https://github.com/sensorflo/git-draw">git-draw</a>，这个工具会绘制 git 仓库的所有 Git 对象和引用的关系。下图使用 <code>git-draw</code> 绘制了本文的仓库：</p><p><img src="https://img.alicdn.com/imgextra/i4/O1CN013r001V1zJRVp9ETDH_!!6000000006693-55-tps-1412-824.svg"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://git-scm.com/book/en/v2/Git-Internals-Git-Objects">https://git-scm.com/book/en/v2/Git-Internals-Git-Objects</a></li><li><a href="https://maryrosecook.com/blog/post/git-from-the-inside-out">https://maryrosecook.com/blog/post/git-from-the-inside-out</a></li><li><a href="https://matthew-brett.github.io/curious-git/git_object_types.html">https://matthew-brett.github.io/curious-git/git_object_types.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-底层原理：Git-对象&quot;&gt;&lt;a href=&quot;#Git-底层原理：Git-对象&quot; class=&quot;headerlink&quot; title=&quot;Git 底层原理：Git 对象&quot;&gt;&lt;/a&gt;Git 底层原理：Git 对象&lt;/h2&gt;&lt;p&gt;git 实际上是一个内容文件系统，载</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 常用命令底层原理</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/11/24/git-internal-operations/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/11/24/git-internal-operations/</id>
    <published>2020-11-24T02:28:13.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-常用命令底层原理"><a href="#Git-常用命令底层原理" class="headerlink" title="Git 常用命令底层原理"></a>Git 常用命令底层原理</h2><h4 id="git-clone-具体干了些啥？"><a href="#git-clone-具体干了些啥？" class="headerlink" title="git clone 具体干了些啥？"></a>git clone 具体干了些啥？</h4><h4 id="git-push-具体干了些啥？"><a href="#git-push-具体干了些啥？" class="headerlink" title="git push 具体干了些啥？"></a>git push 具体干了些啥？</h4><h4 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h4><p>从 HEAD 开始显示历史的提交。</p><h4 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h4><p>当前工作目录和 HEAD 做对比</p><h4 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h4><p>显示当前工作目录和 HEAD 的文件差异，<code>--cached</code> 选项用来比较暂存区的文件 和 HEAD指向的文件。</p><h4 id="git-mv-和-git-rm"><a href="#git-mv-和-git-rm" class="headerlink" title="git mv 和 git rm"></a>git mv 和 git rm</h4><p>移动或者删除文件，该操作和 git add 类似。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-常用命令底层原理&quot;&gt;&lt;a href=&quot;#Git-常用命令底层原理&quot; class=&quot;headerlink&quot; title=&quot;Git 常用命令底层原理&quot;&gt;&lt;/a&gt;Git 常用命令底层原理&lt;/h2&gt;&lt;h4 id=&quot;git-clone-具体干了些啥？&quot;&gt;&lt;a hre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 引用</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/11/02/git-refs/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/11/02/git-refs/</id>
    <published>2020-11-02T07:09:43.000Z</published>
    <updated>2021-02-16T07:00:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-引用"><a href="#Git-引用" class="headerlink" title="Git 引用"></a>Git 引用</h2><p>Git 引用本质上是指向特定的 commit 对象，git 默认情况下都会有一个 master 引用，指向一个默认的分支。</p><blockquote><p>github 上已经把默认的分支从 <code>master</code> 改成了 <code>main</code> 分支。</p></blockquote><p>Git 还存在一个 <code>HEAD</code> 引用，代表当前工作的 tree。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git&#x2F;refs</span><br><span class="line">.git&#x2F;refs</span><br><span class="line">├── heads</span><br><span class="line">│   └── master</span><br><span class="line">├── merge-requests</span><br><span class="line">│   └── 267123</span><br><span class="line">│       └── head</span><br><span class="line">├── remotes</span><br><span class="line">│   └── origin</span><br><span class="line">│       └── HEAD</span><br><span class="line">└── tags</span><br></pre></td></tr></table></figure><p>heads<br>merge-requests</p><p>gerrit</p><p>remotes</p><p>tags</p><h3 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h3><p>HEAD是一个指针，指向当前的操作分支。</p><p>使用 <code>cat .git/HEAD</code> 命令可以查看 <code>HEAD</code> 内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/main</span><br></pre></td></tr></table></figure><p>HEAD有很多方便的用法，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前分支的日志</span></span><br><span class="line">$ git <span class="built_in">log</span> HEAD</span><br><span class="line"><span class="comment"># 恢复上一次提交到工作区</span></span><br><span class="line">$ git reset HEAD^</span><br></pre></td></tr></table></figure><p>同时，<code>HEAD</code> 作为 <a href="./git-revisions.md">revisions</a> 时，也有很多奇妙的用法，比如 <code>HEAD^</code> 代表上一次提交、<code>HEAD~6</code> 代表往回追溯6个版本的那个提交等。</p><p>FETCH_HEAD<br>存储每个分支最后一次和服务器通信的最后的 commit-id<br>ORIG_HEAD<br>同步当前分支和远程分支的最后的 commit-id<br>COMMIT_EDITMSG<br>最后一次 commit 时的注释</p><h3 id="git-describe"><a href="#git-describe" class="headerlink" title="git describe"></a>git describe</h3><blockquote><p>参考：<a href="https://git-scm.com/docs/git-describe">https://git-scm.com/docs/git-describe</a></p></blockquote><p>git 的 describe 命令是用来给一个 refs 添加方面阅读的描述信息，<br>git-describe - Give an object a human readable name based on an available ref</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-引用&quot;&gt;&lt;a href=&quot;#Git-引用&quot; class=&quot;headerlink&quot; title=&quot;Git 引用&quot;&gt;&lt;/a&gt;Git 引用&lt;/h2&gt;&lt;p&gt;Git 引用本质上是指向特定的 commit 对象，git 默认情况下都会有一个 master 引用，指向一</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 的分支策略</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/26/git-branch/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/26/git-branch/</id>
    <published>2020-10-26T06:09:09.000Z</published>
    <updated>2021-02-16T04:45:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-的分支策略"><a href="#Git-的分支策略" class="headerlink" title="Git 的分支策略"></a>Git 的分支策略</h2><h3 id="git-的一些分支命令，具体做了哪些事情？"><a href="#git-的一些分支命令，具体做了哪些事情？" class="headerlink" title="git 的一些分支命令，具体做了哪些事情？"></a>git 的一些分支命令，具体做了哪些事情？</h3><h4 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h4><h4 id="git-branch-b"><a href="#git-branch-b" class="headerlink" title="git branch -b"></a>git branch -b</h4><h4 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h4><h4 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h4><h4 id="git-pull-push"><a href="#git-pull-push" class="headerlink" title="git pull/push"></a>git pull/push</h4><h4 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h4><h4 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h4><h4 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-的分支策略&quot;&gt;&lt;a href=&quot;#Git-的分支策略&quot; class=&quot;headerlink&quot; title=&quot;Git 的分支策略&quot;&gt;&lt;/a&gt;Git 的分支策略&lt;/h2&gt;&lt;h3 id=&quot;git-的一些分支命令，具体做了哪些事情？&quot;&gt;&lt;a href=&quot;#git-</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 术语</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/25/git-glossary/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/25/git-glossary/</id>
    <published>2020-10-25T14:50:02.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-术语"><a href="#Git-术语" class="headerlink" title="Git 术语"></a>Git 术语</h2><blockquote><p>翻译自 <a href="https://git-scm.com/docs/gitglossary">Git Glossary</a>。</p></blockquote><h4 id="alternate-object-database"><a href="#alternate-object-database" class="headerlink" title="alternate object database"></a>alternate object database</h4><p>Via the alternates mechanism, a repository can inherit part of its object database from another object database, which is called an “alternate”.</p><h4 id="bare-repository"><a href="#bare-repository" class="headerlink" title="bare repository"></a>bare repository</h4><p>空仓库，刚初始化完的仓库。</p><h4 id="blob-object"><a href="#blob-object" class="headerlink" title="blob object"></a>blob object</h4><p>数据对象，存储当前版本下的文件内容。</p><h4 id="branch"><a href="#branch" class="headerlink" title="branch"></a>branch</h4><p>分支，代表当前时间线的开发代码。</p><h4 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h4><p>git 初期的叫法，现在叫索引（index）。</p><h4 id="chain"><a href="#chain" class="headerlink" title="chain"></a>chain</h4><p>commit 链，这些链则组成一个个分支。</p><h4 id="changeset"><a href="#changeset" class="headerlink" title="changeset"></a>changeset</h4><p>BitKeeper/cvsps 对 提交（commit）的叫法。</p><h4 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h4><p>从 git 文件系统中检出对应的版本或文件到工作目录，如果检出的是分支则会更新索引（index）和 HEAD。</p><h4 id="cherry-picking"><a href="#cherry-picking" class="headerlink" title="cherry-picking"></a>cherry-picking</h4><p>提取某些 commit 到当前分支。</p><h4 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h4><p>清理当前工作区。</p><h4 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h4><p>提交。</p><h4 id="commit-object"><a href="#commit-object" class="headerlink" title="commit object"></a>commit object</h4><p>一次提交会生成一份 commit 对象，该对象包括committer、 author、date、 tree-id 等信息。</p><h4 id="commit-ish-also-committish"><a href="#commit-ish-also-committish" class="headerlink" title="commit-ish (also committish)"></a>commit-ish (also committish)</h4><p>A commit object or an object that can be recursively dereferenced to a commit object. The following are all commit-ishes: a commit object, a tag object that points to a commit object, a tag object that points to a tag object that points to a commit object, etc.</p><h4 id="core-Git"><a href="#core-Git" class="headerlink" title="core Git"></a>core Git</h4><p>git 底层的数据结构和对象，以及很丰富的底层命令。</p><h4 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h4><p>Directed acyclic graph. The commit objects form a directed acyclic graph, because they have parents (directed), and the graph of commit objects is acyclic (there is no chain which begins and ends with the same object).</p><h4 id="dangling-object"><a href="#dangling-object" class="headerlink" title="dangling object"></a>dangling object</h4><p>An unreachable object which is not reachable even from other unreachable objects; a dangling object has no references to it from any reference or object in the repository.</p><h4 id="detached-HEAD"><a href="#detached-HEAD" class="headerlink" title="detached HEAD"></a>detached HEAD</h4><p>Normally the HEAD stores the name of a branch, and commands that operate on the history HEAD represents operate on the history leading to the tip of the branch the HEAD points at. However, Git also allows you to check out an arbitrary commit that isn’t necessarily the tip of any particular branch. The HEAD in such a state is called “detached”.</p><p>Note that commands that operate on the history of the current branch (e.g. git commit to build a new history on top of it) still work while the HEAD is detached. They update the HEAD to point at the tip of the updated history without affecting any branch. Commands that update or inquire information about the current branch (e.g. git branch –set-upstream-to that sets what remote-tracking branch the current branch integrates with) obviously do not work, as there is no (real) current branch to ask about in this state.</p><h4 id="directory"><a href="#directory" class="headerlink" title="directory"></a>directory</h4><p>目录。</p><h4 id="dirty"><a href="#dirty" class="headerlink" title="dirty"></a>dirty</h4><p>工作区有改动没有提交，该工作区则为 <code>dirty</code> 状态。</p><h4 id="evil-merge"><a href="#evil-merge" class="headerlink" title="evil merge"></a>evil merge</h4><p>An evil merge is a merge that introduces changes that do not appear in any parent.</p><h4 id="fast-forward"><a href="#fast-forward" class="headerlink" title="fast-forward"></a>fast-forward</h4><p>A fast-forward is a special type of merge where you have a revision and you are “merging” another branch’s changes that happen to be a descendant of what you have. In such a case, you do not make a new merge commit but instead just update to his revision. This will happen frequently on a remote-tracking branch of a remote repository.</p><h4 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h4><p>从远程仓库拉取最新分支。</p><h4 id="file-system"><a href="#file-system" class="headerlink" title="file system"></a>file system</h4><p>Linus Torvalds 一开始设计 Git 的时候，定位就是一个用户空间的文件系统，然后提供高效的命令和方法用于操作这个文件系统。</p><h4 id="Git-archive"><a href="#Git-archive" class="headerlink" title="Git archive"></a>Git archive</h4><p>对于一些人来讲，这是 repository 的同义词。</p><h4 id="gitfile"><a href="#gitfile" class="headerlink" title="gitfile"></a>gitfile</h4><p>.git 是一个工作区根目录的空文件，指向真正仓库的目录。</p><h4 id="grafts"><a href="#grafts" class="headerlink" title="grafts"></a>grafts</h4><p>Grafts enables two otherwise different lines of development to be joined together by recording fake ancestry information for commits. This way you can make Git pretend the set of parents a commit has is different from what was recorded when the commit was created. Configured via the .git/info/grafts file.</p><p>Note that the grafts mechanism is outdated and can lead to problems transferring objects between repositories; see git-replace[1] for a more flexible and robust system to do the same thing.</p><h4 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h4><p>Git 的对象名称都是对象内容的 hash 值。</p><h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><p>指向分支的最新提交。</p><h4 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h4><p>指向当前分支。</p><h4 id="head-ref"><a href="#head-ref" class="headerlink" title="head ref"></a>head ref</h4><p>head 的别名。</p><h4 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h4><p>git 钩子。</p><h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>索引文件。</p><h4 id="index-entry"><a href="#index-entry" class="headerlink" title="index entry"></a>index entry</h4><p>The information regarding a particular file, stored in the index. An index entry can be unmerged, if a merge was started, but not yet finished (i.e. if the index contains multiple versions of that file).</p><h4 id="master"><a href="#master" class="headerlink" title="master"></a>master</h4><p>git 默认的分支。git 仓库初始化时默认会创建该分支。</p><h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>As a verb: To bring the contents of another branch (possibly from an external repository) into the current branch. In the case where the merged-in branch is from a different repository, this is done by first fetching the remote branch and then merging the result into the current branch. This combination of fetch and merge operations is called a pull. Merging is performed by an automatic process that identifies changes made since the branches diverged, and then applies all those changes together. In cases where changes conflict, manual intervention may be required to complete the merge.</p><p>As a noun: unless it is a fast-forward, a successful merge results in the creation of a new commit representing the result of the merge, and having as parents the tips of the merged branches. This commit is referred to as a “merge commit”, or sometimes just a “merge”.</p><h4 id="object"><a href="#object" class="headerlink" title="object"></a>object</h4><p>git 的 存储单元，git 的底层文件系统都是一个个对象，包括 blob 对象、tree 对象、commit 对象、tag 对象等。</p><h4 id="object-database"><a href="#object-database" class="headerlink" title="object database"></a>object database</h4><p>存储一组对象。</p><h4 id="object-identifier"><a href="#object-identifier" class="headerlink" title="object identifier"></a>object identifier</h4><p>和 <code>object name</code> 一样。</p><h4 id="object-name"><a href="#object-name" class="headerlink" title="object name"></a>object name</h4><p>对象的名称即对象的 hash 值。</p><h4 id="object-type"><a href="#object-type" class="headerlink" title="object type"></a>object type</h4><p>对象类型，分别有 “commit”, “tree”, “tag”, “blob”。</p><h4 id="octopus"><a href="#octopus" class="headerlink" title="octopus"></a>octopus</h4><p>merge 超过 2 个分支。</p><h4 id="origin"><a href="#origin" class="headerlink" title="origin"></a>origin</h4><p>上游默认仓库。</p><h4 id="overlay"><a href="#overlay" class="headerlink" title="overlay"></a>overlay</h4><p>Only update and add files to the working directory, but don’t delete them, similar to how cp -R would update the contents in the destination directory. This is the default mode in a checkout when checking out files from the index or a tree-ish. In contrast, no-overlay mode also deletes tracked files not present in the source, similar to rsync –delete.</p><h4 id="pack"><a href="#pack" class="headerlink" title="pack"></a>pack</h4><p>用于压缩存储一组对象。</p><h4 id="pack-index"><a href="#pack-index" class="headerlink" title="pack index"></a>pack index</h4><p>压缩存储一组对象时，使用 <code>pack index</code> 存储对象的索引和信息。</p><h4 id="pathspec"><a href="#pathspec" class="headerlink" title="pathspec"></a>pathspec</h4><p>Pattern used to limit paths in Git commands.</p><p>Pathspecs are used on the command line of “git ls-files”, “git ls-tree”, “git add”, “git grep”, “git diff”, “git checkout”, and many other commands to limit the scope of operations to some subset of the tree or worktree. See the documentation of each command for whether paths are relative to the current directory or toplevel. The pathspec syntax is as follows:</p><p>any path matches itself</p><p>the pathspec up to the last slash represents a directory prefix. The scope of that pathspec is limited to that subtree.</p><p>the rest of the pathspec is a pattern for the remainder of the pathname. Paths relative to the directory prefix will be matched against that pattern using fnmatch(3); in particular, * and ? can match directory separators.</p><p>For example, Documentation/*.jpg will match all .jpg files in the Documentation subtree, including Documentation/chapter_1/figure_1.jpg.</p><p>A pathspec that begins with a colon : has special meaning. In the short form, the leading colon : is followed by zero or more “magic signature” letters (which optionally is terminated by another colon :), and the remainder is the pattern to match against the path. The “magic signature” consists of ASCII symbols that are neither alphanumeric, glob, regex special characters nor colon. The optional colon that terminates the “magic signature” can be omitted if the pattern begins with a character that does not belong to “magic signature” symbol set and is not a colon.</p><p>In the long form, the leading colon : is followed by an open parenthesis (, a comma-separated list of zero or more “magic words”, and a close parentheses ), and the remainder is the pattern to match against the path.</p><p>A pathspec with only a colon means “there is no pathspec”. This form should not be combined with other pathspec.</p><h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><p>The magic word top (magic signature: /) makes the pattern match from the root of the working tree, even when you are running the command from inside a subdirectory.</p><h4 id="literal"><a href="#literal" class="headerlink" title="literal"></a>literal</h4><p>Wildcards in the pattern such as * or ? are treated as literal characters.</p><h4 id="icase"><a href="#icase" class="headerlink" title="icase"></a>icase</h4><p>Case insensitive match.</p><h4 id="glob"><a href="#glob" class="headerlink" title="glob"></a>glob</h4><p>Git treats the pattern as a shell glob suitable for consumption by fnmatch(3) with the FNM_PATHNAME flag: wildcards in the pattern will not match a / in the pathname. For example, “Documentation/*.html” matches “Documentation/git.html” but not “Documentation/ppc/ppc.html” or “tools/perf/Documentation/perf.html”.</p><p>Two consecutive asterisks (“**”) in patterns matched against full pathname may have special meaning:</p><p>A leading “<strong>“ followed by a slash means match in all directories. For example, “</strong>/foo” matches file or directory “foo” anywhere, the same as pattern “foo”. “**/foo/bar” matches file or directory “bar” anywhere that is directly under directory “foo”.</p><p>A trailing “/<strong>“ matches everything inside. For example, “abc/</strong>“ matches all files inside directory “abc”, relative to the location of the .gitignore file, with infinite depth.</p><p>A slash followed by two consecutive asterisks then a slash matches zero or more directories. For example, “a/**/b” matches “a/b”, “a/x/b”, “a/x/y/b” and so on.</p><p>Other consecutive asterisks are considered invalid.</p><p>Glob magic is incompatible with literal magic.</p><h4 id="attr"><a href="#attr" class="headerlink" title="attr"></a>attr</h4><p>After attr: comes a space separated list of “attribute requirements”, all of which must be met in order for the path to be considered a match; this is in addition to the usual non-magic pathspec pattern matching. See gitattributes[5].</p><p>Each of the attribute requirements for the path takes one of these forms:</p><p>“ATTR” requires that the attribute ATTR be set.</p><p>“-ATTR” requires that the attribute ATTR be unset.</p><p>“ATTR=VALUE” requires that the attribute ATTR be set to the string VALUE.</p><p>“!ATTR” requires that the attribute ATTR be unspecified.</p><p>Note that when matching against a tree object, attributes are still obtained from working tree, not from the given tree object.</p><h4 id="exclude"><a href="#exclude" class="headerlink" title="exclude"></a>exclude</h4><p>After a path matches any non-exclude pathspec, it will be run through all exclude pathspecs (magic signature: ! or its synonym ^). If it matches, the path is ignored. When there is no non-exclude pathspec, the exclusion is applied to the result set as if invoked without any pathspec.</p><h4 id="parent"><a href="#parent" class="headerlink" title="parent"></a>parent</h4><p>A commit object contains a (possibly empty) list of the logical predecessor(s) in the line of development, i.e. its parents.</p><h4 id="pickaxe"><a href="#pickaxe" class="headerlink" title="pickaxe"></a>pickaxe</h4><p>The term pickaxe refers to an option to the diffcore routines that help select changes that add or delete a given text string. With the –pickaxe-all option, it can be used to view the full changeset that introduced or removed, say, a particular line of text. See git-diff[1].</p><h4 id="plumbing"><a href="#plumbing" class="headerlink" title="plumbing"></a>plumbing</h4><p>core Git 的别名。</p><h4 id="porcelain"><a href="#porcelain" class="headerlink" title="porcelain"></a>porcelain</h4><p>Cute name for programs and program suites depending on core Git, presenting a high level access to core Git. Porcelains expose more of a SCM interface than the plumbing.</p><h4 id="per-worktree-ref"><a href="#per-worktree-ref" class="headerlink" title="per-worktree ref"></a>per-worktree ref</h4><p>Refs that are per-worktree, rather than global. This is presently only HEAD and any refs that start with refs/bisect/, but might later include other unusual refs.</p><h4 id="pseudoref"><a href="#pseudoref" class="headerlink" title="pseudoref"></a>pseudoref</h4><p>Pseudorefs are a class of files under $GIT_DIR which behave like refs for the purposes of rev-parse, but which are treated specially by git. Pseudorefs both have names that are all-caps, and always start with a line consisting of a SHA-1 followed by whitespace. So, HEAD is not a pseudoref, because it is sometimes a symbolic ref. They might optionally contain some additional data. MERGE_HEAD and CHERRY_PICK_HEAD are examples. Unlike per-worktree refs, these files cannot be symbolic refs, and never have reflogs. They also cannot be updated through the normal ref update machinery. Instead, they are updated by directly writing to the files. However, they can be read as if they were refs, so git rev-parse MERGE_HEAD will work.</p><h4 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h4><p>pull 分支时，会先拉取（fetch）然后再覆盖（merge）。</p><h4 id="push"><a href="#push" class="headerlink" title="push"></a>push</h4><p>把当前的本地仓库版本提交到远程仓库。</p><h4 id="reachable"><a href="#reachable" class="headerlink" title="reachable"></a>reachable</h4><p>All of the ancestors of a given commit are said to be “reachable” from that commit. More generally, one object is reachable from another if we can reach the one from the other by a chain that follows tags to whatever they tag, commits to their parents or trees, and trees to the trees or blobs that they contain.</p><h4 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h4><p>To reapply a series of changes from a branch to a different base, and reset the head of that branch to the result.</p><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>A name that begins with refs/ (e.g. refs/heads/master) that points to an object name or another ref (the latter is called a symbolic ref). For convenience, a ref can sometimes be abbreviated when used as an argument to a Git command; see gitrevisions[7] for details. Refs are stored in the repository.</p><p>The ref namespace is hierarchical. Different subhierarchies are used for different purposes (e.g. the refs/heads/ hierarchy is used to represent local branches).</p><p>There are a few special-purpose refs that do not begin with refs/. The most notable example is HEAD.</p><h4 id="reflog"><a href="#reflog" class="headerlink" title="reflog"></a>reflog</h4><p>显示 ref 的变更日志。</p><h4 id="refspec"><a href="#refspec" class="headerlink" title="refspec"></a>refspec</h4><p>A “refspec” is used by fetch and push to describe the mapping between remote ref and local ref.</p><h4 id="remote-repository"><a href="#remote-repository" class="headerlink" title="remote repository"></a>remote repository</h4><p>远程仓库。</p><h4 id="remote-tracking-branch"><a href="#remote-tracking-branch" class="headerlink" title="remote-tracking branch"></a>remote-tracking branch</h4><p>A ref that is used to follow changes from another repository. It typically looks like refs/remotes/foo/bar (indicating that it tracks a branch named bar in a remote named foo), and matches the right-hand-side of a configured fetch refspec. A remote-tracking branch should not contain direct modifications or have local commits made to it.</p><h4 id="repository"><a href="#repository" class="headerlink" title="repository"></a>repository</h4><p>代码仓库。</p><h4 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h4><p>The action of fixing up manually what a failed automatic merge left behind.</p><h4 id="revision"><a href="#revision" class="headerlink" title="revision"></a>revision</h4><p>用于定位版本。</p><h4 id="rewind"><a href="#rewind" class="headerlink" title="rewind"></a>rewind</h4><p>To throw away part of the development, i.e. to assign the head to an earlier revision.</p><h4 id="SCM"><a href="#SCM" class="headerlink" title="SCM"></a>SCM</h4><p>源码管理工具。</p><h4 id="SHA-1"><a href="#SHA-1" class="headerlink" title="SHA-1"></a>SHA-1</h4><p>git 默认使用 <code>SHA-1</code> 来对对象或内容做hash运算。</p><h4 id="shallow-clone"><a href="#shallow-clone" class="headerlink" title="shallow clone"></a>shallow clone</h4><p>Mostly a synonym to shallow repository but the phrase makes it more explicit that it was created by running git clone –depth=… command.</p><h4 id="shallow-repository"><a href="#shallow-repository" class="headerlink" title="shallow repository"></a>shallow repository</h4><p>A shallow repository has an incomplete history some of whose commits have parents cauterized away (in other words, Git is told to pretend that these commits do not have the parents, even though they are recorded in the commit object). This is sometimes useful when you are interested only in the recent history of a project even though the real history recorded in the upstream is much larger. A shallow repository is created by giving the –depth option to git-clone[1], and its history can be later deepened with git-fetch[1].</p><h4 id="stash-entry"><a href="#stash-entry" class="headerlink" title="stash entry"></a>stash entry</h4><p>An object used to temporarily store the contents of a dirty working directory and the index for future reuse.</p><h4 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h4><p>子仓库，可以用来做多仓库集成。</p><h4 id="superproject"><a href="#superproject" class="headerlink" title="superproject"></a>superproject</h4><p>A repository that references repositories of other projects in its working tree as submodules. The superproject knows about the names of (but does not hold copies of) commit objects of the contained submodules.</p><h4 id="symref"><a href="#symref" class="headerlink" title="symref"></a>symref</h4><p>Symbolic reference: instead of containing the SHA-1 id itself, it is of the format ref: refs/some/thing and when referenced, it recursively dereferences to this reference. HEAD is a prime example of a symref. Symbolic references are manipulated with the git-symbolic-ref[1] command.</p><h4 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h4><p>A ref under refs/tags/ namespace that points to an object of an arbitrary type (typically a tag points to either a tag or a commit object). In contrast to a head, a tag is not updated by the commit command. A Git tag has nothing to do with a Lisp tag (which would be called an object type in Git’s context). A tag is most typically used to mark a particular point in the commit ancestry chain.</p><h4 id="tag-object"><a href="#tag-object" class="headerlink" title="tag object"></a>tag object</h4><p>An object containing a ref pointing to another object, which can contain a message just like a commit object. It can also contain a (PGP) signature, in which case it is called a “signed tag object”.</p><h4 id="topic-branch"><a href="#topic-branch" class="headerlink" title="topic branch"></a>topic branch</h4><p>A regular Git branch that is used by a developer to identify a conceptual line of development. Since branches are very easy and inexpensive, it is often desirable to have several small branches that each contain very well defined concepts or small incremental yet related changes.</p><h4 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h4><p>工作树（working tree）或tree对象。</p><h4 id="tree-object"><a href="#tree-object" class="headerlink" title="tree object"></a>tree object</h4><p>tree 对象，存储一组blob对象，相当于存储目录。</p><h4 id="tree-ish-also-treeish"><a href="#tree-ish-also-treeish" class="headerlink" title="tree-ish (also treeish)"></a>tree-ish (also treeish)</h4><p>A tree object or an object that can be recursively dereferenced to a tree object. Dereferencing a commit object yields the tree object corresponding to the revision’s top directory. The following are all tree-ishes: a commit-ish, a tree object, a tag object that points to a tree object, a tag object that points to a tag object that points to a tree object, etc.</p><h4 id="unmerged-index"><a href="#unmerged-index" class="headerlink" title="unmerged index"></a>unmerged index</h4><p>An index which contains unmerged index entries.</p><h4 id="unreachable-object"><a href="#unreachable-object" class="headerlink" title="unreachable object"></a>unreachable object</h4><p>An object which is not reachable from a branch, tag, or any other reference.</p><h4 id="upstream-branch"><a href="#upstream-branch" class="headerlink" title="upstream branch"></a>upstream branch</h4><p>The default branch that is merged into the branch in question (or the branch in question is rebased onto). It is configured via branch.<name>.remote and branch.<name>.merge. If the upstream branch of A is origin/B sometimes we say “A is tracking origin/B”.</p><h4 id="working-tree"><a href="#working-tree" class="headerlink" title="working tree"></a>working tree</h4><p>工作区。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-术语&quot;&gt;&lt;a href=&quot;#Git-术语&quot; class=&quot;headerlink&quot; title=&quot;Git 术语&quot;&gt;&lt;/a&gt;Git 术语&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;翻译自 &lt;a href=&quot;https://git-scm.com/docs/git</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 的一些环境变量</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/25/git-env/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/25/git-env/</id>
    <published>2020-10-25T12:10:37.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-的一些环境变量"><a href="#Git-的一些环境变量" class="headerlink" title="Git 的一些环境变量"></a>Git 的一些环境变量</h2><blockquote><p>参考：<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F</a> 和 <a href="https://git-scm.com/docs/git#_environment_variables">https://git-scm.com/docs/git#_environment_variables</a> 。</p></blockquote><h4 id="GIT-TRACE"><a href="#GIT-TRACE" class="headerlink" title="GIT_TRACE"></a>GIT_TRACE</h4><p>GIT_TRACE=1 可以显示具体的git内部执行过程，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 git pull 的执行过程</span></span><br><span class="line">$ GIT_TRACE=1 git pull</span><br><span class="line">10:15:16.423653 git.c:344               trace: built-in: git pull</span><br><span class="line">10:15:16.424388 run-command.c:646       trace: run_command: git fetch --update-head-ok</span><br><span class="line">10:15:16.425853 git.c:344               trace: built-in: git fetch --update-head-ok</span><br><span class="line">10:15:16.426444 run-command.c:646       trace: run_command: <span class="built_in">unset</span> GIT_DIR GIT_PREFIX; ssh git@gitlab.alibaba-inc.com <span class="string">&#x27;git-upload-pack &#x27;</span><span class="string">&#x27;&#x27;</span>agit/galileo.git<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">10:15:16.883780 run-command.c:646       trace: run_command: git rev-list --objects --stdin --not --all --quiet</span><br><span class="line">10:15:16.886473 run-command.c:646       trace: run_command: git rev-list --objects --stdin --not --all --quiet</span><br><span class="line">10:15:16.888001 git.c:344               trace: built-in: git rev-list --objects --stdin --not --all --quiet</span><br><span class="line">10:15:16.926434 run-command.c:1569      run_processes_parallel: preparing to run up to 1 tasks</span><br><span class="line">10:15:16.926536 run-command.c:1601      run_processes_parallel: <span class="keyword">done</span></span><br><span class="line">10:15:16.926622 run-command.c:646       trace: run_command: git gc --auto</span><br><span class="line">10:15:16.928214 git.c:344               trace: built-in: git gc --auto</span><br><span class="line">10:15:16.929016 run-command.c:646       trace: run_command: git merge FETCH_HEAD</span><br><span class="line">10:15:16.930404 git.c:344               trace: built-in: git merge FETCH_HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 git status 的执行过程</span></span><br><span class="line">$ GIT_TRACE=1 git st</span><br><span class="line">10:18:16.275652 git.c:576               trace: <span class="built_in">exec</span>: git-st</span><br><span class="line">10:18:16.275723 run-command.c:646       trace: run_command: git-st</span><br><span class="line">10:18:16.275835 git.c:274               trace: <span class="built_in">alias</span> expansion: st =&gt; status</span><br><span class="line">10:18:16.275870 git.c:576               trace: <span class="built_in">exec</span>: git-status</span><br><span class="line">10:18:16.275876 run-command.c:646       trace: run_command: git-status</span><br><span class="line">10:18:16.277339 git.c:344               trace: built-in: git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to date with <span class="string">&#x27;origin/master&#x27;</span>.</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure><h4 id="GIT-DIR"><a href="#GIT-DIR" class="headerlink" title="GIT_DIR"></a>GIT_DIR</h4><h4 id="GIT-CURL-VERBOSE"><a href="#GIT-CURL-VERBOSE" class="headerlink" title="GIT_CURL_VERBOSE"></a>GIT_CURL_VERBOSE</h4><h4 id="GIT-TRACE-PACKET"><a href="#GIT-TRACE-PACKET" class="headerlink" title="GIT_TRACE_PACKET"></a>GIT_TRACE_PACKET</h4><h4 id="GIT-TERMINAL-PROMPT"><a href="#GIT-TERMINAL-PROMPT" class="headerlink" title="GIT_TERMINAL_PROMPT"></a>GIT_TERMINAL_PROMPT</h4><h4 id="GIT-AUTHOR-DATE"><a href="#GIT-AUTHOR-DATE" class="headerlink" title="GIT_AUTHOR_DATE"></a>GIT_AUTHOR_DATE</h4><h4 id="GIT-AUTHOR-NAME"><a href="#GIT-AUTHOR-NAME" class="headerlink" title="GIT_AUTHOR_NAME"></a>GIT_AUTHOR_NAME</h4><h4 id="GIT-AUTHOR-EMAIL"><a href="#GIT-AUTHOR-EMAIL" class="headerlink" title="GIT_AUTHOR_EMAIL"></a>GIT_AUTHOR_EMAIL</h4><h4 id="GIT-COMMITTER-DATE"><a href="#GIT-COMMITTER-DATE" class="headerlink" title="GIT_COMMITTER_DATE"></a>GIT_COMMITTER_DATE</h4><h4 id="GIT-COMMITTER-NAME"><a href="#GIT-COMMITTER-NAME" class="headerlink" title="GIT_COMMITTER_NAME"></a>GIT_COMMITTER_NAME</h4><h4 id="GIT-COMMITTER-EMAIL"><a href="#GIT-COMMITTER-EMAIL" class="headerlink" title="GIT_COMMITTER_EMAIL"></a>GIT_COMMITTER_EMAIL</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-的一些环境变量&quot;&gt;&lt;a href=&quot;#Git-的一些环境变量&quot; class=&quot;headerlink&quot; title=&quot;Git 的一些环境变量&quot;&gt;&lt;/a&gt;Git 的一些环境变量&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://g</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 的配置说明</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/21/git-config/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/21/git-config/</id>
    <published>2020-10-21T08:29:22.000Z</published>
    <updated>2021-03-22T01:55:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-的配置说明"><a href="#Git-的配置说明" class="headerlink" title="Git 的配置说明"></a>Git 的配置说明</h2><blockquote><p>参考 <a href="https://git-scm.com/book/en/v2">Pro Git</a> 的 <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration">Customizing Git - Git Configuration</a>。更详细的配置项说明见：<a href="https://git-scm.com/docs/git-config">https://git-scm.com/docs/git-config</a> 。</p></blockquote><h3 id="git-的-3-种配置"><a href="#git-的-3-种配置" class="headerlink" title="git 的 3 种配置"></a>git 的 3 种配置</h3><p>git 有 3 种配置，分别为当前工作区配置、全局配置、系统配置，各自的配置文件分别为：</p><ul><li>当前工作区配置文件：<code>&lt;repo&gt;/.git/config</code>。</li><li>全局配置文件：<code>~/.gitconfig</code>。</li><li>系统配置文件：<code>/etc/gitconfig</code>。</li></ul><p><code>git config</code> 命令，分别可以使用 <code>--local</code> 、 <code>--global</code> 、 <code>--system</code> 来设置对应的git 配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前工作区配置</span></span><br><span class="line">$ git config --<span class="built_in">local</span> --list</span><br><span class="line"><span class="comment"># 查看全局配置</span></span><br><span class="line">$ git config --global --list</span><br><span class="line"><span class="comment"># 查看系统配置</span></span><br><span class="line">$ git config --system --list</span><br><span class="line"><span class="comment"># 查看当前生效的配置</span></span><br><span class="line">$ git config --list</span><br></pre></td></tr></table></figure><h3 id="常见的配置项"><a href="#常见的配置项" class="headerlink" title="常见的配置项"></a>常见的配置项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置用户名</span></span><br><span class="line">$ git config --global user.name <span class="string">&quot;xiaowenxia&quot;</span></span><br><span class="line"><span class="comment"># 配置邮箱</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;775117471@qq.com&quot;</span></span><br><span class="line"><span class="comment"># 配置自动颜色</span></span><br><span class="line">$ git config --global color.ui auto</span><br><span class="line"><span class="comment"># 配置默认的编辑器为vim</span></span><br><span class="line">$ git config --global core.editor vim</span><br></pre></td></tr></table></figure><h3 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h3><details><summary>命令说明（点击展开）</summary><pre><code>usage: git config [&lt;options&gt;]Config file location    --global              use global config file    --system              use system config file    --local               use repository config file    --worktree            use per-worktree config file    -f, --file &lt;file&gt;     use given config file    --blob &lt;blob-id&gt;      read config from given blob objectAction    --get                 get value: name [value-regex]    --get-all             get all values: key [value-regex]    --get-regexp          get values for regexp: name-regex [value-regex]    --get-urlmatch        get value specific for the URL: section[.var] URL    --replace-all         replace all matching variables: name value [value_regex]    --add                 add a new variable: name value    --unset               remove a variable: name [value-regex]    --unset-all           remove all matches: name [value-regex]    --rename-section      rename section: old-name new-name    --remove-section      remove a section: name    -l, --list            list all    -e, --edit            open an editor    --get-color           find the color configured: slot [default]    --get-colorbool       find the color setting: slot [stdout-is-tty]Type    -t, --type &lt;&gt;         value is given this type    --bool                value is &quot;true&quot; or &quot;false&quot;    --int                 value is decimal number    --bool-or-int         value is --bool or --int    --path                value is a path (file or directory name)    --expiry-date         value is an expiry dateOther    -z, --null            terminate values with NUL byte    --name-only           show variable names only    --includes            respect include directives on lookup    --show-origin         show origin of config (file, standard input, blob, command line)    --default &lt;value&gt;     with --get, use default value when missing entry</code></pre></details></br><h3 id="更多配置项"><a href="#更多配置项" class="headerlink" title="更多配置项"></a>更多配置项</h3><h4 id="core-editor"><a href="#core-editor" class="headerlink" title="core.editor"></a>core.editor</h4><p>git 默认使用环境变量 <code>VISUAL</code> 或 <code>EDITOR</code> 作为默认的编辑器，用户可以通过配置 <code>core.editor</code> 设置默认的编辑器。</p><h4 id="commit-template"><a href="#commit-template" class="headerlink" title="commit.template"></a>commit.template</h4><p><code>commit.template</code> 可以让你配置 <code>git commit</code> 时的提交信息的模板文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 commit 模板文件为 ~/.gitmessage.txt</span></span><br><span class="line">$ git config --global commit.template ~/.gitmessage.txt</span><br><span class="line"><span class="comment"># 提交时，则会显示模板</span></span><br><span class="line">$ git commit</span><br></pre></td></tr></table></figure><h4 id="core-pager"><a href="#core-pager" class="headerlink" title="core.pager"></a>core.pager</h4><p>配置默认的查看git 输出的工具，比如 <code>git log</code>、 <code>git diff</code>等，默认为 <a href="https://man7.org/linux/man-pages/man1/less.1.html">less</a>，当然你也可以配置成其他的翻页工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置成 more</span></span><br><span class="line">$ git config --global core.pager more</span><br><span class="line"><span class="comment"># 配置为空，则不使用翻页工具</span></span><br><span class="line">$ git config --global core.pager <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="user-signingkey"><a href="#user-signingkey" class="headerlink" title="user.signingkey"></a>user.signingkey</h4><p>设置你的 <a href="https://docs.gitlab.com/ee/user/project/repository/gpg_signed_commits/#:~:text=You%20can%20use%20a%20GPG%20key%20to%20sign,used%20for%20all%20OpenPGP%2FPGP%2FGPG%20related%20material%20and%20implementations.">GPG</a> 签名id：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.signingkey &lt;gpg-key-id&gt;</span><br></pre></td></tr></table></figure><h4 id="core-excludesfile"><a href="#core-excludesfile" class="headerlink" title="core.excludesfile"></a>core.excludesfile</h4><p>设置全局 ignore 的文件，该配置项相当于全局的 <a href="https://git-scm.com/docs/gitignore">.gitignore</a> 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.excludesfile ~/.gitignore_global</span><br></pre></td></tr></table></figure><h4 id="help-autocorrect"><a href="#help-autocorrect" class="headerlink" title="help.autocorrect"></a>help.autocorrect</h4><p>git 命令如果输入有误时，会提示是否存在类似的命令，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 故意输错 chekcout，则提示相似的 checkout 命令</span></span><br><span class="line">$ git chekcout master</span><br><span class="line">git: <span class="string">&#x27;chekcout&#x27;</span> is not a git <span class="built_in">command</span>. See <span class="string">&#x27;git --help&#x27;</span>.</span><br><span class="line"></span><br><span class="line">The most similar <span class="built_in">command</span> is</span><br><span class="line">    checkout</span><br></pre></td></tr></table></figure><p><code>help.autocorrect</code> 则可以让 git 自动纠正命令并执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git chekcout master</span><br><span class="line">WARNING: You called a Git <span class="built_in">command</span> named <span class="string">&#x27;chekcout&#x27;</span>, <span class="built_in">which</span> does not exist.</span><br><span class="line">Continuing under the assumption that you meant <span class="string">&#x27;checkout&#x27;</span></span><br><span class="line"><span class="keyword">in</span> 0.1 seconds automatically...</span><br></pre></td></tr></table></figure><h4 id="color-ui"><a href="#color-ui" class="headerlink" title="color.ui"></a>color.ui</h4><p>设置 git 命令输出是否带有颜色。<br>git 还支持更细颗粒度的颜色输出配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color.branch</span><br><span class="line">color.diff</span><br><span class="line">color.interactive</span><br><span class="line">color.status</span><br></pre></td></tr></table></figure><h4 id="core-autocrlf"><a href="#core-autocrlf" class="headerlink" title="core.autocrlf"></a>core.autocrlf</h4><p>Windows 和 Linux/MacOS 的换行符是有差异的，Windows的换行符是 <code>CRLF</code>，Linux/MacOS 的换行符是<code>LF</code>，如果用户在 Windows 上提交代码，那 checkout 到Linux/MacOS 平台上则会有显示问题，开启 <code>core.autocrlf</code> 配置项则可以让 git 根据平台自动转换换行符。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="core-attributesFile"><a href="#core-attributesFile" class="headerlink" title="core.attributesFile"></a>core.attributesFile</h4><p>设置 .gitattributes 文件路径。</p><h4 id="配置-merge-或者-diff-工具"><a href="#配置-merge-或者-diff-工具" class="headerlink" title="配置 merge 或者 diff 工具"></a>配置 merge 或者 diff 工具</h4><p>git 还支持配置 merge 或者 diff 工具，比如如下的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.tool extMerge</span><br><span class="line">$ git config --global mergetool.extMerge.cmd \</span><br><span class="line">  <span class="string">&#x27;extMerge &quot;$BASE&quot; &quot;$LOCAL&quot; &quot;$REMOTE&quot; &quot;$MERGED&quot;&#x27;</span></span><br><span class="line">$ git config --global mergetool.extMerge.trustExitCode <span class="literal">false</span></span><br><span class="line">$ git config --global diff.external extDiff</span><br></pre></td></tr></table></figure><p>详细配置说明请参考 <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration">Customizing Git - Git Configuration</a>。</p><h4 id="git-配置文件-说明-vscode-插件"><a href="#git-配置文件-说明-vscode-插件" class="headerlink" title="git 配置文件 说明 vscode 插件"></a>git 配置文件 说明 vscode 插件</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-的配置说明&quot;&gt;&lt;a href=&quot;#Git-的配置说明&quot; class=&quot;headerlink&quot; title=&quot;Git 的配置说明&quot;&gt;&lt;/a&gt;Git 的配置说明&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;参考 &lt;a href=&quot;https://git-scm.c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 的特殊文件</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-internal-files/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-internal-files/</id>
    <published>2020-10-20T03:06:40.000Z</published>
    <updated>2021-02-17T05:52:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-的特殊文件"><a href="#Git-的特殊文件" class="headerlink" title="Git 的特殊文件"></a>Git 的特殊文件</h2><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>配置忽略的文件或目录</p><h3 id="gitattribute"><a href="#gitattribute" class="headerlink" title=".gitattribute"></a>.gitattribute</h3><blockquote><p>参考官方手册：<a href="https://git-scm.com/docs/gitattributes">https://git-scm.com/docs/gitattributes</a></p></blockquote><p><code>.gitattribute</code> 可以为每个目录定义想要的属性，同时也支持匹配方式来设定一组目录。一个简单的示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a*foo !bar -baz</span><br><span class="line"></span><br><span class="line">(<span class="keyword">in</span> .gitattributes)</span><br><span class="line">abcfoo bar baz</span><br><span class="line"></span><br><span class="line">(<span class="keyword">in</span> t/.gitattributes)</span><br><span class="line">ab*merge=filfre</span><br><span class="line">abc-foo -bar</span><br><span class="line">*.cfrotz</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="gitattributes-文件存储路径"><a href="#gitattributes-文件存储路径" class="headerlink" title="gitattributes 文件存储路径"></a>gitattributes 文件存储路径</h4><ul><li>仓库<ul><li><code>$GIT_DIR/info/attributes</code></li><li>根目录</li><li>子目录</li></ul></li><li>用户全局路径：<code>$HOME/.config/git/gitattributes</code><br>  也可以通过配置项 <code>core.attributesFile</code> 配置文件路径，参考 <a href="https://git-scm.com/docs/git-config">git-config</a>。</li><li>系统路径：/etc/gitattributes</li></ul><p>定义 <code>gitattributes</code> ，除了 <code>.gitattribute</code> 文件，也可以是 <code>$GIT_DIR/info/attributes</code>。</p><p><code>.gitattribute</code> 格式非常简单，每一行定义一个或一组属性，中间使用空格作为分隔符：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pattern attr1 attr2 ...</span><br><span class="line">pattern2 attr1 attr2 ...</span><br></pre></td></tr></table></figure><blockquote><p>开头、结尾的空格都会忽略，(<code>#</code>)开头的行也会被忽略，双引号(<code>&quot;</code>)开头的 <code>pattern</code> 使用 C 语言风格。后一行的属性会覆盖前面的属性。</p></blockquote><p>每个路径的属性都有如下状态：</p><ul><li>Set<br>  设置属性为 <code>true</code>。</li><li>Unset<br>  设置该属性为 <code>false</code>。</li><li>设置成某个值</li><li>Unspecified<br>gitattributes 支持的属性有：</li></ul><p>路径的匹配规则和<code>.gitignore</code>几乎是一样的。</p><h4 id="gitattribute-的优先级"><a href="#gitattribute-的优先级" class="headerlink" title=".gitattribute 的优先级"></a>.gitattribute 的优先级</h4><p><code>.gitattribute</code> 的优先级由高到低分别是：</p><ul><li><code>$GIT_DIR/info/attributes</code></li><li>路径下的 <code>.gitattribute</code></li><li>上级目录下的 <code>.gitattribute</code></li><li>更上级目录的<code>.gitattribute</code></li><li>根目录下的 <code>.gitattribute</code></li><li>全局的<code>.gitattribute</code></li><li>系统的<code>.gitattribute</code></li></ul><p>比如存在如下文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统</span></span><br><span class="line">/etc/gitattributes          <span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局</span></span><br><span class="line">/User/xxx/.gitattributes    <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地仓库</span></span><br><span class="line">├── .git</span><br><span class="line">|   ├── ......</span><br><span class="line">│   ├── info</span><br><span class="line">│   │   └── .gitattributes  <span class="comment">#3</span></span><br><span class="line">|   └── ......</span><br><span class="line">├── .gitattributes          <span class="comment">#4</span></span><br><span class="line">├── ......</span><br><span class="line">└── subdir</span><br><span class="line">    ├── .gitattributes      <span class="comment">#5</span></span><br><span class="line">    └── subdirx</span><br><span class="line">        └── .gitattributes  <span class="comment">#6</span></span><br></pre></td></tr></table></figure><p>那优先级分别是 <code>#3</code> &gt; <code>#6</code> &gt; <code>#5</code> &gt; <code>#4</code> &gt; <code>#2</code> &gt; <code>#1</code>。</p><p>通过 <code>git check-attr</code> 查看 <code>.gitattribute</code>文件内容信息，命令参考 <a href="./git-internal-commands.md#git-check-attr">git check-attr</a>。</p><h4 id="gitkeep"><a href="#gitkeep" class="headerlink" title=".gitkeep"></a>.gitkeep</h4><p>了解 git 底层原理的人应该比较清楚，git 无法追踪一个空的文件夹，当用户需要追踪(track)一个空的文件夹的时候，按照惯例，大家会把一个称为 <code>.gitkeep</code> 的文件放在这些文件夹里。</p><h4 id="gitmodules"><a href="#gitmodules" class="headerlink" title=".gitmodules"></a>.gitmodules</h4><p>git 子仓库（submodules）。</p><h4 id="git-description"><a href="#git-description" class="headerlink" title=".git/description"></a>.git/description</h4><p><code>.git/description</code> 文件用来存储仓库名称以及仓库的描述信息。默认的值为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unnamed repository; edit this file &#39;description&#39; to name the repository.</span><br></pre></td></tr></table></figure><p>也可以改成类似如下的值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git-inside This is git-inside</span><br></pre></td></tr></table></figure><p>有些Git 工具（比如 <a href="https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-GitWeb">GitWeb</a> ）通过读取该文件来获取仓库名称以及仓库的说明信息。git hooks 也会读取 <code>.git/description</code> 来获取仓库名称。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-的特殊文件&quot;&gt;&lt;a href=&quot;#Git-的特殊文件&quot; class=&quot;headerlink&quot; title=&quot;Git 的特殊文件&quot;&gt;&lt;/a&gt;Git 的特殊文件&lt;/h2&gt;&lt;h3 id=&quot;gitignore&quot;&gt;&lt;a href=&quot;#gitignore&quot; class</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git Cheatsheet</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-cheatsheet/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-cheatsheet/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-Cheatsheet"><a href="#Git-Cheatsheet" class="headerlink" title="Git Cheatsheet"></a>Git Cheatsheet</h2><blockquote><p>更多 git cheatsheet 可以看 <a href="https://github.com/arslanbilal/git-cheat-sheet">https://github.com/arslanbilal/git-cheat-sheet</a> 。</p></blockquote><p><a name="d5IQV"></a></p><h3 id="git-cheatsheet"><a href="#git-cheatsheet" class="headerlink" title="git cheatsheet"></a>git cheatsheet</h3><p><img src="https://img.alicdn.com/tfs/TB1Cbv.mzMZ7e4jSZFOXXX7epXa-1916-5294.png" alt="image.png"></p><blockquote><p><a href="http://gitlab.com/">Gitlab</a> 官方提供的 git cheatsheet 。</p></blockquote><p><a name="LFTMA"></a></p><h3 id="git-revisions-cheatsheet"><a href="#git-revisions-cheatsheet" class="headerlink" title="git revisions cheatsheet"></a>git revisions cheatsheet</h3><p><img src="https://img.alicdn.com/tfs/TB18W3uZBr0gK0jSZFnXXbRRXXa-1305-1801.png" alt="image.png"></p><blockquote><p>出自 <a href="https://devhints.io/git-revisions">Rico’s cheatsheets</a> - git revisions 。</p></blockquote><h3 id="git-各个区的关系"><a href="#git-各个区的关系" class="headerlink" title="git 各个区的关系"></a>git 各个区的关系</h3><blockquote><p>出自 <a href="http://amio.github.io/git-cheatsheet-chs/#loc=remote_repo">http://amio.github.io/git-cheatsheet-chs/#loc=remote_repo</a>; 。</p></blockquote><p><img src="https://img.alicdn.com/tfs/TB1zdjy0XY7gK0jSZKzXXaikpXa-2584-1320.png"><br><img src="https://img.alicdn.com/tfs/TB12.Tz0oz1gK0jSZLeXXb9kVXa-2604-1316.png"><br><img src="https://img.alicdn.com/tfs/TB1aZytnsVl614jSZKPXXaGjpXa-2576-1314.png"><br><img src="https://img.alicdn.com/tfs/TB1VeKqo2zO3e4jSZFxXXaP_FXa-2596-1318.png"><br><img src="https://img.alicdn.com/tfs/TB1yRnF0oH1gK0jSZSyXXXtlpXa-2588-1314.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-Cheatsheet&quot;&gt;&lt;a href=&quot;#Git-Cheatsheet&quot; class=&quot;headerlink&quot; title=&quot;Git Cheatsheet&quot;&gt;&lt;/a&gt;Git Cheatsheet&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;更多 git ch</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git Hooks</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-hooks/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-hooks/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-16T08:42:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-Hooks"><a href="#Git-Hooks" class="headerlink" title="Git Hooks"></a>Git Hooks</h2><blockquote><p>官方Git 钩子说明：<a href="https://git-scm.com/docs/githooks">https://git-scm.com/docs/githooks</a> 。</p></blockquote><br /><p>Git 能在特定的重要动作发生时触发自定义脚本，该脚本可以是Shell、Ruby、Python等，这些脚本就是 Git Hooks（git 钩子）。钩子都被存储在 Git 工作目录下的 <code>hooks</code> 子目录中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git/hooks</span><br><span class="line">.git/hooks</span><br><span class="line">├── applypatch-msg.sample</span><br><span class="line">├── commit-msg.sample</span><br><span class="line">├── fsmonitor-watchman.sample</span><br><span class="line">├── post-update.sample</span><br><span class="line">├── pre-applypatch.sample</span><br><span class="line">├── pre-commit.sample</span><br><span class="line">├── pre-merge-commit.sample</span><br><span class="line">├── pre-push.sample</span><br><span class="line">├── pre-rebase.sample</span><br><span class="line">├── pre-receive.sample</span><br><span class="line">├── prepare-commit-msg.sample</span><br><span class="line">└── update.sample</span><br><span class="line"></span><br><span class="line">0 directories, 12 files</span><br></pre></td></tr></table></figure><p>git hooks 的生命周期图解：<br />       <img src="https://img.alicdn.com/tfs/TB1587tZBr0gK0jSZFnXXbRRXXa-1020-767.png" alt="image.png"></p><blockquote><p>该图片来自：<a href="https://delicious-insights.com/fr/articles/git-hooks/">https://delicious-insights.com/fr/articles/git-hooks/</a> 。</p></blockquote><p><a name="7q280"></a></p><h4 id="提交工作流的钩子"><a href="#提交工作流的钩子" class="headerlink" title="提交工作流的钩子"></a>提交工作流的钩子</h4><table><thead><tr><th align="center"><strong>hook</strong></th><th><strong>触发点</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td align="center"><code>pre-commit</code></td><td>提交信息<strong>前</strong>运行</td><td>它用于检查即将提交的快照，如果该钩子以非零值退出，Git 将放弃此次提交，不过你可以用 <code>git commit --no-verify</code> 来绕过这个环节。</td></tr><tr><td align="center"><code>prepare-commit-msg</code></td><td>在启动提交信息编辑器之前，默认信息被创建之后运行</td><td>它允许你编辑提交者所看到的默认信息。 该钩子接收一些选项：存有当前提交信息的文件的路径、提交类型和修补提交的提交的 SHA-1 校验。 它对一般的提交来说并没有什么用；然而对那些会自动产生默认信息的提交，如提交信息模板、合并提交、压缩提交和修订提交等非常实用。 你可以结合提交模板来使用它，动态地插入信息。</td></tr><tr><td align="center"><code>commit-msg</code></td><td>提交信息时运行</td><td>钩子接收一个参数，此参数即上文提到的，存有当前提交信息的临时文件的路径。 如果该钩子脚本以非零值退出，Git 将放弃提交，因此，可以用来在提交通过前验证项目状态或提交信息。 在本章的最后一节，我们将展示如何使用该钩子来核对提交信息是否遵循指定的模板。</td></tr><tr><td align="center"><code>post-commit</code></td><td>整个提交过程完成后运行</td><td>它不接收任何参数，但你可以很容易地通过运行 <code>git log -1 HEAD</code> 来获得最后一次的提交信息。 该钩子一般用于通知之类的事情。</td></tr></tbody></table><p><a name="ebpZR"></a></p><h4 id="电子邮件工作流钩子"><a href="#电子邮件工作流钩子" class="headerlink" title="电子邮件工作流钩子"></a>电子邮件工作流钩子</h4><table><thead><tr><th align="center"><strong>hook</strong></th><th><strong>触发点</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td align="center"><code>applypatch-msg</code></td><td>应用补丁前运行</td><td>它接收单个参数：包含请求合并信息的临时文件的名字。 如果脚本返回非零值，Git 将放弃该补丁。 你可以用该脚本来确保提交信息符合格式，或直接用脚本修正格式错误。</td></tr><tr><td align="center"><code>pre-applypatch</code></td><td>应用补丁后、产生提交之前运</td><td>你可以用这个脚本运行测试或检查工作区。 如果有什么遗漏，或测试未能通过，脚本会以非零值退出，中断 <code>git am</code> 的运行，这样补丁就不会被提交。</td></tr><tr><td align="center"><code>post-applypatch</code></td><td>提交产生后运行</td><td><code>git am</code> 运行期间最后被调用的钩子。 你可以用它把结果通知给一个小组或所拉取的补丁的作者。 但你没办法用它停止打补丁的过程。</td></tr></tbody></table><p><a name="Oeeq0"></a></p><h4 id="其他客户端钩子"><a href="#其他客户端钩子" class="headerlink" title="其他客户端钩子"></a>其他客户端钩子</h4><table><thead><tr><th align="center"><strong>hook</strong></th><th><strong>触发点</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td align="center"><code>pre-rebase</code></td><td>rebase 前</td><td>以非零值退出可以中止变基的过程。 你可以使用这个钩子来禁止对已经推送的提交变基。</td></tr><tr><td align="center"><code>post-rewrite</code></td><td>运行会替换提交记录的命令时调用</td><td>比如：<code>git commit --amend</code> 和 <code>git rebase</code>。它唯一的参数是触发重写的命令名，同时从标准输入中接受一系列重写的提交记录。 这个钩子的用途很大程度上跟 <code>post-checkout</code> 和 <code>post-merge</code> 差不多。</td></tr><tr><td align="center"><code>post-checkout</code></td><td>在 <code>git checkout</code> 成功运行后</td><td>你可以根据你的项目环境用它调整你的工作目录。 其中包括放入大的二进制文件、自动生成文档或进行其他类似这样的操作。</td></tr><tr><td align="center"><code>post-merge</code></td><td>在 <code>git merge</code> 成功运行后</td><td>你可以用它恢复 Git 无法跟踪的工作区数据，比如权限数据。 这个钩子也可以用来验证某些在 Git 控制之外的文件是否存在，这样你就能在工作区改变时，把这些文件复制进来。</td></tr><tr><td align="center"><code>pre-push</code></td><td>在 <code>git push</code> 运行期间， 更新了远程引用但尚未传送对象时被调用</td><td>它接受远程分支的名字和位置作为参数，同时从标准输入中读取一系列待更新的引用。 你可以在推送开始之前，用它验证对引用的更新操作（一个非零的退出码将终止推送过程）。</td></tr><tr><td align="center"><code>pre-auto-gc</code></td><td>在垃圾回收（<code>git gc --auto</code>）开始之前被调用</td><td>可以用它来提醒你现在要回收垃圾了，或者依情形判断是否要中断回收。</td></tr></tbody></table><p><a name="Kt210"></a></p><h4 id="服务端钩子"><a href="#服务端钩子" class="headerlink" title="服务端钩子"></a>服务端钩子</h4><table><thead><tr><th align="center"><strong>hook</strong></th><th><strong>触发点</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td align="center"><code>pre-receive</code></td><td>来自客户端的推送操作时</td><td>它从标准输入获取一系列被推送的引用。如果它以非零值退出，所有的推送内容都不会被接受。 你可以用这个钩子阻止对引用进行非快进（<code>non-fast-forward</code>）的更新，或者对该推送所修改的所有引用和文件进行访问控制。</td></tr><tr><td align="center"><code>update</code></td><td>update 脚本和 pre-receive 脚本十分类似，不同之处在于它会为每一个准备更新的分支各运行一次。</td><td>假如推送者同时向多个分支推送内容，<code>pre-receive</code> 只运行一次，相比之下 <code>update</code> 则会为每一个被推送的分支各运行一次。 它不会从标准输入读取内容，而是接受三个参数：引用的名字（分支），推送前的引用指向的内容的 <code>SHA-1</code> 值，以及用户准备推送的内容的 <code>SHA-1</code> 值。 如果 <code>update</code> 脚本以非零值退出，只有相应的那一个引用会被拒绝；其余的依然会被更新。</td></tr><tr><td align="center"><code>post-receive</code></td><td>整个接收过程完结以后运行</td><td>可以用来更新其他系统服务或者通知用户。 它接受与 <code>pre-receive</code> 相同的标准输入数据。 它的用途包括给某个邮件列表发信，通知持续集成（<code>continous integration</code>）的服务器， 或者更新问题追踪系统（<code>ticket-tracking system</code>） —— 甚至可以通过分析提交信息来决定某个问题（<code>ticket</code>）是否应该被开启，修改或者关闭。 该脚本无法终止推送进程，不过客户端在它结束运行之前将保持连接状态， 所以如果你想做其他操作需谨慎使用它，因为它将耗费你很长的一段时间。</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-Hooks&quot;&gt;&lt;a href=&quot;#Git-Hooks&quot; class=&quot;headerlink&quot; title=&quot;Git Hooks&quot;&gt;&lt;/a&gt;Git Hooks&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;官方Git 钩子说明：&lt;a href=&quot;https://g</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git Revisions</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-revisions/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-revisions/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-20T07:39:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-Revisions"><a href="#Git-Revisions" class="headerlink" title="Git Revisions"></a>Git Revisions</h2><blockquote><p>参考原文链接：<a href="https://git-scm.com/docs/gitrevisions">https://git-scm.com/docs/gitrevisions</a> 。</p></blockquote><p><strong><code>git revisions</code></strong> （Git 修订版本）代表特定的版本或范围，revisions 可以高效的定位你想要的提交，git 命令很多参数都支持 revisions 。</p><p>revisions 的具体格式有一整套匹配规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------------------------------------</span><br><span class="line">|    Commit-ish/Tree-ish    |                Examples</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">|  1. &lt;sha1&gt;                | dae86e1950b1277e545cee180551750029cfe735</span><br><span class="line">|  2. &lt;describeOutput&gt;      | v1.7.4.2-679-g3bee7fb</span><br><span class="line">|  3. &lt;refname&gt;             | master, heads/master, refs/heads/master</span><br><span class="line">|  4. &lt;refname&gt;@&#123;&lt;date&gt;&#125;    | master@&#123;yesterday&#125;, HEAD@&#123;5 minutes ago&#125;</span><br><span class="line">|  5. &lt;refname&gt;@&#123;&lt;n&gt;&#125;       | master@&#123;1&#125;</span><br><span class="line">|  6. @&#123;&lt;n&gt;&#125;                | @&#123;1&#125;</span><br><span class="line">|  7. @&#123;-&lt;n&gt;&#125;               | @&#123;-1&#125;</span><br><span class="line">|  8. &lt;refname&gt;@&#123;upstream&#125;  | master@&#123;upstream&#125;, @&#123;u&#125;</span><br><span class="line">|  9. &lt;rev&gt;^                | HEAD^, v1.5.1^0</span><br><span class="line">| 10. &lt;rev&gt;~&lt;n&gt;             | master~3</span><br><span class="line">| 11. &lt;rev&gt;^&#123;&lt;<span class="built_in">type</span>&gt;&#125;        | v0.99.8^&#123;commit&#125;</span><br><span class="line">| 12. &lt;rev&gt;^&#123;&#125;              | v0.99.8^&#123;&#125;</span><br><span class="line">| 13. &lt;rev&gt;^&#123;/&lt;text&gt;&#125;       | HEAD^&#123;/fix nasty bug&#125;</span><br><span class="line">| 14. :/&lt;text&gt;              | :/fix nasty bug</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">|       Tree-ish only       |                Examples</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">| 15. &lt;rev&gt;:&lt;path&gt;          | HEAD:README.txt, master:sub-directory/</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">|         Tree-ish?         |                Examples</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">| 16. :&lt;n&gt;:&lt;path&gt;           | :0:README, :README</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure><blockquote><p>来自 StackOverflow 的 一份回答：<a href="https://stackoverflow.com/questions/23303549/what-are-commit-ish-and-tree-ish-in-git">What are commit-ish and tree-ish in Git?</a> 。</p></blockquote><h4 id="lt-sha1-gt"><a href="#lt-sha1-gt" class="headerlink" title="&lt;sha1&gt;"></a><em><code>&lt;sha1&gt;</code></em></h4><p>object 对象名称。<br>示例：</p><ul><li><em><code>dae86e1950b1277e545cee180551750029cfe735</code></em></li><li><em><code>dae86e</code></em></li></ul><h4 id="lt-describeOutput-gt"><a href="#lt-describeOutput-gt" class="headerlink" title="&lt;describeOutput&gt;"></a><em><code>&lt;describeOutput&gt;</code></em></h4><p><code>git describe</code> 的输出。</p><p>示例：</p><ul><li><em><code>v1.7.4.2-679-g3bee7fb</code></em></li></ul><h4 id="lt-refname-gt"><a href="#lt-refname-gt" class="headerlink" title="&lt;refname&gt;"></a><em><code>&lt;refname&gt;</code></em></h4><p>引用名称。</p><p>示例：</p><ul><li><em><code>master</code></em></li><li><em><code>heads/master</code></em></li><li><em><code>refs/heads/master</code></em></li></ul><h4 id=""><a href="#" class="headerlink" title="@"></a><em><code>@</code></em></h4><p>单独一个 <code>@</code> 表示 <code>HEAD</code> ，及当前分支。</p><h4 id="lt-refname-gt-lt-date-gt"><a href="#lt-refname-gt-lt-date-gt" class="headerlink" title="[&lt;refname&gt;]@{&lt;date&gt;}"></a><em><code>[&lt;refname&gt;]@&#123;&lt;date&gt;&#125;</code></em></h4><p>设置引用名称，同时设置时间过滤条件。</p><p>示例：</p><ul><li><em><code>master@&#123;yesterday&#125;</code></em></li><li><em><code>HEAD@&#123;5 minutes ago&#125;</code></em></li><li><em><code>refs/heads/master@&#123;1979-02-26 18:30:00&#125;</code></em></li></ul><h4 id="lt-refname-gt-lt-n-gt"><a href="#lt-refname-gt-lt-n-gt" class="headerlink" title="&lt;refname&gt;@{&lt;n&gt;}"></a><em><code>&lt;refname&gt;@&#123;&lt;n&gt;&#125;</code></em></h4><p>设置引用名称，同时设置倒数第 n 个版本。 0 代表最新的版本。</p><p>示例：</p><ul><li><em><code>HEAD@&#123;0&#125;</code></em></li><li><em><code>master@&#123;1&#125;</code></em></li><li><em><code>refs/heads/master@&#123;10&#125;</code></em></li></ul><h4 id="lt-n-gt"><a href="#lt-n-gt" class="headerlink" title="@{&lt;n&gt;}"></a><em><code>@&#123;&lt;n&gt;&#125;</code></em></h4><p>跟 <em><code>&lt;refname&gt;@&#123;&lt;n&gt;&#125;</code></em> 一样，省略了 refname 表示 refname 默认为 HEAD 。<br /></p><h4 id="lt-n-gt-1"><a href="#lt-n-gt-1" class="headerlink" title="@{-&lt;n&gt;}"></a><em><code>@&#123;-&lt;n&gt;&#125;</code></em></h4><h4 id="lt-branchname-gt-upstream"><a href="#lt-branchname-gt-upstream" class="headerlink" title="[&lt;branchname&gt;]@{upstream}"></a><em><code>[&lt;branchname&gt;]@&#123;upstream&#125;</code></em></h4><p>指定远程仓库分支名称。<em><code>@&#123;upstream&#125;</code></em> 可以简化成 <em><code>@&#123;u&#125;</code></em> 。</p><p>示例：</p><ul><li><em><code>master@&#123;upstream&#125;</code></em></li><li><em><code>@&#123;u&#125;</code></em></li></ul><h4 id="lt-branchname-gt-push"><a href="#lt-branchname-gt-push" class="headerlink" title="[&lt;branchname&gt;]@{push}"></a><em><code>[&lt;branchname&gt;]@&#123;push&#125;</code></em></h4><p>指定分支名称，指示该分支将会push到远程仓库中。</p><p>示例：</p><ul><li><em><code>master@&#123;push&#125;</code></em></li><li><em><code>@&#123;push&#125;</code></em></li></ul><h4 id="lt-rev-gt-lt-n-gt"><a href="#lt-rev-gt-lt-n-gt" class="headerlink" title="&lt;rev&gt;^[&lt;n&gt;]"></a><em><code>&lt;rev&gt;^[&lt;n&gt;]</code></em></h4><p>在 revision 后面添加 <em><code>^</code></em> 符号，表示获取第 n 个父级对象( parent )，没有设置 n 时，表示第一个父级对象，<em><code>^0</code></em> 表示 commit 本身。</p><p>示例：</p><ul><li><em><code>HEAD^</code></em></li><li><em><code>v1.5.1^0</code></em></li><li><em><code>HEAD^3</code></em></li></ul><h4 id="lt-rev-gt-lt-n-gt-1"><a href="#lt-rev-gt-lt-n-gt-1" class="headerlink" title="&lt;rev&gt;~[&lt;n&gt;]"></a><em><code>&lt;rev&gt;~[&lt;n&gt;]</code></em></h4><h4 id="lt-rev-gt-lt-type-gt"><a href="#lt-rev-gt-lt-type-gt" class="headerlink" title="&lt;rev&gt;^{&lt;type&gt;}"></a><em><code>&lt;rev&gt;^&#123;&lt;type&gt;&#125;</code></em></h4><p>在 revision 后面添加 <em><code>^&#123;&lt;type&gt;&#125;</code></em> 符号表示递归该引用直到找到对应类型（_<code>&lt;type&gt;</code>_）的 object 对象。</p><p>示例：</p><ul><li><em><code>v0.99.8^&#123;commit&#125;</code></em></li><li><em><code>dae86e1950b1277e545cee180551750029cfe735^&#123;tree&#125;</code></em></li></ul><h4 id="lt-rev-gt"><a href="#lt-rev-gt" class="headerlink" title="&lt;rev&gt;^{}"></a><em><code>&lt;rev&gt;^&#123;&#125;</code></em></h4><p>表示递归该引用直到找到类型不是 tag 的 object 对象。</p><p>示例：</p><ul><li><em><code>v0.99.8^&#123;&#125;</code></em></li><li><em><code>dae86e1950b1277e545cee180551750029cfe735^&#123;&#125;</code></em></li></ul><h4 id="lt-rev-gt-lt-text-gt"><a href="#lt-rev-gt-lt-text-gt" class="headerlink" title="&lt;rev&gt;^{/&lt;text&gt;}"></a><em><code>&lt;rev&gt;^&#123;/&lt;text&gt;&#125;</code></em></h4><p>匹配 <em><code>&lt;text&gt;</code>_，等效于 _<code>:/&lt;text&gt;</code></em> 。</p><p>示例：</p><ul><li><em><code>HEAD^&#123;/fix nasty bug&#125;</code></em></li></ul><h4 id="lt-text-gt"><a href="#lt-text-gt" class="headerlink" title=":/&lt;text&gt;"></a><em><code>:/&lt;text&gt;</code></em></h4><p>正则表达式匹配字符串。</p><p>示例：</p><ul><li><em><code>:/fix nasty bug</code></em></li><li><em><code>:/^foo</code></em></li></ul><h4 id="lt-rev-gt-lt-path-gt"><a href="#lt-rev-gt-lt-path-gt" class="headerlink" title="&lt;rev&gt;:&lt;path&gt;"></a><em><code>&lt;rev&gt;:&lt;path&gt;</code></em></h4><p>匹配文件/目录名称。</p><p>示例：</p><ul><li><em><code>HEAD:README</code></em></li><li><em><code>master:./README</code></em></li></ul><h4 id="lt-n-gt-lt-path-gt"><a href="#lt-n-gt-lt-path-gt" class="headerlink" title=":[&lt;n&gt;:]&lt;path&gt;"></a><em><code>:[&lt;n&gt;:]&lt;path&gt;</code></em></h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-Revisions&quot;&gt;&lt;a href=&quot;#Git-Revisions&quot; class=&quot;headerlink&quot; title=&quot;Git Revisions&quot;&gt;&lt;/a&gt;Git Revisions&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;参考原文链接：&lt;a hre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 的特殊技巧</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-tips/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-tips/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-17T07:55:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-的特殊技巧"><a href="#Git-的特殊技巧" class="headerlink" title="Git 的特殊技巧"></a>Git 的特殊技巧</h2><p><a name="BVhPV"></a></p><h3 id="可以-clone-本地仓库"><a href="#可以-clone-本地仓库" class="headerlink" title="可以 clone 本地仓库"></a>可以 clone 本地仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> /home/git/repositories/801/038/000/38801.git</span><br></pre></td></tr></table></figure><p><a name="ZrIcR"></a></p><h3 id="修改本地提交者信息"><a href="#修改本地提交者信息" class="headerlink" title="修改本地提交者信息"></a>修改本地提交者信息</h3><br /><h3 id="本地有-Untracked-Files-时，如何做一个-patch-包"><a href="#本地有-Untracked-Files-时，如何做一个-patch-包" class="headerlink" title="本地有 Untracked Files 时，如何做一个 patch 包"></a>本地有 Untracked Files 时，如何做一个 patch 包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -N 表示实际上并没有把文件添加到暂存区</span></span><br><span class="line">$ git add -N .</span><br><span class="line"><span class="comment"># git diff 生成 patch 文件</span></span><br><span class="line">$ git diff &gt; xxx.patch</span><br><span class="line"><span class="comment"># 恢复</span></span><br><span class="line">$ git reset</span><br></pre></td></tr></table></figure><p>如下显示：<br><img src="https://img.alicdn.com/tfs/TB1VW780hD1gK0jSZFsXXbldVXa-2484-1884.png"></p><h3 id="git-clone-–bare"><a href="#git-clone-–bare" class="headerlink" title="git clone –bare"></a>git clone –bare</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --bare git@github.com:xiaowenxia/git-inside.git</span><br><span class="line">Cloning into bare repository <span class="string">&#x27;git-inside.git&#x27;</span>...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看目录</span></span><br><span class="line">$ tree git-inside.git </span><br><span class="line">git-inside.git</span><br><span class="line">|-- HEAD</span><br><span class="line">|-- branches</span><br><span class="line">|-- config</span><br><span class="line">|-- description</span><br><span class="line">|-- hooks</span><br><span class="line">|   |-- applypatch-msg.sample</span><br><span class="line">|   |-- ......</span><br><span class="line">|   |-- prepare-commit-msg.sample</span><br><span class="line">|   `-- update.sample</span><br><span class="line">|-- info</span><br><span class="line">|   `-- exclude</span><br><span class="line">|-- objects</span><br><span class="line">|   |-- info</span><br><span class="line">|   `-- pack</span><br><span class="line">|       |-- pack-0381ae2bc198d3ad1f6483eaf2ebf80fe6cd9b26.idx</span><br><span class="line">|       `-- pack-0381ae2bc198d3ad1f6483eaf2ebf80fe6cd9b26.pack</span><br><span class="line">|-- packed-refs</span><br><span class="line">`-- refs</span><br><span class="line">    |-- heads</span><br><span class="line">    `-- tags</span><br><span class="line"></span><br><span class="line">9 directories, 18 files</span><br></pre></td></tr></table></figure><h3 id="查看-commit-id-属于哪个分支"><a href="#查看-commit-id-属于哪个分支" class="headerlink" title="查看 commit-id 属于哪个分支"></a>查看 commit-id 属于哪个分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -r --contains e784be434c9133cef107185925af22cd620a8e5e</span><br><span class="line">origin/feature/wiki</span><br><span class="line">origin/releases/20201015194918032_r_release_62648_t-force-stone-code</span><br></pre></td></tr></table></figure><h3 id="查看某人的所有提交（所有分支）"><a href="#查看某人的所有提交（所有分支）" class="headerlink" title="查看某人的所有提交（所有分支）"></a>查看某人的所有提交（所有分支）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --all --author=<span class="string">&quot;775117471@qq.com&quot;</span></span><br><span class="line">commit 59cabcd911a3a7460d53c850ee2c69372397cec9 (HEAD -&gt; main, origin/main, origin/HEAD)</span><br><span class="line">Author: xiaowenxia &lt;775117471@qq.com&gt;</span><br><span class="line">Date:   Tue Nov 3 20:07:30 2020 +0800</span><br><span class="line"></span><br><span class="line">    add some git tips</span><br><span class="line"></span><br><span class="line">commit 834afb32e8e9825e80c7910dbd9379e1be77629a</span><br><span class="line">Author: xiaowenxia &lt;775117471@qq.com&gt;</span><br><span class="line">Date:   Mon Nov 2 15:09:43 2020 +0800</span><br><span class="line"></span><br><span class="line">    Add `git-refs`.</span><br></pre></td></tr></table></figure><h3 id="如何在-vscode-中查看已经提交的代码-diff"><a href="#如何在-vscode-中查看已经提交的代码-diff" class="headerlink" title="如何在 vscode 中查看已经提交的代码 diff"></a>如何在 vscode 中查看已经提交的代码 diff</h3><p>因为 vscode 查看代码 diff 非常方便，比 git 默认的编辑器查看 diff 方便很多。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reset 到前面 7 个提交</span></span><br><span class="line">$ git reset --soft HEAD~7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复</span></span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure><p>如下所示：<br><img src="https://img.alicdn.com/tfs/TB1A08J2AL0gK0jSZFtXXXQCXXa-3092-2098.png"></p><h3 id="cherry-pick-多个提交"><a href="#cherry-pick-多个提交" class="headerlink" title="cherry-pick 多个提交"></a>cherry-pick 多个提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中间使用三个点（...）代表 pick 多个提交，这些提交必须是连续的</span></span><br><span class="line">$ git cherry-pick 33fbcded...4f17fa9f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不连续的提交则需要单独指定 commit-id</span></span><br><span class="line">$ git cherry-pick 33fbcded 4f17fa9f 820b38b4</span><br></pre></td></tr></table></figure><h3 id="指定-git-仓库路径"><a href="#指定-git-仓库路径" class="headerlink" title="指定 git 仓库路径"></a>指定 git 仓库路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git -C ~/workspace/github/git-inside status</span><br></pre></td></tr></table></figure><h3 id="指定-git-的工作目录"><a href="#指定-git-的工作目录" class="headerlink" title="指定 git 的工作目录"></a>指定 git 的工作目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git --git-dir=~/workspace/github/git-inside/.git status</span><br></pre></td></tr></table></figure><h3 id="git-的一些数据统计命令"><a href="#git-的一些数据统计命令" class="headerlink" title="git 的一些数据统计命令"></a>git 的一些数据统计命令</h3><blockquote><p>统计的是 git 的仓库：<a href="https://github.com/git/git">https://github.com/git/git</a> 。</p></blockquote><h4 id="统计仓库里面提交次数"><a href="#统计仓库里面提交次数" class="headerlink" title="统计仓库里面提交次数"></a>统计仓库里面提交次数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计每个人的提交次数</span></span><br><span class="line">$ git <span class="built_in">log</span> | grep <span class="string">&quot;^Author: &quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | sort | uniq -c | sort -k1,1nr</span><br><span class="line">22110 Junio</span><br><span class="line">3685 Jeff</span><br><span class="line">1824 Nguyễn</span><br><span class="line">...... <span class="comment"># 省略</span></span><br><span class="line"> 680 Brandon</span><br><span class="line"> 524 Jakub</span><br><span class="line">...... <span class="comment"># 省略</span></span><br><span class="line">   1 Андрей</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计 Junio 的提交次数</span></span><br><span class="line">$ git <span class="built_in">log</span> | grep <span class="string">&quot;^Author: .*&lt;gitster@pobox.com&gt;&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | sort | uniq -c | sort -k1,1nr</span><br><span class="line">22110 Junio</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=gitster@pobox.com --oneline |  wc -l</span><br><span class="line">   22110</span><br></pre></td></tr></table></figure><h4 id="按月统计指定用户的提交次数"><a href="#按月统计指定用户的提交次数" class="headerlink" title="按月统计指定用户的提交次数"></a>按月统计指定用户的提交次数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --author=gitster@pobox.com --since=<span class="string">&quot;2020-07-01&quot;</span> --no-merges | grep -e <span class="string">&#x27;commit [a-zA-Z0-9]*&#x27;</span> | wc -l</span><br><span class="line">      79</span><br></pre></td></tr></table></figure><h4 id="统计仓库所有提交次数"><a href="#统计仓库所有提交次数" class="headerlink" title="统计仓库所有提交次数"></a>统计仓库所有提交次数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计指定分支的提交次数</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline | wc -l</span><br><span class="line">   61128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计所有分支的提交次数</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --all | wc -l</span><br><span class="line">   63541</span><br></pre></td></tr></table></figure><h4 id="统计指定用户的代码量"><a href="#统计指定用户的代码量" class="headerlink" title="统计指定用户的代码量"></a>统计指定用户的代码量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前分支</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;gitster@pobox.com&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -</span><br><span class="line">added lines: 232482, removed lines: 101841, total lines: 130641</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有分支</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;gitster@pobox.com&quot;</span> --pretty=tformat: --numstat --all | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -</span><br><span class="line">added lines: 549564, removed lines: 376991, total lines: 172573</span><br></pre></td></tr></table></figure><h3 id="如何快速克隆-github-上的源码"><a href="#如何快速克隆-github-上的源码" class="headerlink" title="如何快速克隆 github 上的源码"></a>如何快速克隆 github 上的源码</h3><p>github 在国内的 clone 速度是非常慢的，速率一般在100k以下，如果要 clone 相对比较大的项目那会非常痛苦，而且git clone 没有断点续传功能，网络中断的话则需要重新clone。<br>此时可以利用 <a href="https://gitee.com/">gitee</a>。<a href="https://gitee.com/">gitee</a> 在国内的访问速度非常快，达到 <code>4~5M</code> 的 clone 速率，而且针对 github 上部分大型且比较有名的项目，gitee都会做一个仓库镜像，该镜像会每日同步，具体可以访问 <a href="https://gitee.com/mirrors">Gitee 极速下载</a>。<br>所以要快速克隆 github 上的源码，可以进行如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先 git clone gitee 的国内 git 镜像仓库。</span></span><br><span class="line">$ git <span class="built_in">clone</span> git@gitee.com:mirrors/AliOS-Things.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再添加一个新的 remote 仓库为 github 的仓库。</span></span><br><span class="line">$ <span class="built_in">cd</span> AliOS-Things</span><br><span class="line">$ git remote add github git@github.com:alibaba/AliOS-Things.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后 git fetch --all 就可以把 github 的仓库快速 clone 下来。</span></span><br><span class="line">$ git fetch –all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建 github 的本地分支，也可以删除掉 gitee 远程仓库。</span></span><br><span class="line">$ git checkout –b github_rel_3.0.0 –track github/rel_3.0.0</span><br></pre></td></tr></table></figure><p>操作示例如下：<br><img src="https://img.alicdn.com/tfs/TB1YCyVjrr1gK0jSZR0XXbP8XXa-967-534.gif"></p><h3 id="为什么-git-仓库提交历史很难篡改？"><a href="#为什么-git-仓库提交历史很难篡改？" class="headerlink" title="为什么 git 仓库提交历史很难篡改？"></a>为什么 git 仓库提交历史很难篡改？</h3><p>git 的底层 chain 对象和区块链有异曲同工之处，都是基于 merkle tree 的链式。</p><blockquote><p><a href="https://www.tangshuang.net/4117.html">区块链如何运用merkle tree验证交易真实性</a></p></blockquote><h3 id="vscode-里面的git-管理具体是怎么实现的？"><a href="#vscode-里面的git-管理具体是怎么实现的？" class="headerlink" title="vscode 里面的git 管理具体是怎么实现的？"></a>vscode 里面的git 管理具体是怎么实现的？</h3><h3 id="git-为什么要使用sha256？"><a href="#git-为什么要使用sha256？" class="headerlink" title="git 为什么要使用sha256？"></a>git 为什么要使用sha256？</h3><ul><li>git hash object的作用</li><li>sha1的优势劣势</li></ul><h3 id="git-gc-具体做了哪些事情？"><a href="#git-gc-具体做了哪些事情？" class="headerlink" title="git gc 具体做了哪些事情？"></a>git gc 具体做了哪些事情？</h3><h5 id="Git-顶层设计很优雅，Git-有140个-“小而美”-的子命令。"><a href="#Git-顶层设计很优雅，Git-有140个-“小而美”-的子命令。" class="headerlink" title="Git 顶层设计很优雅，Git 有140个 “小而美” 的子命令。"></a>Git 顶层设计很优雅，Git 有140个 “小而美” 的子命令。</h5><h5 id="写一个工具，把git-对象绘制成图。"><a href="#写一个工具，把git-对象绘制成图。" class="headerlink" title="写一个工具，把git 对象绘制成图。"></a>写一个工具，把git 对象绘制成图。</h5><h5 id="如何铺满整个github-的-contributions-计数面板"><a href="#如何铺满整个github-的-contributions-计数面板" class="headerlink" title="如何铺满整个github 的 contributions  计数面板"></a>如何铺满整个github 的 contributions  计数面板</h5><h3 id="定义你的-github-贡献日历图"><a href="#定义你的-github-贡献日历图" class="headerlink" title="定义你的 github 贡献日历图"></a>定义你的 github 贡献日历图</h3><p><img src="https://img.alicdn.com/imgextra/i2/O1CN01yMq5Ev1XRrZFPf1zc_!!6000000002921-2-tps-1850-410.png"></p><p>代码如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">timestampFile=timestamp.log</span><br><span class="line">touch <span class="variable">$timestampFile</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((k=0; k&lt;365; k++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 生成过去一年的随机时间</span></span><br><span class="line">    timestamp=`date -d <span class="string">&quot;-$[RANDOM%365] day -$[RANDOM%24] hour -$[RANDOM%60] minute -$[RANDOM%60] second &quot;</span> <span class="string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line">    <span class="comment"># 随机提交 1~5 次</span></span><br><span class="line">    <span class="keyword">for</span> ((i=0; i&lt;=$[RANDOM%5]; i++))</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$timestamp</span> &gt;&gt; <span class="variable">$timestampFile</span></span><br><span class="line">        git add <span class="variable">$timestampFile</span></span><br><span class="line">        git commit --date=<span class="string">&quot;&#123;<span class="variable">$i</span>&#125;<span class="variable">$&#123;timestamp&#125;</span>&quot;</span> -m <span class="string">&quot;&#123;<span class="variable">$i</span>&#125;<span class="variable">$&#123;timestamp&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-的特殊技巧&quot;&gt;&lt;a href=&quot;#Git-的特殊技巧&quot; class=&quot;headerlink&quot; title=&quot;Git 的特殊技巧&quot;&gt;&lt;/a&gt;Git 的特殊技巧&lt;/h2&gt;&lt;p&gt;&lt;a name=&quot;BVhPV&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;可以-clone-</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 工作流</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-workflow/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-workflow/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-16T07:00:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-工作流"><a href="#Git-工作流" class="headerlink" title="Git 工作流"></a>Git 工作流</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-工作流&quot;&gt;&lt;a href=&quot;#Git-工作流&quot; class=&quot;headerlink&quot; title=&quot;Git 工作流&quot;&gt;&lt;/a&gt;Git 工作流&lt;/h2&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Git 底层命令</title>
    <link href="https://xiaowenxia.github.io/git-inside/2020/10/20/git-internal-commands/"/>
    <id>https://xiaowenxia.github.io/git-inside/2020/10/20/git-internal-commands/</id>
    <published>2020-10-20T01:57:37.000Z</published>
    <updated>2021-02-20T07:39:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-底层命令"><a href="#Git-底层命令" class="headerlink" title="Git 底层命令"></a>Git 底层命令</h2><p><a name="OS6wF"></a></p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="#git-cat-file">git cat-file</a></li><li><a href="#git-ls-files">git ls-files</a></li><li><a href="#git-ls-tree">git ls-tree</a></li><li><a href="#git-read-tree">git read-tree</a></li><li><a href="#git-write-tree">git write-tree</a></li><li><a href="#git-commit-tree">git commit-tree</a></li><li><a href="#git-mktree">git mktree</a></li><li><a href="#git-diff-tree">git diff-tree</a></li><li><a href="#git-gc">git gc</a></li><li><a href="#git-verify-pack">git verify-pack</a></li><li><a href="#git-hash-object">git hash-object</a></li><li><a href="#git-show-index">git show-index</a></li><li><a href="#git-show-ref">git show-ref</a></li><li><a href="#git-update-ref">git update-ref</a></li><li><a href="#git-rev-parse">git rev-parse</a></li><li><a href="#git-rev-list">git rev-list</a></li><li><a href="#git-for-each-ref">git for-each-ref</a></li><li><a href="#git-var">git var</a></li><li><a href="#git-diff-tree">git diff-tree</a></li><li><a href="#git-merge-base">git merge-base</a></li><li><a href="#git-ref-log">git ref-log</a></li><li><a href="#git-blame">git blame</a></li><li><a href="#git-check-attr">git check-attr</a></li><li><a href="#git-count-objects">git count-objects</a></li><li><a href="#git-fsck">git fsck</a></li></ul><h3 id="git-的子命令"><a href="#git-的子命令" class="headerlink" title="git 的子命令"></a>git 的子命令</h3><p>git 的子命令目前有 140+ 个，可以通过 <code>git --exec-path</code> 获取到 git 的子命令存储目录，如下显示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ ls `git --exec-path`</span><br><span class="line">git                   git-count-objects             git-help                git-mergetool            git-remote-fd          git-stash</span><br><span class="line">git-add               git-credential                git-http-backend        git-mergetool--lib       git-remote-ftp         git-status</span><br><span class="line">git-add--interactive  git-credential-cache          git-http-fetch          git-mktag                git-remote-ftps        git-stripspace</span><br><span class="line">git-am                git-credential-cache--daemon  git-http-push           git-mktree               git-remote-http        git-submodule</span><br><span class="line">git-annotate          git-credential-store          git-imap-send           git-mv                   git-remote-https       git-submodule--helper</span><br><span class="line">git-apply             git-daemon                    git-index-pack          git-name-rev             git-remote-testsvn     git-subtree</span><br><span class="line">git-archive           git-describe                  git-init                git-notes                git-repack             git-symbolic-ref</span><br><span class="line">git-bisect            git-diff                      git-init-db             git-pack-objects         git-replace            git-tag</span><br><span class="line">git-bisect--helper    git-diff-files                git-instaweb            git-pack-redundant       git-request-pull       git-unpack-file</span><br><span class="line">git-blame             git-diff-index                git-interpret-trailers  git-pack-refs            git-rerere             git-unpack-objects</span><br><span class="line">git-branch            git-diff-tree                 git-log                 git-parse-remote         git-reset              git-update-index</span><br><span class="line">git-bundle            git-difftool                  git-ls-files            git-patch-id             git-rev-list           git-update-ref</span><br><span class="line">git-cat-file          git-difftool--helper          git-ls-remote           git-prune                git-rev-parse          git-update-server-info</span><br><span class="line">git-check-attr        git-fast-export               git-ls-tree             git-prune-packed         git-revert             git-upload-archive</span><br><span class="line">git-check-ignore      git-fast-import               git-mailinfo            git-pull                 git-rm                 git-upload-pack</span><br><span class="line">git-check-mailmap     git-fetch                     git-mailsplit           git-push                 git-send-pack          git-var</span><br><span class="line">git-check-ref-format  git-fetch-pack                git-merge               git-quiltimport          git-sh-i18n            git-verify-commit</span><br><span class="line">git-checkout          git-filter-branch             git-merge-base          git-read-tree            git-sh-i18n--envsubst  git-verify-pack</span><br><span class="line">git-checkout-index    git-fmt-merge-msg             git-merge-file          git-rebase               git-sh-prompt          git-verify-tag</span><br><span class="line">git-cherry            git-for-each-ref              git-merge-index         git-rebase--am           git-sh-setup           git-web--browse</span><br><span class="line">git-cherry-pick       git-format-patch              git-merge-octopus       git-rebase--helper       git-shell              git-whatchanged</span><br><span class="line">git-clean             git-fsck                      git-merge-one-file      git-rebase--interactive  git-shortlog           git-worktree</span><br><span class="line">git-clone             git-fsck-objects              git-merge-ours          git-rebase--merge        git-show               git-write-tree</span><br><span class="line">git-column            git-gc                        git-merge-recursive     git-receive-pack         git-show-branch        mergetools</span><br><span class="line">git-commit            git-get-tar-commit-id         git-merge-resolve       git-reflog               git-show-index</span><br><span class="line">git-commit-tree       git-grep                      git-merge-subtree       git-remote               git-show-ref</span><br><span class="line">git-config            git-hash-object               git-merge-tree          git-remote-ext           git-stage</span><br></pre></td></tr></table></figure><h3 id="git-cat-file"><a href="#git-cat-file" class="headerlink" title="git cat-file"></a>git cat-file</h3><p>查看objects文件。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git cat-file (-t [--allow-unknown-type] | -s [--allow-unknown-type] | -e | -p | &lt;type&gt; | --textconv | --filters) [--path=&lt;path&gt;] &lt;object&gt;or: git cat-file (--batch | --batch-check) [--follow-symlinks] [--textconv | --filters]&lt;type&gt; can be one of: blob, tree, commit, tag    -t                    show object type    -s                    show object size    -e                    exit with zero when there&#39;s no error    -p                    pretty-print object&#39;s content    --textconv            for blob objects, run textconv on object&#39;s content    --filters             for blob objects, run filters on object&#39;s content    --path &lt;blob&gt;         use a specific path for --textconv/--filters    --allow-unknown-type  allow -s and -t to work with broken/corrupt objects    --buffer              buffer --batch output    --batch[=&lt;format&gt;]    show info and content of objects fed from the standard input    --batch-check[=&lt;format&gt;]                        show info about objects fed from the standard input    --follow-symlinks     follow in-tree symlinks (used with --batch or --batch-check)    --batch-all-objects   show all objects with --batch or --batch-check</code></pre></details></br><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 objects 文件类型</span></span><br><span class="line">$ git cat-file -t 56ec1a0729533fbd8d38b7964b6f8ca2cace70ba</span><br><span class="line">commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 objects 文件大小</span></span><br><span class="line">$ git cat-file -s 56ec1a0729533fbd8d38b7964b6f8ca2cace70ba</span><br><span class="line">243</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 objects 文件（格式化）内容</span></span><br><span class="line">$ git cat-file -p 56ec1a0729533fbd8d38b7964b6f8ca2cace70ba</span><br><span class="line">tree 7f9adb36c3e987d1ca9d40ba538afd8cbc74e942</span><br><span class="line">parent cf22ff3d15d718603f93c36f13d848e00d841def</span><br><span class="line">author chenan.xxw &lt;chenan.xxw@alibaba-inc.com&gt; 1599545250 +0800</span><br><span class="line">committer chenan.xxw &lt;chenan.xxw@alibaba-inc.com&gt; 1599545250 +0800</span><br><span class="line"></span><br><span class="line">update README.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以通过 tag 或 branch 名称查看 object 文件</span></span><br><span class="line">$ git cat-file -t v0.1.0</span><br><span class="line">tag</span><br><span class="line">$ git cat-file -p v0.1.0</span><br><span class="line">object c5b97d5ae6c19d5c5df71a34c7fbeeda2479ccbc</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v0.1.0</span><br><span class="line">tagger Scott Chacon &lt;schacon@gmail.com&gt; 1290556430 -0800</span><br><span class="line"></span><br><span class="line">tagging initial release of libgit2</span><br></pre></td></tr></table></figure><p><a name="5M8In"></a></p><h3 id="git-ls-files"><a href="#git-ls-files" class="headerlink" title="git ls-files"></a>git ls-files</h3><p>查看index文件内容。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git ls-files [&lt;options&gt;] [&lt;file&gt;...]    -z                    paths are separated with NUL character    -t                    identify the file status with tags    -v                    use lowercase letters for &#39;assume unchanged&#39; files    -f                    use lowercase letters for &#39;fsmonitor clean&#39; files    -c, --cached          show cached files in the output (default)    -d, --deleted         show deleted files in the output    -m, --modified        show modified files in the output    -o, --others          show other files in the output    -i, --ignored         show ignored files in the output    -s, --stage           show staged contents&#39; object name in the output    -k, --killed          show files on the filesystem that need to be removed    --directory           show &#39;other&#39; directories&#39; names only    --eol                 show line endings of files    --empty-directory     don&#39;t show empty directories    -u, --unmerged        show unmerged files in the output    --resolve-undo        show resolve-undo information    -x, --exclude &lt;pattern&gt;                        skip files matching pattern    -X, --exclude-from &lt;file&gt;                        exclude patterns are read from &lt;file&gt;    --exclude-per-directory &lt;file&gt;                        read additional per-directory exclude patterns in &lt;file&gt;    --exclude-standard    add the standard git exclusions    --full-name           make the output relative to the project top directory    --recurse-submodules  recurse through submodules    --error-unmatch       if any &lt;file&gt; is not in the index, treat this as an error    --with-tree &lt;tree-ish&gt;                        pretend that paths removed since &lt;tree-ish&gt; are still present    --abbrev[=&lt;n&gt;]        use &lt;n&gt; digits to display SHA-1s    --debug               show debugging data</code></pre></details></br><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files</span><br><span class="line">.gitignore</span><br><span class="line">Makefile</span><br><span class="line">README</span><br><span class="line">README.md</span><br><span class="line">cache.h</span><br><span class="line">cat-file.c</span><br><span class="line">commit-tree.c</span><br><span class="line">init-db.c</span><br><span class="line">read-cache.c</span><br><span class="line">read-tree.c</span><br><span class="line">show-diff.c</span><br><span class="line">update-cache.c</span><br><span class="line">write-tree.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 hexdump 可以查看到index文件内容</span></span><br><span class="line">$ hexdump -C .git/index</span><br></pre></td></tr></table></figure><p><a name="CFLvH"></a></p><h3 id="git-ls-tree"><a href="#git-ls-tree" class="headerlink" title="git ls-tree"></a>git ls-tree</h3><p>查看树内容，可以是 commit-id ，也可以是 tree-id ，也可以是 <a href="./git-revisions.md">git revisions</a> 格式。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git ls-tree [&lt;options&gt;] &lt;tree-ish&gt; [&lt;path&gt;...]    -d                    only show trees    -r                    recurse into subtrees    -t                    show trees when recursing    -z                    terminate entries with NUL byte    -l, --long            include object size    --name-only           list only filenames    --name-status         list only filenames    --full-name           use full path names    --full-tree           list entire tree; not just current directory (implies --full-name)    --abbrev[=&lt;n&gt;]        use &lt;n&gt; digits to display SHA-1s</code></pre></details></br>示例<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-tree bace6b8b2d3058e3cc0495f5edfb235ed8cff21e</span><br><span class="line">100644 blob c30106543ed8f32af334362fa82e3a4ad71ef20fhome.md</span><br><span class="line">100644 blob c3d45c3c479ebc458accbbd82c6483aecb35e516main.md</span><br><span class="line">040000 tree fec352d6a6f669a3e1b035202911245e1d73e8acsubdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># size、全路径格式</span></span><br><span class="line">$ git ls-tree -l --full-name bace6b8b2d3058e3cc0495f5edfb235ed8cff21e</span><br><span class="line">100644 blob c30106543ed8f32af334362fa82e3a4ad71ef20f      16home.md</span><br><span class="line">100644 blob c3d45c3c479ebc458accbbd82c6483aecb35e516      18main.md</span><br><span class="line">040000 tree fec352d6a6f669a3e1b035202911245e1d73e8ac       -subdir</span><br><span class="line"></span><br><span class="line">$ git ls-tree --full-name HEAD</span><br><span class="line">100644 blob c30106543ed8f32af334362fa82e3a4ad71ef20fhome.md</span><br><span class="line">100644 blob c3d45c3c479ebc458accbbd82c6483aecb35e516main.md</span><br><span class="line">040000 tree fec352d6a6f669a3e1b035202911245e1d73e8acsubdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># git revision 格式</span></span><br><span class="line">$ git ls-tree --full-name HEAD^&#123;tree&#125;</span><br><span class="line">100644 blob c30106543ed8f32af334362fa82e3a4ad71ef20fhome.md</span><br><span class="line">100644 blob c3d45c3c479ebc458accbbd82c6483aecb35e516main.md</span><br><span class="line">040000 tree fec352d6a6f669a3e1b035202911245e1d73e8acsubdir</span><br></pre></td></tr></table></figure><p><a name="AAHtb"></a></p><h3 id="git-read-tree"><a href="#git-read-tree" class="headerlink" title="git read-tree"></a>git read-tree</h3><p>把tree的信息（可以是多个）写入到索引（index）中。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git read-tree [(-m [--trivial] [--aggressive] | --reset | --prefix=&lt;prefix&gt;) [-u [--exclude-per-directory=&lt;gitignore&gt;] | -i]] [--no-sparse-checkout] [--index-output=&lt;file&gt;] (--empty | &lt;tree-ish1&gt; [&lt;tree-ish2&gt; [&lt;tree-ish3&gt;]])    --index-output &lt;file&gt;                        write resulting index to &lt;file&gt;    --empty               only empty the index    -v, --verbose         be verboseMerging    -m                    perform a merge in addition to a read    --trivial             3-way merge if no file level merging required    --aggressive          3-way merge in presence of adds and removes    --reset               same as -m, but discard unmerged entries    --prefix &lt;subdirectory&gt;/                        read the tree into the index under &lt;subdirectory&gt;/    -u                    update working tree with merge result    --exclude-per-directory &lt;gitignore&gt;                        allow explicitly ignored files to be overwritten    -i                    don&#39;t check the working tree after merging    -n, --dry-run         don&#39;t update the index or the work tree    --no-sparse-checkout  skip applying sparse checkout filter    --debug-unpack        debug unpack-trees    --recurse-submodules[=&lt;checkout&gt;]                        control recursive updating of submodules</code></pre></details></br><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git read-tree 7fc6c35263716bad0d1df5a814766e8f1fd20345</span><br><span class="line">$ git ls-files</span><br><span class="line">home.md</span><br><span class="line">main.md</span><br><span class="line">subdir/deeper.md</span><br><span class="line"></span><br><span class="line">$ git read-tree HEAD^</span><br><span class="line">home.md</span><br><span class="line">main.md</span><br></pre></td></tr></table></figure><h3 id="git-write-tree"><a href="#git-write-tree" class="headerlink" title="git write-tree"></a>git write-tree</h3><p>把存储区的文件结构存储成 tree 对象。</p><details><summary>命令说明（点击展开）</summary><p>usage: git write-tree [–missing-ok] [–prefix=<prefix>/]</p><pre><code>--missing-ok          allow missing objects--prefix &lt;prefix&gt;/    write tree object for a subdirectory &lt;prefix&gt;</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充</span></span><br></pre></td></tr></table></figure><h3 id="git-commit-tree"><a href="#git-commit-tree" class="headerlink" title="git commit-tree"></a>git commit-tree</h3><p>把 tree 对象读取到暂存区。</p><details><summary>命令说明（点击展开）</summary><p>usage: git commit-tree [(-p <sha1>)…] [-S[<keyid>]] [-m <message>] [-F <file>] <sha1></p></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充</span></span><br></pre></td></tr></table></figure><h3 id="git-mktree"><a href="#git-mktree" class="headerlink" title="git mktree"></a>git mktree</h3><p>根据输入（<code>ls-tree</code>的输出格式）来生成 tree 对象。</p><summary>命令说明（点击展开）</summary><p>usage: git mktree [-z] [–missing] [–batch]</p><pre><code>-z                    input is NUL terminated--missing             allow missing objects--batch               allow creation of more than one tree</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充</span></span><br></pre></td></tr></table></figure><h3 id="git-diff-tree"><a href="#git-diff-tree" class="headerlink" title="git diff-tree"></a>git diff-tree</h3><p>比较 2 个tree 对象 的差异并格式化输出。</p><summary>命令说明（点击展开）</summary><p>usage: git diff-tree [–stdin] [-m] [-c] [–cc] [-s] [-v] [–pretty] [-t] [-r] [–root] [<common-diff-options>] <tree-ish> [<tree-ish>] [<path>…]<br>  -r            diff recursively<br>  –root        include the initial commit as diff against /dev/null</p><p>common diff options:<br>  -z            output diff-raw with lines terminated with NUL.<br>  -p            output patch format.<br>  -u            synonym for -p.<br>  –patch-with-raw<br>                output both a patch and the diff-raw format.<br>  –stat        show diffstat instead of patch.<br>  –numstat     show numeric diffstat instead of patch.<br>  –patch-with-stat<br>                output a patch and prepend its diffstat.<br>  –name-only   show only names of changed files.<br>  –name-status show names and status of changed files.<br>  –full-index  show full object name on index lines.<br>  –abbrev=<n>  abbreviate object names in diff-tree header and diff-raw.<br>  -R            swap input file pairs.<br>  -B            detect complete rewrites.<br>  -M            detect renames.<br>  -C            detect copies.<br>  –find-copies-harder<br>                try unchanged files as candidate for copy detection.<br>  -l<n>         limit rename attempts up to <n> paths.<br>  -O<file>      reorder diffs according to the <file>.<br>  -S<string>    find filepair whose only one side contains the string.<br>  –pickaxe-all<br>                show all files diff when -S is used and hit is found.<br>  -a  –text    treat all files as text.</p></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充</span></span><br></pre></td></tr></table></figure><p><a name="UDzYk"></a></p><h3 id="git-gc"><a href="#git-gc" class="headerlink" title="git gc"></a>git gc</h3><p>打包压缩操作，将多个 object 对象打包成 pack 文件对象。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git gc [&lt;options&gt;]    -q, --quiet           suppress progress reporting    --prune[=&lt;date&gt;]      prune unreferenced objects    --aggressive          be more thorough (increased runtime)    --auto                enable auto-gc mode    --force               force running gc even if there may be another gc running    --keep-largest-pack   repack all other packs except the largest pack</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git gc</span><br><span class="line">Enumerating objects: 43, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (43/43), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (43/43), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (43/43), <span class="keyword">done</span>.</span><br><span class="line">Total 43 (delta 15), reused 26 (delta 0)</span><br><span class="line">Computing commit graph generation numbers: 100% (10/10), <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure><p><a name="hPrtl"></a></p><h3 id="git-verify-pack"><a href="#git-verify-pack" class="headerlink" title="git verify-pack"></a>git verify-pack</h3><p>查看 pack 包内容。<br /></p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git verify-pack [-v | --verbose] [-s | --stat-only] &lt;pack&gt;...    -v, --verbose         verbose    -s, --stat-only       show statistics only</code></pre></details></br><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看简略信息</span></span><br><span class="line">$ git verify-pack -s objects/pack/pack-eebc99ef678d342a5e2aa34c32ec21e488f3bc32.idx</span><br><span class="line">non delta: 28 objects</span><br><span class="line">chain length = 1: 2 objects</span><br><span class="line">chain length = 2: 11 objects</span><br><span class="line">chain length = 3: 2 objects</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看详细内容</span></span><br><span class="line">$ git verify-pack -v objects/pack/pack-eebc99ef678d342a5e2aa34c32ec21e488f3bc32.idx</span><br><span class="line">b0316411f58dc6dd18c700e04f9d3f7f99c17c41 commit 243 162 12</span><br><span class="line">56ec1a0729533fbd8d38b7964b6f8ca2cace70ba commit 243 163 174</span><br><span class="line">cf22ff3d15d718603f93c36f13d848e00d841def commit 236 155 337</span><br><span class="line">1bac831942f9cd24f9ced4d8fe72988eb584f85c commit 233 153 492</span><br><span class="line">9b6e8ecd34cf3fc023123aaab660e58c4f6b705a commit 243 161 645</span><br><span class="line">......</span><br><span class="line">259a84fd251cdabdbbb93b382575fba00ea3614d blob   6170 2572 33450</span><br><span class="line">49cfa9e43a2a86952e2a93c5a8485da30d5dd306 blob   5423 2189 36022</span><br><span class="line">921f981353229db0c56103a52609d35aff16f41b blob   1441 741 38211</span><br><span class="line">non delta: 28 objects</span><br><span class="line">chain length = 1: 2 objects</span><br><span class="line">chain length = 2: 11 objects</span><br><span class="line">chain length = 3: 2 objects</span><br><span class="line">objects/pack/pack-eebc99ef678d342a5e2aa34c32ec21e488f3bc32.pack: ok</span><br></pre></td></tr></table></figure><p><a name="D5x8u"></a></p><h3 id="git-hash-object"><a href="#git-hash-object" class="headerlink" title="git hash-object"></a>git hash-object</h3><p>计算并生成 object 文件。<br /></p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git hash-object [-t &lt;type&gt;] [-w] [--path=&lt;file&gt; | --no-filters] [--stdin] [--] &lt;file&gt;...or: git hash-object  --stdin-paths    -t &lt;type&gt;             object type    -w                    write the object into the object database    --stdin               read the object from stdin    --stdin-paths         read file names from stdin    --no-filters          store file as is without filters    --literally           just hash any random garbage to create corrupt objects for debugging Git    --path &lt;file&gt;         process file as it were from this path</code></pre></details></br><ul><li><code>--literally</code> 参数：可以对任意数据（可能是垃圾数据）创建松散对象，防止被 git 阻止或过滤。这种方式主要用于调试 git。</li></ul><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅计算内容的 hash 值</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> | git hash-object --stdin -w --literally</span><br><span class="line">9daeafb9864cf43055ae93beb0afd6c7d144bfa4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算内容的 hash 值并写入成 object 文件</span></span><br><span class="line">$ ll objects/9d/aeafb9864cf43055ae93beb0afd6c7d144bfa4</span><br><span class="line">-r--r--r-- 1 root root 20 Sep 28 09:55 objects/9d/aeafb9864cf43055ae93beb0afd6c7d144bfa4</span><br><span class="line">$ git cat-file -p 9daeafb9864cf43055ae93beb0afd6c7d144bfa4</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><a name="nKiGC"></a></p><h3 id="git-show-index"><a href="#git-show-index" class="headerlink" title="git show-index"></a>git show-index</h3><p>从标准输入（stdio）中读取打包索引文件（<code>*.idx</code>）内容，解析并显示打包文件的索引信息。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git show-index</code></pre></details></br><p>示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/objects/pack/pack-b433cf40a267c0fd6b9c4b8afff213eb9ef4a6fe.idx  | git show-index</span><br><span class="line">11588816 003e02611d63514e51b57eb6575e47475290ed26 (fe575e7e)</span><br><span class="line">11472110 00c99364e50d82189b7894fed6c6dda039cb1930 (55daba02)</span><br><span class="line">11271595 010f8bc628b084496e8ef448b87f05b938321793 (0ee48b3f)</span><br><span class="line">11499040 01122c9bab3033b286caf034e740429bda3910a3 (dc88ce00)</span><br><span class="line">9818594 01742e3d4d110b1dbbee737fe42deb834f61a682 (cff383fc)</span><br><span class="line">11589160 01afc6e92ae59469d19befb2dfe2083718e163dc (278f7124)</span><br><span class="line">10666903 01dc8ba07ced44ea1cb6bbf2372a9d77259cdc49 (d2cfe47d)</span><br><span class="line">10624256 01dfc33db0dd549a00d78daa612d827fd219f31d (2be74112)</span><br><span class="line">7243969 01f2ca67cc81936fed349cf46bcd58cc13ee7fcc (f31729b5)</span><br><span class="line">12537 02468694dfbbdf3e1535630afd2fc646c8de503d (96501cb8)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><a name="2odx3"></a></p><h3 id="git-show-ref"><a href="#git-show-ref" class="headerlink" title="git show-ref"></a>git show-ref</h3><p>列出本地引用（ref）。<br /></p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git show-ref [-q | --quiet] [--verify] [--head] [-d | --dereference] [-s | --hash[=&lt;n&gt;]] [--abbrev[=&lt;n&gt;]] [--tags] [--heads] [--] [&lt;pattern&gt;...]or: git show-ref --exclude-existing[=&lt;pattern&gt;]    --tags                only show tags (can be combined with heads)    --heads               only show heads (can be combined with tags)    --verify              stricter reference checking, requires exact ref path    --head                show the HEAD reference, even if it would be filtered out    -d, --dereference     dereference tags into object IDs    -s, --hash[=&lt;n&gt;]      only show SHA1 hash using &lt;n&gt; digits    --abbrev[=&lt;n&gt;]        use &lt;n&gt; digits to display SHA-1s    -q, --quiet           do not print results to stdout (useful with --verify)    --exclude-existing[=&lt;pattern&gt;]                        show refs from stdin that aren&#39;t in local repository</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git show-ref</span><br><span class="line">52855ba8f5c7e8410db2277ca1b00c4e1d1c2721 refs/heads/master</span><br><span class="line">52855ba8f5c7e8410db2277ca1b00c4e1d1c2721 refs/remotes/origin/HEAD</span><br><span class="line">52855ba8f5c7e8410db2277ca1b00c4e1d1c2721 refs/remotes/origin/master</span><br></pre></td></tr></table></figure><p><a name="RFGzC"></a></p><h3 id="git-update-ref"><a href="#git-update-ref" class="headerlink" title="git update-ref"></a>git update-ref</h3><p>更新引用（ref）的内容为指定的对象名称或 sha1 值。<br /></p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git update-ref [&lt;options&gt;] -d &lt;refname&gt; [&lt;old-val&gt;]or: git update-ref [&lt;options&gt;]    &lt;refname&gt; &lt;new-val&gt; [&lt;old-val&gt;]or: git update-ref [&lt;options&gt;] --stdin [-z]    -m &lt;reason&gt;           reason of the update    -d                    delete the reference    --no-deref            update &lt;refname&gt; not the one it points to    -z                    stdin has NUL-terminated arguments    --stdin               read updates from stdin    --create-reflog       create a reflog</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref HEAD 52855ba8f5c7e8410db2277ca1b00c4e1d1c2721</span><br></pre></td></tr></table></figure><p><a name="mIaJ6"></a></p><h3 id="git-rev-parse"><a href="#git-rev-parse" class="headerlink" title="git rev-parse"></a>git rev-parse</h3><p>把 <a href="#PVM6y">revisions</a> 解析成 commit-id ，除此之外，还有其他的功能。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git rev-parse --parseopt [&lt;options&gt;] -- [&lt;args&gt;...]or: git rev-parse --sq-quote [&lt;arg&gt;...]or: git rev-parse [&lt;options&gt;] [&lt;arg&gt;...]</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示 revisions 的 sha1 值</span></span><br><span class="line">$ git rev-parse HEAD</span><br><span class="line">de1acbdbcb7549b7eff8646f9d9cfb308d6bb90b</span><br><span class="line">$ git rev-parse master^&#123;tree&#125;</span><br><span class="line">06a04ed5cae14951e376336d8eadd59f75be3f9c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示git的工作目录</span></span><br><span class="line">$ git rev-parse --git-dir</span><br><span class="line">.git</span><br><span class="line"><span class="comment"># 显示工作区目录</span></span><br><span class="line">$ git rev-parse --show-toplevel</span><br><span class="line">/Users/xxw/workspace/aone/force-stone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示相对于工作区根目录的相对路径</span></span><br><span class="line">$ <span class="built_in">cd</span> vendor/github.com/pkg</span><br><span class="line">$ git rev-parse --show-prefix</span><br><span class="line">vendor/github.com/pkg/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示从当前目录(cd)后退(up)到工作区的根目录的深度</span></span><br><span class="line">$ git rev-parse --show-cdup</span><br><span class="line">../../../</span><br></pre></td></tr></table></figure><p><a name="NcEOk"></a></p><h3 id="git-rev-list"><a href="#git-rev-list" class="headerlink" title="git rev-list"></a>git rev-list</h3><p>按照时间顺序输出历史的 commit-id 。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git rev-list [OPTION] &lt;commit-id&gt;... [ -- paths... ]limiting output:    --max-count=&lt;n&gt;    --max-age=&lt;epoch&gt;    --min-age=&lt;epoch&gt;    --sparse    --no-merges    --min-parents=&lt;n&gt;    --no-min-parents    --max-parents=&lt;n&gt;    --no-max-parents    --remove-empty    --all    --branches    --tags    --remotes    --stdin    --quietordering output:    --topo-order    --date-order    --reverseformatting output:    --parents    --children    --objects | --objects-edge    --unpacked    --header | --pretty    --[no-]object-names    --abbrev=&lt;n&gt; | --no-abbrev    --abbrev-commit    --left-right    --countspecial purpose:    --bisect    --bisect-vars    --bisect-all</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示 master 分支的历史版本</span></span><br><span class="line">$ git rev-list master</span><br><span class="line">52855ba8f5c7e8410db2277ca1b00c4e1d1c2721</span><br><span class="line">b16a0f533bbda973eb28fbfbc91a7dbb345d38d1</span><br><span class="line">983f2892bebdaa7422895a2583cd32fab54c0ea5</span><br><span class="line">7ba6884d2f1c40caf5ba40136c85c3c413c3488b</span><br><span class="line">585815f7b473f015cf99aeba71b5f37219494d90</span><br><span class="line">3e17226d70bca16ff54647bda3444764c8062922</span><br><span class="line">174b8333509496687fa9baf570b0ebe4459289fb</span><br><span class="line">84c83efa85ddfa026d3db955dac212c3376bd101</span><br><span class="line">93af3cd9281510c1d64d806c30b77ca508942859</span><br><span class="line">32067c28ccc498b8059fb37823aedfb9a2d5527c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示 master 分支历史版本，同时显示 objects</span></span><br><span class="line">$ git rev-list master --objects</span><br><span class="line">...</span><br><span class="line">29885ee583595d9080b841625d7b2d16f0fb34d2 internal</span><br><span class="line">81a035a831bf13dc28cb86373e23c20d48b08c7c internal/diff</span><br><span class="line">05bb5447d0c6d121103ff75cfde889cd5f790794 internal/diff/diff.go</span><br><span class="line">7248748b8897d3e28421387b5133632c0cd772dd internal/service</span><br><span class="line">a0995fd53aeb7748b7618e5427844bbedf20c832 internal/service/diff</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="git-for-each-ref"><a href="#git-for-each-ref" class="headerlink" title="git for-each-ref"></a>git for-each-ref</h3><p>查看引用列表。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git for-each-ref [&lt;options&gt;] [&lt;pattern&gt;]or: git for-each-ref [--points-at &lt;object&gt;]or: git for-each-ref [(--merged | --no-merged) [&lt;commit&gt;]]or: git for-each-ref [--contains [&lt;commit&gt;]] [--no-contains [&lt;commit&gt;]]    -s, --shell           quote placeholders suitably for shells    -p, --perl            quote placeholders suitably for perl    --python              quote placeholders suitably for python    --tcl                 quote placeholders suitably for Tcl    --count &lt;n&gt;           show only &lt;n&gt; matched refs    --format &lt;format&gt;     format to use for the output    --color[=&lt;when&gt;]      respect format colors    --sort &lt;key&gt;          field name to sort on    --points-at &lt;object&gt;  print only refs which points at the given object    --merged &lt;commit&gt;     print only refs that are merged    --no-merged &lt;commit&gt;  print only refs that are not merged    --contains &lt;commit&gt;   print only refs which contain the commit    --no-contains &lt;commit&gt;                        print only refs which don&#39;t contain the commit    --ignore-case         sorting and filtering are case insensitive</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git for-each-ref</span><br><span class="line">ccbe4719bd6d81a40343a97cfb49a094af30ccaf commit refs/heads/master</span><br><span class="line">ccbe4719bd6d81a40343a97cfb49a094af30ccaf commit refs/remotes/origin/HEAD</span><br><span class="line">785b6024cfa7e95359eb5b0fe8cfc7c8e6c4905e commit refs/remotes/origin/cmn/config-snapshot</span><br><span class="line">b63157de51a6caeffe067d3410b0a3f375b94390 commit refs/remotes/origin/cmn/go-http</span><br><span class="line">...... <span class="comment"># 省略</span></span><br><span class="line">ccbe4719bd6d81a40343a97cfb49a094af30ccaf commit refs/tags/v31.3.0</span><br></pre></td></tr></table></figure><h3 id="git-var"><a href="#git-var" class="headerlink" title="git var"></a>git var</h3><p>查看 Git 当前生效的变量。</p><details><summary>命令说明（点击展开）</summary><p>usage: git var (-l | <variable>)</p></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git var -l</span><br><span class="line">credential.helper=osxkeychain</span><br><span class="line">color.ui=auto</span><br><span class="line"><span class="comment"># 省略</span></span><br><span class="line">alias.co=checkout</span><br><span class="line">core.repositoryformatversion=0</span><br><span class="line">core.filemode=<span class="literal">true</span></span><br><span class="line">core.bare=<span class="literal">false</span></span><br><span class="line">core.logallrefupdates=<span class="literal">true</span></span><br><span class="line">core.ignorecase=<span class="literal">true</span></span><br><span class="line">core.precomposeunicode=<span class="literal">true</span></span><br><span class="line">GIT_COMMITTER_IDENT=xiaowenxia &lt;775117471@qq.com&gt; 1607157829 +0800</span><br><span class="line">GIT_AUTHOR_IDENT=xiaowenxia &lt;775117471@qq.com&gt; 1607157829 +0800</span><br><span class="line">GIT_EDITOR=vi</span><br><span class="line">GIT_PAGER=less</span><br></pre></td></tr></table></figure><h3 id="git-diff-tree-1"><a href="#git-diff-tree-1" class="headerlink" title="git diff-tree"></a>git diff-tree</h3><p>比较 2 个tree 对象 的差异并格式化输出。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git diff-tree [--stdin] [-m] [-c] [--cc] [-s] [-v] [--pretty] [-t] [-r] [--root] [&lt;common-diff-options&gt;] &lt;tree-ish&gt; [&lt;tree-ish&gt;] [&lt;path&gt;...]-r            diff recursively--root        include the initial commit as diff against /dev/nullcommon diff options:-z            output diff-raw with lines terminated with NUL.-p            output patch format.-u            synonym for -p.--patch-with-raw                output both a patch and the diff-raw format.--stat        show diffstat instead of patch.--numstat     show numeric diffstat instead of patch.--patch-with-stat                output a patch and prepend its diffstat.--name-only   show only names of changed files.--name-status show names and status of changed files.--full-index  show full object name on index lines.--abbrev=&lt;n&gt;  abbreviate object names in diff-tree header and diff-raw.-R            swap input file pairs.-B            detect complete rewrites.-M            detect renames.-C            detect copies.--find-copies-harder                try unchanged files as candidate for copy detection.-l&lt;n&gt;         limit rename attempts up to &lt;n&gt; paths.-O&lt;file&gt;      reorder diffs according to the &lt;file&gt;.-S&lt;string&gt;    find filepair whose only one side contains the string.--pickaxe-all                show all files diff when -S is used and hit is found.-a  --text    treat all files as text.</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git diff-tree a0e96b5ee9f1a3a73f340ff7d1d6fe2031291bb0^&#123;tree&#125; 523d41ce82ea993e7c7df8be1292b2eac84d4659^&#123;tree&#125;</span><br><span class="line">:100644 000000 5664e303b5dc2e9ef8e14a0845d9486ec1920afd 0000000000000000000000000000000000000000 DREADME.md</span><br><span class="line">:040000 000000 39fb0fbcac51f66b514fbd589a5b2bc0809ce664 0000000000000000000000000000000000000000 Ddoc</span><br><span class="line">:100644 100644 aec2e48cbf0a881d893ccdd9c0d4bbaf011b5b23 6fb38b7118b554886e96fa736051f18d63a80c85 Mfile.txt</span><br></pre></td></tr></table></figure><h3 id="git-merge-base"><a href="#git-merge-base" class="headerlink" title="git merge-base"></a>git merge-base</h3><p>为合并找到共同祖先。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git merge-base [-a | --all] &lt;commit&gt; &lt;commit&gt;...or: git merge-base [-a | --all] --octopus &lt;commit&gt;...or: git merge-base --independent &lt;commit&gt;...or: git merge-base --is-ancestor &lt;commit&gt; &lt;commit&gt;or: git merge-base --fork-point &lt;ref&gt; [&lt;commit&gt;]    -a, --all             output all common ancestors    --octopus             find ancestors for a single n-way merge    --independent         list revs not reachable from others    --is-ancestor         is the first one ancestor of the other?    --fork-point          find where &lt;commit&gt; forked from reflog of &lt;ref&gt;</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="git-ref-log"><a href="#git-ref-log" class="headerlink" title="git ref-log"></a>git ref-log</h3><p>查看引用变更日志。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git reflog [ show | expire | delete | exists ]</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">2c5b80 (HEAD -&gt; main, origin/main, origin/HEAD) HEAD@&#123;0&#125;: commit: Update git commands</span><br><span class="line">539f806 HEAD@&#123;1&#125;: reset: moving to HEAD^</span><br><span class="line">bdff99c HEAD@&#123;2&#125;: commit: first commit</span><br><span class="line">539f806 HEAD@&#123;3&#125;: commit: add git-draw</span><br><span class="line">f5993a4 HEAD@&#123;4&#125;: commit: Add git-draw</span><br><span class="line">83c61eb HEAD@&#123;5&#125;: commit: Update readme.md</span><br></pre></td></tr></table></figure><h3 id="git-blame"><a href="#git-blame" class="headerlink" title="git blame"></a>git blame</h3><p>显示文件的每一个修改版本和作者。</p><details><summary>命令说明（点击展开）</summary><pre><code>usage: git blame [&lt;options&gt;] [&lt;rev-opts&gt;] [&lt;rev&gt;] [--] &lt;file&gt;    &lt;rev-opts&gt; are documented in git-rev-list(1)    --incremental         Show blame entries as we find them, incrementally    -b                    Show blank SHA-1 for boundary commits (Default: off)    --root                Do not treat root commits as boundaries (Default: off)    --show-stats          Show work cost statistics    --progress            Force progress reporting    --score-debug         Show output score for blame entries    -f, --show-name       Show original filename (Default: auto)    -n, --show-number     Show original linenumber (Default: off)    -p, --porcelain       Show in a format designed for machine consumption    --line-porcelain      Show porcelain format with per-line commit information    -c                    Use the same output mode as git-annotate (Default: off)    -t                    Show raw timestamp (Default: off)    -l                    Show long commit SHA1 (Default: off)    -s                    Suppress author name and timestamp (Default: off)    -e, --show-email      Show author email instead of name (Default: off)    -w                    Ignore whitespace differences    --indent-heuristic    Use an experimental heuristic to improve diffs    --minimal             Spend extra cycles to find better match    -S &lt;file&gt;             Use revisions from &lt;file&gt; instead of calling git-rev-list    --contents &lt;file&gt;     Use &lt;file&gt;&#39;s contents as the final image    -C[&lt;score&gt;]           Find line copies within and across files    -M[&lt;score&gt;]           Find line movements within and across files    -L &lt;n,m&gt;              Process only line range n,m, counting from 1    --abbrev[=&lt;n&gt;]        use &lt;n&gt; digits to display SHA-1s</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git blame git-refs.md</span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800  1) </span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  2) Git 引用本质上是指向特定的 commit 对象，git 默认情况下都会有一个 master 引用，指向一个默认的分支。</span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  3) &gt; github 上已经把默认的分支从 `master` 改成了 `main` 分支。</span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  4) </span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  5) Git 还存在一个 `HEAD` 引用，代表当前工作的 tree。</span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  6) </span><br><span class="line">a5cbb594 (xiaowenxia 2020-12-07 10:06:34 +0800  7) </span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800  8) ```</span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800  9) $ tree .git/refs</span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800 10) .git/refs</span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800 11) ├── heads</span><br><span class="line">834afb32 (xiaowenxia 2020-11-02 15:09:43 +0800 12) │   └── master</span><br></pre></td></tr></table></figure><h3 id="git-check-attr"><a href="#git-check-attr" class="headerlink" title="git check-attr"></a>git check-attr</h3><p>查看文件属性。</p><details><summary>命令说明（点击展开）</summary><p>usage: git check-attr [-a | –all | <attr>…] [–] <pathname>…<br>   or: git check-attr –stdin [-z] [-a | –all | <attr>…]</p><pre><code>-a, --all             report all attributes set on file--cached              use .gitattributes only from the index--stdin               read file names from stdin-z                    terminate input and output records by a NUL character</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充</span></span><br></pre></td></tr></table></figure><h3 id="git-count-objects"><a href="#git-count-objects" class="headerlink" title="git count-objects"></a>git count-objects</h3><details><summary>命令说明（点击展开）</summary><p>usage: git count-objects [-v] [-H | –human-readable]</p><pre><code>-v, --verbose         be verbose-H, --human-readable  print sizes in human readable format</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git count-objects</span><br><span class="line">235 objects, 2220 kilobytes</span><br><span class="line"><span class="comment"># 方便阅读</span></span><br><span class="line">$ git count-objects -H</span><br><span class="line">235 objects, 2.17 MiB</span><br><span class="line"><span class="comment"># 详细</span></span><br><span class="line">$ git count-objects -Hv</span><br><span class="line">count: 235</span><br><span class="line">size: 2.17 MiB</span><br><span class="line">in-pack: 4</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 2.42 KiB</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br><span class="line">size-garbage: 0 bytes</span><br></pre></td></tr></table></figure><h3 id="git-fsck"><a href="#git-fsck" class="headerlink" title="git fsck"></a>git fsck</h3><p>校验对象链表的正确性和有效性。</p><details><summary>命令说明（点击展开）</summary><p>usage: git fsck [options] [object…]</p><pre><code>-v, --verbose         be verbose--unreachable         show unreachable objects--dangling            show dangling objects--tags                report tags--root                report root nodes--cache               make index objects head nodes--reflogs             make reflogs head nodes (default)--full                also consider packs and alternate objects--connectivity-only   check only connectivity--strict              enable more strict checking--lost-found          write dangling objects in .git/lost-found--progress            show progress--name-objects        show verbose names for reachable objects</code></pre></details></br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前git仓库是正确的</span></span><br><span class="line">$ git fsck</span><br><span class="line">Checking object directories: 100% (256/256), <span class="keyword">done</span>.</span><br><span class="line">dangling tree 4b825dc642cb6eb9a060e54bf8d69288fbee4904</span><br><span class="line"><span class="comment"># 查看对象</span></span><br><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/60/8aeb44e919e3ed8264754851557b6f6f70fec8</span><br><span class="line">.git/objects/5a/3c92d2bc9622c5153110fd1ff1ec43646f2d52</span><br><span class="line">.git/objects/0f/9323931dbf812ac2d08afa6b094e17b60d2872</span><br><span class="line">.git/objects/30/13a8b53d3b92eb18c04e35e0757cfc29df9677</span><br><span class="line">.git/objects/2b/3f5d9b0f1a4381742cea304817c10a229cc53b</span><br><span class="line">.git/objects/34/dc7b21ed0493fd35da77730034967dce88fdc4</span><br><span class="line">.git/objects/4b/825dc642cb6eb9a060e54bf8d69288fbee4904</span><br><span class="line"><span class="comment"># 改变其中一个对象</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; .git/objects/60/8aeb44e919e3ed8264754851557b6f6f70fec8</span><br><span class="line"><span class="comment"># 检查对象链表发现有错误</span></span><br><span class="line">$ git fsck</span><br><span class="line">error: unable to unpack header of .git/objects/60/8aeb44e919e3ed8264754851557b6f6f70fec8</span><br><span class="line">error: 608aeb44e919e3ed8264754851557b6f6f70fec8: object corrupt or missing: .git/objects/60/8aeb44e919e3ed8264754851557b6f6f70fec8</span><br><span class="line">Checking object directories: 100% (256/256), <span class="keyword">done</span>.</span><br><span class="line">error: unable to unpack 608aeb44e919e3ed8264754851557b6f6f70fec8 header</span><br><span class="line">error: unable to unpack 608aeb44e919e3ed8264754851557b6f6f70fec8 header</span><br><span class="line">fatal: loose object 608aeb44e919e3ed8264754851557b6f6f70fec8 (stored <span class="keyword">in</span> .git/objects/60/8aeb44e919e3ed8264754851557b6f6f70fec8) is corrupt</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-底层命令&quot;&gt;&lt;a href=&quot;#Git-底层命令&quot; class=&quot;headerlink&quot; title=&quot;Git 底层命令&quot;&gt;&lt;/a&gt;Git 底层命令&lt;/h2&gt;&lt;p&gt;&lt;a name=&quot;OS6wF&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;目录&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
  </entry>
  
</feed>
